<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Introduction to Docker: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="../favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-info">
          <abbr title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
              Beta
            </a>
            <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Introduction to Docker
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Introduction to Docker
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr></ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to Docker
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. The adventures of Docker and the Space Purple Unicorn Association</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="docker-desktop.html">2. Docker Desktop</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="docker-cli-toolkit.html">3. Building our Docker CLI toolkit</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="docker-volumes.html">4. Sharing information with containers</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="docker-hub.html">5. The Docker Hub</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="docker-run-configuration.html">6. Configuring containers</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="dockerfiles.html">7. Creating Your Own Container Images</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="docker-compose.html">8. Using Docker Compose</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="docker-compose-microservices.html">9. And they lived happily ever after</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
</ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-introduction"><p>Content from <a href="introduction.html">The adventures of Docker and the Space Purple Unicorn Association</a></p>
<hr>
<p>Last updated on 2024-12-03 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/introduction.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are containers, and why might they be useful to me?</li>
<li>How can I join the community effort to count the number of purple
unicorns in space?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn what Docker is and why it is useful</li>
<li>Introduce the Space Purple Unicorn Association</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="docker">Docker<a class="anchor" aria-label="anchor" href="#docker"></a>
</h2>
<hr class="half-width">
<blockquote>
<p><strong>Junior Developer</strong>:
<code>"But it works on my machine!"</code></p>
<p><strong>Senior Developer</strong>:
<code>"Then we'll ship your machine!"</code>
<!-- ![](fig/ship.png){alt="- But it works on my machine! - Then we'll ship your machine!"} --></p>
</blockquote>
<p>Once upon a time this was just a joke, but now it’s a reality!</p>
<p>Docker is a tool that allows you to create, deploy, and run
applications using containers.</p>
<div class="section level3">
<h3 id="why-containers">Why Containers?<a class="anchor" aria-label="anchor" href="#why-containers"></a>
</h3>
<p>There are two major motivations for using containers:</p>
<ul>
<li><p><strong>Reliable Software</strong>. A container packages all the
necessary libraries with their correct versions. It also ensures the
environment remains consistent wherever it runs. Finally, it
encapsulates the recipe for running the software correctly.<br>
Essentially, containers allow you to ship your machine!</p></li>
<li><p><strong>Microservices</strong>. Containers make it very easy to
use <em>microservices</em>. These are small, independent programs that
work together, and provide similar advantages to using libraries in your
code: they make your <em>software stack</em> more modular, more
powerful, and easier to understand.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="why-docker">Why Docker?<a class="anchor" aria-label="anchor" href="#why-docker"></a>
</h3>
<p>There are other ways to make containers, but Docker is the most
popular and probably the most mature.</p>
<p>On some specialised environments (such as HPC), you might use a
different container system (i.e. Apptainer). However, there are usually
ways to convert from Docker to the other system. The reverse doesn’t
always hold.</p>
<p>If you learn only one container system, learn Docker! As it has
become the Rosetta Stone of containers.</p>
</div>
</section><section><h2 class="section-heading" id="the-space-purple-unicorn-association">The Space Purple Unicorn Association<a class="anchor" aria-label="anchor" href="#the-space-purple-unicorn-association"></a>
</h2>
<hr class="half-width">
<div class="columns" style="display: flex; flex-wrap: wrap;">
<div class="column" style="flex: 3; padding: 10px; box-sizing: border-box; min-width: 300px;">
<p>The Space Purple Unicorn Association is a community effort to count
the number of purple unicorns in space.</p>
<p>We are a friendly group of developers, data scientists, and unicorn
enthusiasts, who are passionate about surveying and conserving the
purple unicorn population.</p>
<p>To help you join the effort, we have created a set of tools and
resources to help your community count the number of purple unicorns in
space. These tools are distributed via Docker containers and should be
easy to use.</p>
<p>If you’d like to join the effort to preserve this keystone species,
please help us by running your own Space Purple Unicorn Counting
service, and encouraging your local community to join in the count!</p>
</div>
<div class="column" style="flex: 2; padding: 10px; box-sizing: border-box; min-width: 300px;">
<figure><img src="../fig/SPUA/SPUA_logo.png" alt="SPUA logo" class="figure mx-auto d-block"></figure>
</div>
</div>
</section></section><section id="aio-docker-desktop"><p>Content from <a href="docker-desktop.html">Docker Desktop</a></p>
<hr>
<p>Last updated on 2024-12-03 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-desktop.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>In this episode, we will take a tour of the Docker Desktop dashboard,
as is a helpful and graphical way of understanding the key concepts of
Docker.</p>
<p>If you have installed Docker on a Windows or Mac machine, you will
have Docker Desktop installed (Linux users generally
<strong>wont</strong> have Docker Desktop).</p>
<p>Although useful as an introduction, it is unlikely that you will use
Docker Desktop on your day to day work. You are much more likely to use
the command line interface to interact with Docker, and we will cover
this shortly.</p>
<p>It is also important to note that while Docker Desktop is mostly
free, some features are offered at a premium. Additionally, it is not
fully functional on all operating systems; it can produce conflicts with
the docker engine on Linux, for example.</p>
<p>Therefore, <strong>this episode is meant to be demonstrative, that
is, you do not <em>need</em> to follow along</strong>.</p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is Docker Desktop?</li>
<li>What can it be used for?</li>
<li>Why can’t it replace the cli?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Show Docker Desktop and its components.</li>
<li>Understand what images and containers are.</li>
<li>Visualize the process of image acquisition, container execution and
where it ends.</li>
<li>Understand the ephemeral nature of containers.</li>
<li>Have a glimpse at containers that allow interaction.</li>
<li>Understand the importance of cleaning up in docker.</li>
<li>Understand the limitations of Docker Desktop.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>The <em>Space Purple Unicorn Association</em> (SPUA) has instructed
us to get to work on a very important mission, counting the number of
purple unicorns in the universe!</p>
<p>They have told us to find the <em>Space Purple Unicorn Counter</em>
(SPUC) container image in preparation for our mission.</p>
<section><h2 class="section-heading" id="getting-images">Getting images<a class="anchor" aria-label="anchor" href="#getting-images"></a>
</h2>
<hr class="half-width">
<p>One of the useful features of Docker Desktop is the ability to search
and analyze container images.</p>
<p>If you open the application you will likely see something like
this:</p>
<figure><img src="../fig/docker-desktop/docker_desktop_landing.png" alt="Docker Desktop being opened for the first time." class="figure mx-auto d-block"></figure><p>You’ll notice that the panel on the left has a tab for ‘Images’ and
another for ‘Containers’. These will be the focus for the episode, and
we will ignore most other features.</p>
<p>On the top blue bar you’ll also find a search icon, which allows us
to search for container images.</p>
<p>Lets go ahead and select this search box, and search for
<code>spuacv/spuc</code>.</p>
<p>You may have noticed that it already shows some information about the
image. If you click on the image you’ll be shown more information. You
should be able to see the documentation, and it lets you select a tag
(version) from the dropdown menu.</p>
<div class="tabs">
<nav><div id="nav-tab-1" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-1-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-1" type="button" role="tab" aria-controls="nav-tabpanel-1-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-1-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-2" type="button" role="tab" aria-controls="nav-tabpanel-1-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-3" type="button" role="tab" aria-controls="nav-tabpanel-1-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-3">
  Step 3
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-4" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-4" type="button" role="tab" aria-controls="nav-tabpanel-1-4" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-4">
  Step 4
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-5" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-5" type="button" role="tab" aria-controls="nav-tabpanel-1-5" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-5">
  Step 5
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-1" class="tab-content">
<div id="nav-tabpanel-1-1" class="tab-pane show active" aria-labelledby="nav-tab-1-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/search_and_pull_spuc/DockerDesktop_00.png" alt="Search and pull of SPUC container - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-1-2" class="tab-pane" aria-labelledby="nav-tab-1-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/search_and_pull_spuc/DockerDesktop_01.png" alt="Search and pull of SPUC container - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-1-3" class="tab-pane" aria-labelledby="nav-tab-1-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/search_and_pull_spuc/DockerDesktop_03.png" alt="Search and pull of SPUC container - Step 3" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-1-4" class="tab-pane" aria-labelledby="nav-tab-1-4" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/search_and_pull_spuc/DockerDesktop_04.png" alt="Search and pull of SPUC container - Step 4" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-1-5" class="tab-pane" aria-labelledby="nav-tab-1-5" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/search_and_pull_spuc/DockerDesktop_05.png" alt="Search and pull of SPUC container - Step 5" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>Once you find the image you were looking for, you can either download
it (pull), or directly run it.</p>
<p>We’ll start by downloading the latest version. Go ahead and click on
the <code>Pull</code> button.</p>
<p>Lets also pull the <code>hello-world</code> and <code>alpine</code>
images, which will help us explore features and issues with Docker
Desktop.</p>
</section><section><h2 class="section-heading" id="inspecting-images">Inspecting images<a class="anchor" aria-label="anchor" href="#inspecting-images"></a>
</h2>
<hr class="half-width">
<p>Lets now go to the <code>Images</code> tab on the left panel. This
shows a list of all the images in your system, so you will be able to
see <code>spuc</code> and the other two images here.</p>
<figure><img src="../fig/docker-desktop/images_spuc_alpine_hello.png" alt="Images list showing spuc, alpine and hello-world." class="figure mx-auto d-block"></figure><p>The list already shows some information about the images, like their
tag, size, and when they were created. It is also the place where you
can run the images, or delete them. However, before we go any further,
we want to <strong>inspect</strong> the images.</p>
<p>Clicking on the image will open a window with information on how the
image is built, and examine its packages and vulnerabilities. If any of
the building blocks of the image are vulnerable, we can see which, and
where they come from (Image hierarchy). For example, the vulnerabilities
in the <code>spuc</code> image come from its base image,
`python3-slim”.</p>
<div class="tabs">
<nav><div id="nav-tab-2" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-2-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-1" type="button" role="tab" aria-controls="nav-tabpanel-2-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-2-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-2" type="button" role="tab" aria-controls="nav-tabpanel-2-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-3" type="button" role="tab" aria-controls="nav-tabpanel-2-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-3">
  Step 3
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-2" class="tab-content">
<div id="nav-tabpanel-2-1" class="tab-pane show active" aria-labelledby="nav-tab-2-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/image_inspect_spuc/DockerDesktop_06.png" alt="Inspecting spuc image - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-2-2" class="tab-pane" aria-labelledby="nav-tab-2-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/image_inspect_spuc/DockerDesktop_07.png" alt="Inspecting spuc image - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-2-3" class="tab-pane" aria-labelledby="nav-tab-2-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/image_inspect_spuc/DockerDesktop_08.png" alt="Inspecting spuc image - Step 3" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>This all looks rather scary, and it is important that we are careful
with the images that we download. It is therefore quite useful to be
able to analyse them like this. The <code>python:3-slim</code> image, in
particular, comes from a verified publisher, so it is unlikely to be
malicious.</p>
<p>Another interesting thing to look at is the last few lines, which
usually show the command that will be run when the container is
started.</p>
</section><section><h2 class="section-heading" id="running-containers">Running containers<a class="anchor" aria-label="anchor" href="#running-containers"></a>
</h2>
<hr class="half-width">
<p>The images that we just downloaded are immutable snapshots of an
environment, distributed to be used as <em>templates</em> to create
<code>containers</code>. Containers are executions of the image, and
because they are running, they become mutable.</p>
<p>Let’s run the <code>hello-world</code> image by clicking the
<code>Run</code> button in the <code>Actions</code> column, from the
<code>Images</code> tab.</p>
<figure><img src="../fig/docker-desktop/image_run_hello.png" alt="Run button from Images tab." class="figure mx-auto d-block"></figure><p>A prompt will ask you to confirm <code>Run</code> or modify some
optional settings. For now, lets just confirm with <code>Run</code>.</p>
<figure><img src="../fig/docker-desktop/image_run_prompt.png" alt="Run confirmation prompt." class="figure mx-auto d-block"></figure><p>You will be taken to a <code>Logs</code> tab inside the container
that you just ran. The logs show the output of this particular image,
“Hello from Docker!” among other things.</p>
<p>If you look carefully, the <code>Containers</code> tab on the left is
highlighted. We are looking at a container now, not an image, and so we
were re-located.</p>
<p>You might also find the heading in this page strange. Unless you
specify a name for the container (which we could have done in the
optional settings), Docker will generate a random name for it, which is
what we see here.</p>
<p>Exploring the <code>Inspect</code> tab will show us some information,
but for now we are more interested in what the <code>Exec</code> and
<code>Stats</code> tabs have to say. They both seem to indicate that we
need to <em>run</em> or <em>start</em> the container.</p>
<div class="tabs">
<nav><div id="nav-tab-3" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-3-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-1" type="button" role="tab" aria-controls="nav-tabpanel-3-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-3-1">
  Logs
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-2" type="button" role="tab" aria-controls="nav-tabpanel-3-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-2">
  Inspect
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-3" type="button" role="tab" aria-controls="nav-tabpanel-3-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-3">
  Bind mounts
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-4" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-4" type="button" role="tab" aria-controls="nav-tabpanel-3-4" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-4">
  Exec
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-5" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-5" type="button" role="tab" aria-controls="nav-tabpanel-3-5" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-5">
  Files
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-6" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-6" type="button" role="tab" aria-controls="nav-tabpanel-3-6" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-6">
  Stats
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-3" class="tab-content">
<div id="nav-tabpanel-3-1" class="tab-pane show active" aria-labelledby="nav-tab-3-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_log.png" alt="Logs tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-2" class="tab-pane" aria-labelledby="nav-tab-3-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_inspect.png" alt="Inspect tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-3" class="tab-pane" aria-labelledby="nav-tab-3-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_bind.png" alt="Bind mounts tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-4" class="tab-pane" aria-labelledby="nav-tab-3-4" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_exec.png" alt="Exec tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-5" class="tab-pane" aria-labelledby="nav-tab-3-5" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_files.png" alt="Files tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-6" class="tab-pane" aria-labelledby="nav-tab-3-6" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_stats.png" alt="Stats tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>Indeed, if we look carefully, we will find an ‘Exited (0)’ status
under the container name, and a <code>Start</code> button near the
top-right corner. However, if we click on that button we will see the
output duplicated in the logs, and the <code>Exited (0)</code> status
again.</p>
<div class="tabs">
<nav><div id="nav-tab-4" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-4-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-4-1" type="button" role="tab" aria-controls="nav-tabpanel-4-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-4-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-4-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-4-2" type="button" role="tab" aria-controls="nav-tabpanel-4-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-4-2">
  Step 2
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-4" class="tab-content">
<div id="nav-tabpanel-4-1" class="tab-pane show active" aria-labelledby="nav-tab-4-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/hello_start/DockerDesktop_17.png" alt="Clicking Start on the already run hello-world container - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-4-2" class="tab-pane" aria-labelledby="nav-tab-4-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/hello_start/DockerDesktop_18.png" alt="Clicking Start on the already run hello-world container - Step 2" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>If we go back to the images tab and run the image again, we’ll see
that the same thing happens. We get the “Hello from Docker!”, and the
container (with a new random name) exits.</p>
<div class="tabs">
<nav><div id="nav-tab-5" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-5-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-5-1" type="button" role="tab" aria-controls="nav-tabpanel-5-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-5-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-5-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-5-2" type="button" role="tab" aria-controls="nav-tabpanel-5-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-5-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-5-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-5-3" type="button" role="tab" aria-controls="nav-tabpanel-5-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-5-3">
  Step 3
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-5" class="tab-content">
<div id="nav-tabpanel-5-1" class="tab-pane show active" aria-labelledby="nav-tab-5-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/hello_re-ran/DockerDesktop_19.png" alt="Running hello-world image for a second time - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-5-2" class="tab-pane" aria-labelledby="nav-tab-5-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/hello_re-ran/DockerDesktop_20.png" alt="Running hello-world image for a second time - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-5-3" class="tab-pane" aria-labelledby="nav-tab-5-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/hello_re-ran/DockerDesktop_21.png" alt="Running hello-world image for a second time - Step 3" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>The nature of most containers is <em>ephemeral</em>.</p>
<p>They are meant to execute a process, and when the process is
completed, they exit. We can confirm this by clicking on the
<code>Containers</code> tab on the left. This will exit the container
inspection and show us all the containers.</p>
<p>We have only run the <code>hello-world</code> image, but you can see
there are two containers. Both containers in the list have a status
‘Exited’.</p>
<figure><img src="../fig/docker-desktop/containers_list.png" alt="Containers list." class="figure mx-auto d-block"></figure><p>You may be wondering why there are two containers, and not just one,
given that we only used one image. As mentioned before, the
<em>image</em> is used as a template, and as many <em>containers</em> as
we want can be created from it. Every time we run the image, a new
container is created.</p>
<p>So why are there not three containers then? When we ran the image
from the container inspection window, we were running the command on the
same container. That’s why there’s only two, even though we saw the
container in action three times.</p>
<p>If we go back to the <code>Images</code> tab and run
<code>hello world</code> again, we’ll see a new container appear. All
the containers are still there, and they are not deleted automatically.
This can actually become problematic, and we will deal with it in a
bit.</p>
</section><section><h2 class="section-heading" id="interacting-with-containers">Interacting with containers<a class="anchor" aria-label="anchor" href="#interacting-with-containers"></a>
</h2>
<hr class="half-width">
<p>Not all containers are as short lived as the ones from the
<code>hello-world</code> image. Lets try running the
<code>spuacv/spuc</code>, but look at the optional settings this time.
If you remember, we were instructed to run the container and configure a
port. Lets add a map to the port <code>8321</code> in the local
machine.</p>
<div class="tabs">
<nav><div id="nav-tab-6" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-6-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-6-1" type="button" role="tab" aria-controls="nav-tabpanel-6-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-6-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-6-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-6-2" type="button" role="tab" aria-controls="nav-tabpanel-6-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-6-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-6-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-6-3" type="button" role="tab" aria-controls="nav-tabpanel-6-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-6-3">
  Step 3
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-6" class="tab-content">
<div id="nav-tabpanel-6-1" class="tab-pane show active" aria-labelledby="nav-tab-6-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_opt/DockerDesktop_24.png" alt="Optional settings for spuc - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-6-2" class="tab-pane" aria-labelledby="nav-tab-6-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_opt/DockerDesktop_25.png" alt="Optional settings for spuc - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-6-3" class="tab-pane" aria-labelledby="nav-tab-6-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_opt/DockerDesktop_26.png" alt="Optional settings for spuc - Step 3" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>We are now ready to run it. You can immediately notice the status
under the container name is <code>Running</code>, and instead of an
option to start the container, we now get the option to stop it. The
<code>Logs</code> tab is not too different, but the <code>Stats</code>
tab already shows more information. The <code>Exec</code> tab also looks
more interesting, we get access to a terminal inside the running
container.</p>
<div class="tabs">
<nav><div id="nav-tab-7" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-7-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-7-1" type="button" role="tab" aria-controls="nav-tabpanel-7-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-7-1">
  Logs
  </h3>
</button>
<button class="nav-link" id="nav-tab-7-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-7-2" type="button" role="tab" aria-controls="nav-tabpanel-7-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-7-2">
  Inspect
  </h3>
</button>
<button class="nav-link" id="nav-tab-7-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-7-3" type="button" role="tab" aria-controls="nav-tabpanel-7-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-7-3">
  Bind mounts
  </h3>
</button>
<button class="nav-link" id="nav-tab-7-4" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-7-4" type="button" role="tab" aria-controls="nav-tabpanel-7-4" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-7-4">
  Exec
  </h3>
</button>
<button class="nav-link" id="nav-tab-7-5" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-7-5" type="button" role="tab" aria-controls="nav-tabpanel-7-5" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-7-5">
  Files
  </h3>
</button>
<button class="nav-link" id="nav-tab-7-6" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-7-6" type="button" role="tab" aria-controls="nav-tabpanel-7-6" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-7-6">
  Stats
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-7" class="tab-content">
<div id="nav-tabpanel-7-1" class="tab-pane show active" aria-labelledby="nav-tab-7-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_log.png" alt="Logs tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-7-2" class="tab-pane" aria-labelledby="nav-tab-7-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_inspect.png" alt="Inspect tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-7-3" class="tab-pane" aria-labelledby="nav-tab-7-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_bind.png" alt="Bind mounts tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-7-4" class="tab-pane" aria-labelledby="nav-tab-7-4" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_exec.png" alt="Exec tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-7-5" class="tab-pane" aria-labelledby="nav-tab-7-5" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_files.png" alt="Files tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-7-6" class="tab-pane" aria-labelledby="nav-tab-7-6" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_stats.png" alt="Stats tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>Before trying to do anything in the terminal, let’s look at the
container list by clicking on the <code>Containers</code> tab on the
left. You’ll see the green icon of the container indicating that it is
still live, and indication of how long it’s been running for.</p>
<figure><img src="../fig/docker-desktop/containers_list_spuc_running.png" alt="Containers list, spuc still running." class="figure mx-auto d-block"></figure><p>Clicking on the container name again will take us back to the
<code>Logs</code> tab in the container.</p>
<div id="spot-a-unicorn" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="spot-a-unicorn" class="callout-inner">
<h3 class="callout-title">Spot a unicorn!</h3>
<div class="callout-content">
<p>If you look at the logs, you’ll see that the SPUC container is
instructing you on how to interact with it. Lets go ahead and try that.
Open a terminal and run the command</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=100</span></code></pre>
</div>
<p>If you look at the logs again, you’ll see that the container has
responded to your command with something like:</p>
<figure><img src="../fig/docker-desktop/spuc_unicorn_detected.png" alt="Detecting a unicorn, spuc logs." class="figure mx-auto d-block"></figure><p>The documentation also mentioned that you can configure this print by
modifying the <code>print.config</code> file. How do we do that?</p>
</div>
</div>
</div>
<p>Let’s try and interact with the terminal inside the container.</p>
<p>If you print the working directory with <code>pwd</code> you’ll get
the app’s base directory: <code>/spuc</code>. You can also list the
contents with <code>ls</code>, and look at the app’s code. We can even
run <code>apt update</code> and install something; for example
<code>apt install nano</code>.</p>
<p>As you might expect, We can also modify things, like for example the
<code>print.config</code> file. Since we have installed nano, lets use
it to edit the file. Run <code>nano config/print.config</code> and
you’ll see the contents of the file. Replace the the print config line
with:</p>
<pre><code>::::: {time} Unicorn number {count} spotted at {location}!! Brightness: {brightness} {units}</code></pre>
<p>Another curl now should show the changes we made to the
<code>print.config</code> file.</p>
<div class="tabs">
<nav><div id="nav-tab-8" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-8-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-8-1" type="button" role="tab" aria-controls="nav-tabpanel-8-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-8-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-8-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-8-2" type="button" role="tab" aria-controls="nav-tabpanel-8-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-8-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-8-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-8-3" type="button" role="tab" aria-controls="nav-tabpanel-8-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-8-3">
  Step 3
  </h3>
</button>
<button class="nav-link" id="nav-tab-8-4" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-8-4" type="button" role="tab" aria-controls="nav-tabpanel-8-4" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-8-4">
  Step 4
  </h3>
</button>
<button class="nav-link" id="nav-tab-8-5" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-8-5" type="button" role="tab" aria-controls="nav-tabpanel-8-5" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-8-5">
  Step 5
  </h3>
</button>
<button class="nav-link" id="nav-tab-8-6" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-8-6" type="button" role="tab" aria-controls="nav-tabpanel-8-6" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-8-6">
  Step 6
  </h3>
</button>
<button class="nav-link" id="nav-tab-8-7" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-8-7" type="button" role="tab" aria-controls="nav-tabpanel-8-7" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-8-7">
  Step 7
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-8" class="tab-content">
<div id="nav-tabpanel-8-1" class="tab-pane show active" aria-labelledby="nav-tab-8-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec/DockerDesktop_34.png" alt="Interacting with spuc terminal in the Exec tab - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-8-2" class="tab-pane" aria-labelledby="nav-tab-8-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec/DockerDesktop_35.png" alt="Interacting with spuc terminal in the Exec tab - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-8-3" class="tab-pane" aria-labelledby="nav-tab-8-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec/DockerDesktop_36.png" alt="Interacting with spuc terminal in the Exec tab - Step 3" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-8-4" class="tab-pane" aria-labelledby="nav-tab-8-4" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec/DockerDesktop_37.png" alt="Interacting with spuc terminal in the Exec tab - Step 4" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-8-5" class="tab-pane" aria-labelledby="nav-tab-8-5" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec/DockerDesktop_38.png" alt="Interacting with spuc terminal in the Exec tab - Step 5" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-8-6" class="tab-pane" aria-labelledby="nav-tab-8-6" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec/DockerDesktop_39.png" alt="Interacting with spuc terminal in the Exec tab - Step 6" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-8-7" class="tab-pane" aria-labelledby="nav-tab-8-7" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec/DockerDesktop_40.png" alt="Interacting with spuc terminal in the Exec tab - Step 7" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>At this point, it seems like the container is very much like a
virtual machine, and we can do whatever we want with it. However, as
we’ve mentioned before, containers are <em>meant to be
ephemeral</em>.</p>
<p>If we stop the container, we get a familiar empty tab in
<code>Exec</code> and <code>Stats</code>. The <code>Containers</code>
tab on the left will also show the container status as
<code>Exited</code>.</p>
<div class="tabs">
<nav><div id="nav-tab-9" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-9-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-9-1" type="button" role="tab" aria-controls="nav-tabpanel-9-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-9-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-9-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-9-2" type="button" role="tab" aria-controls="nav-tabpanel-9-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-9-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-9-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-9-3" type="button" role="tab" aria-controls="nav-tabpanel-9-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-9-3">
  Step 3
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-9" class="tab-content">
<div id="nav-tabpanel-9-1" class="tab-pane show active" aria-labelledby="nav-tab-9-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_stopping/DockerDesktop_41.png" alt="Stop the spuc container - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-9-2" class="tab-pane" aria-labelledby="nav-tab-9-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_stopping/DockerDesktop_42.png" alt="Stop the spuc container - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-9-3" class="tab-pane" aria-labelledby="nav-tab-9-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_stopping/DockerDesktop_43.png" alt="Stop the spuc container - Step 3" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>Lets go back to the <code>Images</code> tab, and run the
<code>spuc</code> image again. Now lets go to the <code>Exec</code> tab,
and try and edit the <code>print.config</code> file again. You’ll notice
that <code>nano</code> is not there anymore. If you look at the contents
of the file, for example with <code>cat config/print.config</code>,
you’ll see that the changes we made are gone.</p>
<div class="tabs">
<nav><div id="nav-tab-10" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-10-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-10-1" type="button" role="tab" aria-controls="nav-tabpanel-10-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-10-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-10-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-10-2" type="button" role="tab" aria-controls="nav-tabpanel-10-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-10-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-10-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-10-3" type="button" role="tab" aria-controls="nav-tabpanel-10-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-10-3">
  Step 3
  </h3>
</button>
<button class="nav-link" id="nav-tab-10-4" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-10-4" type="button" role="tab" aria-controls="nav-tabpanel-10-4" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-10-4">
  Step 4
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-10" class="tab-content">
<div id="nav-tabpanel-10-1" class="tab-pane show active" aria-labelledby="nav-tab-10-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec_2/DockerDesktop_44.png" alt="Exec in fresh spuc container - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-10-2" class="tab-pane" aria-labelledby="nav-tab-10-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec_2/DockerDesktop_45.png" alt="Exec in fresh spuc container - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-10-3" class="tab-pane" aria-labelledby="nav-tab-10-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec_2/DockerDesktop_51.png" alt="Exec in fresh spuc container - Step 3" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-10-4" class="tab-pane" aria-labelledby="nav-tab-10-4" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_exec_2/DockerDesktop_52.png" alt="Exec in fresh spuc container - Step 4" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>When we re-ran the <em>image</em>, we created a <strong>new</strong>
<em>container</em>. The new container is created from the template saved
in the image, and so our changes have banished. This becomes very clear
when we go back to the <code>Containers</code> tab on the left. We can
see that the first container we created from the <code>spuc</code> image
is there, next to the new container (which is still running, by the
way).</p>
<figure><img src="../fig/docker-desktop/containers_2_spuc_containers.png" alt="Containers list after new run of spuc image." class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="reviving-containers">Reviving containers<a class="anchor" aria-label="anchor" href="#reviving-containers"></a>
</h2>
<hr class="half-width">
<p>We <em>can</em> get the old container running again, although this is
rarely something we’d <em>want</em> to do.</p>
<p>In Docker Desktop, all we need to do is click on the
<code>Start</code> button from the <code>Containers</code> list. The
terminal will appear empty, because it is a new session, but you will be
able to see the changes we made before.</p>
<div class="tabs">
<nav><div id="nav-tab-11" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-11-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-11-1" type="button" role="tab" aria-controls="nav-tabpanel-11-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-11-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-11-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-11-2" type="button" role="tab" aria-controls="nav-tabpanel-11-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-11-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-11-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-11-3" type="button" role="tab" aria-controls="nav-tabpanel-11-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-11-3">
  Step 3
  </h3>
</button>
<button class="nav-link" id="nav-tab-11-4" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-11-4" type="button" role="tab" aria-controls="nav-tabpanel-11-4" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-11-4">
  Step 4
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-11" class="tab-content">
<div id="nav-tabpanel-11-1" class="tab-pane show active" aria-labelledby="nav-tab-11-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_revival/DockerDesktop_54.png" alt="Reviving container spuc - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-11-2" class="tab-pane" aria-labelledby="nav-tab-11-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_revival/DockerDesktop_55.png" alt="Reviving container spuc - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-11-3" class="tab-pane" aria-labelledby="nav-tab-11-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_revival/DockerDesktop_58.png" alt="Reviving container spuc - Step 3" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-11-4" class="tab-pane" aria-labelledby="nav-tab-11-4" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_revival/DockerDesktop_61.png" alt="Reviving container spuc - Step 4" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="naming-containers">Naming containers<a class="anchor" aria-label="anchor" href="#naming-containers"></a>
</h2>
<hr class="half-width">
<p>We’ve been a bit sloppy with the containers, and they all have random
names. It is possible to name the containers when we run them, and this
can be very useful. However, it can also cause us problems.</p>
<p>Lets run the <code>spuc</code> image again, and name the container
<code>SPUC</code>.</p>
<div class="tabs">
<nav><div id="nav-tab-12" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-12-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-12-1" type="button" role="tab" aria-controls="nav-tabpanel-12-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-12-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-12-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-12-2" type="button" role="tab" aria-controls="nav-tabpanel-12-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-12-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-12-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-12-3" type="button" role="tab" aria-controls="nav-tabpanel-12-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-12-3">
  Step 3
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-12" class="tab-content">
<div id="nav-tabpanel-12-1" class="tab-pane show active" aria-labelledby="nav-tab-12-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_named/DockerDesktop_62.png" alt="Optional settings for spuc - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-12-2" class="tab-pane" aria-labelledby="nav-tab-12-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_named/DockerDesktop_63.png" alt="Optional settings for spuc - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-12-3" class="tab-pane" aria-labelledby="nav-tab-12-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_named/DockerDesktop_64.png" alt="Optional settings for spuc - Step 3" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>If we look at the container list, it is much easier to find it, so
the name is useful!</p>
<p>However, we forgot to map the port. So lets stop this container, and
launch another one. This time we’ll map the port, and use the name we
wanted.</p>
<div class="tabs">
<nav><div id="nav-tab-13" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-13-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-13-1" type="button" role="tab" aria-controls="nav-tabpanel-13-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-13-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-13-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-13-2" type="button" role="tab" aria-controls="nav-tabpanel-13-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-13-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-13-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-13-3" type="button" role="tab" aria-controls="nav-tabpanel-13-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-13-3">
  Step 3
  </h3>
</button>
<button class="nav-link" id="nav-tab-13-4" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-13-4" type="button" role="tab" aria-controls="nav-tabpanel-13-4" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-13-4">
  Step 4
  </h3>
</button>
<button class="nav-link" id="nav-tab-13-5" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-13-5" type="button" role="tab" aria-controls="nav-tabpanel-13-5" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-13-5">
  Step 5
  </h3>
</button>
<button class="nav-link" id="nav-tab-13-6" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-13-6" type="button" role="tab" aria-controls="nav-tabpanel-13-6" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-13-6">
  Step 6
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-13" class="tab-content">
<div id="nav-tabpanel-13-1" class="tab-pane show active" aria-labelledby="nav-tab-13-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_name_conflict/DockerDesktop_65.png" alt="Optional settings for spuc - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-13-2" class="tab-pane" aria-labelledby="nav-tab-13-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_name_conflict/DockerDesktop_66.png" alt="Optional settings for spuc - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-13-3" class="tab-pane" aria-labelledby="nav-tab-13-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_name_conflict/DockerDesktop_67.png" alt="Optional settings for spuc - Step 3" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-13-4" class="tab-pane" aria-labelledby="nav-tab-13-4" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_name_conflict/DockerDesktop_68.png" alt="Optional settings for spuc - Step 4" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-13-5" class="tab-pane" aria-labelledby="nav-tab-13-5" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_name_conflict/DockerDesktop_69.png" alt="Optional settings for spuc - Step 5" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-13-6" class="tab-pane" aria-labelledby="nav-tab-13-6" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/run_spuc_name_conflict/DockerDesktop_70.png" alt="Optional settings for spuc - Step 6" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>This time we got an error! This is because the name <code>SPUC</code>
is already “in use” by another container. If we want the same name,
we’ll have to delete the old container first.</p>
</section><section><h2 class="section-heading" id="cleaning-up">Cleaning up<a class="anchor" aria-label="anchor" href="#cleaning-up"></a>
</h2>
<hr class="half-width">
<p>Lets go to the containers list, and delete the <code>SPUC</code>
container. There is a very convenient bin icon on the right, which will
prompt you for confirmation.</p>
<div class="tabs">
<nav><div id="nav-tab-14" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-14-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-14-1" type="button" role="tab" aria-controls="nav-tabpanel-14-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-14-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-14-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-14-2" type="button" role="tab" aria-controls="nav-tabpanel-14-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-14-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-14-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-14-3" type="button" role="tab" aria-controls="nav-tabpanel-14-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-14-3">
  Step 3
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-14" class="tab-content">
<div id="nav-tabpanel-14-1" class="tab-pane show active" aria-labelledby="nav-tab-14-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_delete_container/DockerDesktop_71.png" alt="Deleting container SPUC - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-14-2" class="tab-pane" aria-labelledby="nav-tab-14-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_delete_container/DockerDesktop_72.png" alt="Deleting container SPUC - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-14-3" class="tab-pane" aria-labelledby="nav-tab-14-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/spuc_delete_container/DockerDesktop_73.png" alt="Deleting container SPUC - Step 3" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>You should now be able to run the <code>spuc</code> image again, and
name the container <code>SPUC</code>.</p>
<p>Since we are deleting stuff, the <code>hello-world</code> image was
nice and useful to test docker was working, but it is now rather
useless. If I want to delete it, the <code>Images</code> tab on the left
has a convenient bin icon to do so. Clicking on it will prompt you for
confirmation, but it will fail.</p>
<div class="tabs">
<nav><div id="nav-tab-15" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-15-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-15-1" type="button" role="tab" aria-controls="nav-tabpanel-15-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-15-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-15-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-15-2" type="button" role="tab" aria-controls="nav-tabpanel-15-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-15-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-15-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-15-3" type="button" role="tab" aria-controls="nav-tabpanel-15-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-15-3">
  Step 3
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-15" class="tab-content">
<div id="nav-tabpanel-15-1" class="tab-pane show active" aria-labelledby="nav-tab-15-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/images_delete_in_use_fail/DockerDesktop_73.png" alt="Failing to delete image - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-15-2" class="tab-pane" aria-labelledby="nav-tab-15-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/images_delete_in_use_fail/DockerDesktop_74.png" alt="Failing to delete image - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-15-3" class="tab-pane" aria-labelledby="nav-tab-15-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/images_delete_in_use_fail/DockerDesktop_75.png" alt="Failing to delete image - Step 3" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>You’ll probably notice that the status of the image is
<code>In use</code>. That seems strange though, given that all the
containers from that image excited immediately.</p>
<p>Lets have a look at the <code>Containers</code> tab. Some of the
containers in the list came from the <code>hello-world</code> image.
They are now stopped, but the fact that they originated from the
<code>hello-world</code> image is enough.</p>
<p>We’ve only been using Docker for very little, and we already have a
long list of containers! You may see how this can become a problem;
Particularly so because we were a bit sloppy and did not name the
containers.</p>
<p>Let’s try and get rid of the containers then. We can conveniently
select them all with the tick-box at the top, and an option to
<code>Delete</code> shows up. Clicking on it will prompt for
confirmation, and we can go ahead and accept.</p>
<div class="tabs">
<nav><div id="nav-tab-16" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-16-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-16-1" type="button" role="tab" aria-controls="nav-tabpanel-16-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-16-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-16-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-16-2" type="button" role="tab" aria-controls="nav-tabpanel-16-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-16-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-16-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-16-3" type="button" role="tab" aria-controls="nav-tabpanel-16-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-16-3">
  Step 3
  </h3>
</button>
<button class="nav-link" id="nav-tab-16-4" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-16-4" type="button" role="tab" aria-controls="nav-tabpanel-16-4" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-16-4">
  Step 4
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-16" class="tab-content">
<div id="nav-tabpanel-16-1" class="tab-pane show active" aria-labelledby="nav-tab-16-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/delete_all_containers/DockerDesktop_76.png" alt="Deleting containers - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-16-2" class="tab-pane" aria-labelledby="nav-tab-16-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/delete_all_containers/DockerDesktop_77.png" alt="Deleting containers - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-16-3" class="tab-pane" aria-labelledby="nav-tab-16-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/delete_all_containers/DockerDesktop_78.png" alt="Deleting containers - Step 3" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-16-4" class="tab-pane" aria-labelledby="nav-tab-16-4" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/delete_all_containers/DockerDesktop_79.png" alt="Deleting containers - Step 4" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>All our containers are now gone. Forever. We can’t get them back.
This is fine though - they were meant to be ephemeral.</p>
<p><strong><em>Warning:</em></strong> You have to be careful here, this
action deleted even the containers that were running. You can filter the
containers before you select them “all”.</p>
<p>On the up-side, the <code>Images</code> tab shows the
<code>hello-world</code> image as <code>Unused</code> now. For docker,
an image is <code>In use</code> as long as at least one container has
been created from it. Since we have no containers from that image,
Docker now knows the images can be safely deleted.</p>
<div class="tabs">
<nav><div id="nav-tab-17" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-17-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-17-1" type="button" role="tab" aria-controls="nav-tabpanel-17-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-17-1">
  Step 1
  </h3>
</button>
<button class="nav-link" id="nav-tab-17-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-17-2" type="button" role="tab" aria-controls="nav-tabpanel-17-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-17-2">
  Step 2
  </h3>
</button>
<button class="nav-link" id="nav-tab-17-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-17-3" type="button" role="tab" aria-controls="nav-tabpanel-17-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-17-3">
  Step 3
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-17" class="tab-content">
<div id="nav-tabpanel-17-1" class="tab-pane show active" aria-labelledby="nav-tab-17-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/images_delete_hello/DockerDesktop_80.png" alt="Successfully deleting images - Step 1" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-17-2" class="tab-pane" aria-labelledby="nav-tab-17-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/images_delete_hello/DockerDesktop_81.png" alt="Successfully deleting images - Step 2" class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-17-3" class="tab-pane" aria-labelledby="nav-tab-17-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/cropped_screenshots/gifs/images_delete_hello/DockerDesktop_82.png" alt="Successfully deleting images - Step 3" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="limitations---why-not-docker-desktop">Limitations - Why not Docker Desktop?<a class="anchor" aria-label="anchor" href="#limitations---why-not-docker-desktop"></a>
</h2>
<hr class="half-width">
<p>We have seen many of the neat and functional bits of Docker Desktop,
and it can be mighty appealing, particularly so if you lean towards the
use of graphical interfaces. However, we’ve not touched on its
weaknesses.</p>
<p>One thing we have completely lost now is the record of our unicorn
sightings. The containers are gone, and so are the changes we made to
the <code>print.config</code> file. Data in the containers can be made
persistent, but it is not the default behaviour.</p>
<p>Another very important thing is that Docker Desktop is very limited
in <em>how</em> you can run the containers. The optional settings let
you modify the instruction with which the container is run, but it is
very limited.</p>
<p>For example, let’s run the other image we have already pulled,
<code>alpine</code>, which is the image of a very lightweight Linux
distribution. Go to the images list, and click on run.</p>
<p>Nothing seems to have happened at all! Not even a single output to
the <code>Logs</code>, and no way to open a terminal inside Alpine.</p>
<div class="tabs">
<nav><div id="nav-tab-18" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-18-1" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-18-1" type="button" role="tab" aria-controls="nav-tabpanel-18-1" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-18-1">
  Logs
  </h3>
</button>
<button class="nav-link" id="nav-tab-18-2" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-18-2" type="button" role="tab" aria-controls="nav-tabpanel-18-2" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-18-2">
  Inspect
  </h3>
</button>
<button class="nav-link" id="nav-tab-18-3" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-18-3" type="button" role="tab" aria-controls="nav-tabpanel-18-3" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-18-3">
  Bind mounts
  </h3>
</button>
<button class="nav-link" id="nav-tab-18-4" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-18-4" type="button" role="tab" aria-controls="nav-tabpanel-18-4" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-18-4">
  Exec
  </h3>
</button>
<button class="nav-link" id="nav-tab-18-5" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-18-5" type="button" role="tab" aria-controls="nav-tabpanel-18-5" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-18-5">
  Files
  </h3>
</button>
<button class="nav-link" id="nav-tab-18-6" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-18-6" type="button" role="tab" aria-controls="nav-tabpanel-18-6" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-18-6">
  Stats
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-18" class="tab-content">
<div id="nav-tabpanel-18-1" class="tab-pane show active" aria-labelledby="nav-tab-18-1" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_logs.png" alt="Logs tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-18-2" class="tab-pane" aria-labelledby="nav-tab-18-2" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_inspect.png" alt="Inspect tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-18-3" class="tab-pane" aria-labelledby="nav-tab-18-3" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_bind.png" alt="Bind mounts tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-18-4" class="tab-pane" aria-labelledby="nav-tab-18-4" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_exec.png" alt="Exec tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-18-5" class="tab-pane" aria-labelledby="nav-tab-18-5" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_files.png" alt="Files tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-18-6" class="tab-pane" aria-labelledby="nav-tab-18-6" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_stats.png" alt="Stats tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>Just to be clear though, this Docker image does contain the whole
Alpine OS. In Docker Desktop, however, there is no way to interact with
it. This is the case for many (if not most) images. To be able to use it
(or them), we need to provide some sort of input or command, which we
cannot provide from Docker Desktop.</p>
<p>Therefore, Docker Desktop cannot really be used for much more than
being a nice dashboard.</p>
<p>In the next episode, we will use docker from the command line, and
all of the advantages it brings will become apparent.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>
<strong>Images</strong> are snapshots of an environment, easily
distributable and ready to be used as
<strong><em>templates</em></strong> for containers.</li>
<li>
<strong>Containers</strong> are <strong><em>executions of the
images</em></strong>, often with configuration added on top, and usually
<strong><em>meant for single use</em></strong>.</li>
<li>Running a container usually implies creating a new copy, so it is
important to <strong>clean up regularly</strong>.</li>
<li>
<strong>Docker Desktop</strong> is a great
<strong><em>dashboard</em></strong> that allows us to understand and
visualize the lifecycle of images and containers. It could potentially
be all you need to use if you only <em>consume</em> images out of the
box. However, it is <strong><em>very limited</em></strong> in most cases
(even for <em>consumers</em>), and rarely allows the user to configure
and interact with the containers adequately.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-docker-cli-toolkit"><p>Content from <a href="docker-cli-toolkit.html">Building our Docker CLI toolkit</a></p>
<hr>
<p>Last updated on 2024-12-03 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-cli-toolkit.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>Before we start to tackle Docker tasks that are only possible in the
command line, we need to build up our toolkit of Docker commands that
allow us to perform the same tasks we learned to do in Docker
Desktop.</p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I use the Docker CLI to perform the same tasks we learned to
do in Docker Desktop?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Build our fundamental Docker CLI toolkit</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="pulling-and-listing-images">Pulling and Listing Images<a class="anchor" aria-label="anchor" href="#pulling-and-listing-images"></a>
</h2>
<hr class="half-width">
<p>To run an image, first we need to download it. You may remember that,
in Docker, this is known as <em>pulling</em> an image.</p>
<p>Let’s try pulling the SPUC container that we used before:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">docker</span> pull spuacv/spuc:latest</span></code></pre>
</div>
<p>If it is the first time you pull this image, you will see something
like this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>latest: Pulling from spuacv/spuc
302e3ee49805: Pull complete
6b08635bc459: Pull complete
18bb7c8edce2: Pull complete
8341816e3d13: Pull complete
174a3dce8e2a: Pull complete
67d0d37078fb: Pull complete
4a705a772a90: Pull complete
bd9732a6317b: Pull complete
44c70b826ff3: Pull complete
cee1b3575f12: Pull complete
Digest: sha256:ad219064aaaad76860c53ec8420730d69dc5f8beb9345b0a15176111c2a976c5
Status: Downloaded newer image for spuacv/spuc:latest
docker.io/spuacv/spuc:latest</code></pre>
</div>
<p>If you’d already downloaded it before, you will instead get something
like this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>latest: Pulling from spuacv/spuc
Digest: sha256:ad219064aaaad76860c53ec8420730d69dc5f8beb9345b0a15176111c2a976c5
Status: Image is up to date for spuacv/spuc:latest
docker.io/spuacv/spuc:latest</code></pre>
</div>
<p>This just means Docker detected you already had that image, so it
didn’t need to download it again.</p>
<p>The structure of the command we just used will be the same for most
of the commands we will use in the Docker CLI, so it is worth taking a
moment to understand it.</p>
<div id="the-structure-of-a-docker-command" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-structure-of-a-docker-command" class="callout-inner">
<h3 class="callout-title">The structure of a Docker command</h3>
<div class="callout-content">
<p>The Docker CLI can be intimidating, as it is easy to get very long
commands that take a bit of work to understand. However, when you
understand the structure of the commands it becomes much easier to
understand what is happening.</p>
<p>Let’s dive into the structure of the command we looked at. Here is a
diagram which breaks things down:</p>
<figure><img src="../fig/docker_cmd.png" alt="A diagram showing the syntactic structure of a Docker command" class="figure mx-auto d-block"></figure><ul>
<li>Every Docker command starts with ‘docker’</li>
<li>Next, you specify the type of object to act on (e.g. image,
container)</li>
<li>Followed by the action to perform and the name of the object
(e.g. run, pull)</li>
<li>You can also include additional arguments and switches as needed
(e.g. the image name)</li>
</ul>
<p>But wait! We ran <code>docker pull spuacv/spuc:latest</code>, and the
diagram shows the command as ‘image’!</p>
<p>We apologise for the trick but we were actually using a shorthand
built into the Docker CLI. There are a few of these shortcuts; they are
useful, but can be confusing. In this case, <code>docker pull</code> is
actually a shorthand for <code>docker image pull</code>.</p>
<p>In this lesson, we have decided to use the most common versions of
commands, which is often the shorthand. It is important to know that
these shorthands exist, but it is also important to know the full
command structure.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="listing-images">Listing Images<a class="anchor" aria-label="anchor" href="#listing-images"></a>
</h2>
<hr class="half-width">
<p>Now that we have pulled our image, let’s check that it is there:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">docker</span> image ls</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>REPOSITORY                              TAG        IMAGE ID       CREATED         SIZE
spuacv/spuc                             latest    ce72bd42e51c   3 days ago      137MB</code></pre>
</div>
<p>This command lists (ls is short for list) all the images that we have
downloaded. It is the equivalent of the ‘Images’ tab in Docker Desktop.
You should see the SPUC image listed here, along with some other
information about it.</p>
</section><section><h2 class="section-heading" id="inspecting">Inspecting<a class="anchor" aria-label="anchor" href="#inspecting"></a>
</h2>
<hr class="half-width">
<p>You may remember that in Docker Desktop we could explore the image
buildup and the image’s metadata. We called this ‘inspecting’ the image.
To inspect an image using the Docker CLI, we can use:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">docker</span> inspect spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[
    {
        "Id": "sha256:ce72bd42e51c049fe29b4c15dc912e88c4461e94c2e1d403b90e2e53dfb1b420",
        "RepoTags": [
            "spuacv/spuc:latest"
        ],
        "RepoDigests": [
            "spuacv/spuc@sha256:ad219064aaaad76860c53ec8420730d69dc5f8beb9345b0a15176111c2a976c5"
        ],
        "Parent": "",
        "Comment": "buildkit.dockerfile.v0",
        "Created": "2024-10-11T14:05:59.254831281+01:00",
        "DockerVersion": "",
        "Author": "",
        "Config": {
[...]</code></pre>
</div>
<p>This tells you <strong>a lot</strong> of details about the image.
This can be useful for understanding what the image does and how it is
configured but it is also quite overwhelming!</p>
<p>The most useful information for an image user is what the container
will do when it is run. We highlighted the <code>command</code> and
<code>entrypoint</code> while inspecting images in Docker Desktop. Let’s
work on getting this information <em>only</em>.</p>
<p>To do that we will refine our command using the <code>-f</code> flag
to specify the output format. Lets try running the following
command:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">docker</span> inspect spuacv/spuc:latest <span class="at">-f</span> <span class="st">"Command: {{.Config.Cmd}}"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Command: [--units iuhc]</code></pre>
</div>
<p>That’s more manageable! How does it work?</p>
<p>The result of the inspect command is a JSON object, so we can access
elements from the output hierarchically. The <code>command</code> is
part of the image’s <code>Config</code>, which is at the base of the
json object. When we use double curly braces, docker understands we want
to access the value of the key <code>Cmd</code> in the
<code>Config</code> object.</p>
<p>We can do a similar thing to extract the entrypoint:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">docker</span> inspect spuacv/spuc:latest <span class="at">-f</span> <span class="st">"Entrypoint: {{.Config.Entrypoint}}"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Entrypoint: [python /spuc/spuc.py]</code></pre>
</div>
<p>or even get them both at the same time:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">docker</span> inspect spuacv/spuc:latest <span class="at">-f</span> <span class="st">$'Command: {{.Config.Cmd}}</span><span class="dt">\n</span><span class="st">Entrypoint: {{.Config.Entrypoint}}'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Command: [--units iuhc]
Entrypoint: [python /spuc/spuc.py]</code></pre>
</div>
<p>Great! So we know what the command and entrypoint are… but what do
they mean?</p>
<div id="default-command" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="default-command" class="callout-inner">
<h3 class="callout-title">Default Command</h3>
<div class="callout-content">
<p>The default command is the command that a container will run when it
is started. The default values are specified by the creator of an image,
but can be overridden when the container is run.</p>
<p>The default command is formed of two parts, the <em>entrypoint</em>
and the <em>command</em>. The two are concatenated to form the full
command.</p>
<p>To understand this, let’s take a more detailed look at the lifecycle
of a container.</p>
<figure><img src="../fig/docker_life_0.png" alt="A diagram representing the lifecycle of a container" class="figure mx-auto d-block"></figure><p>When run, the container enters a startup state in which:</p>
<ul>
<li>The image is downloaded if needed.</li>
<li>The container is created from an image.</li>
<li>The container is started.</li>
</ul>
<p>Now the container is running, and the command is executed by
concatenating the entrypoint and the command.</p>
<ul>
<li>
<strong>Entrypoint</strong>: <em>usually</em> the base command for
the container. Not often overwritten.</li>
<li>
<strong>Command</strong>: <em>usually</em> parameters for the base
command. Often overwritten.</li>
</ul>
<p>Finally the container is stopped and removed.</p>
<p>In our case, the entrypoint is <code>python /spuc/spuc.py</code> and
the command is <code>--units iuhc</code>. This means that when the
container is run, it will execute the command<br><code>python /spuc/spuc.py --units iuhc</code>.</p>
<p>As mentioned, the command is commonly overwritten when the container
is run. This means we could pass different parameters to the python
script when we run the container.</p>
<p>We will cover this topic in more detail later on.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Further examples of container lifecycle
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>We will give another couple of examples of how entrypoints and
commands are used and affect the container lifecycle in the following
image.</p>
<figure><img src="../fig/docker_life_2.png" alt="Further details and examples of the lifecycle of a container" class="figure mx-auto d-block"></figure><p>In Example 1 we have an entrypoint of <code>echo</code> and a command
of <code>hello world</code>. When the container is run, the command will
be <code>echo Hello World!</code> and the container will print
<code>Hello World!</code>.</p>
<p>In Example 2 we have an entrypoint of <code>sleep</code> and a
command of <code>infinity</code>. When the container is run, the command
will be <code>sleep infinity</code> and the container will run
indefinitely, similar to how services run!</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="running">Running<a class="anchor" aria-label="anchor" href="#running"></a>
</h2>
<hr class="half-width">
<p>Now that we have the image, and we know what it will do, let’s run
it!</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">docker</span> run spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
            \
             \
              \\
               \\\
                &gt;\/7
            _.-(º   \
           (=___._/` \            ____  ____  _    _  ____
                )  \ |\          / ___||  _ \| |  | |/ ___|
               /   / ||\         \___ \| |_) | |  | | |
              /    &gt; /\\\         ___) |  __/| |__| | |___
             j    &lt; _\           |____/|_|    \____/ \____|
         _.-' :      ``.
         \ r=._\        `.       Space Purple Unicorn Counter
        &lt;`\\_  \         .`-.
         \ r-7  `-. ._  ' .  `\
          \`,      `-.`7  7)   )
           \/         \|  \'  / `-._
                      ||    .'
                       \\  (
                        &gt;\  &gt;
                    ,.-' &gt;.'
                   &lt;.'_.''
                     &lt;'


Welcome to the Space Purple Unicorn Counter!

:::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::

:: Try recording a unicorn sighting with:
    curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100

:: No plugins detected</code></pre>
</div>
<p>And there we have it! The SPUC container is running and ready to
count unicorns. What we are seeing now is the equivalent of the ‘Logs’
tab in Docker Desktop.</p>
<p>The only problem we have though, is that it is ‘blocking’ this
terminal, so we can’t run any more commands until we stop the
container.</p>
<p>Let’s stop the container using <code>[Ctrl+C]</code>, and run it
again, but in the background, ‘detached’ from the terminal, using the
<code>-d</code> flag:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0bb79cbb589652c265552913f6de7992cd996f6da97ecc9ba43672fe34ff5f23</code></pre>
</div>
<p><strong>Note:</strong> The <code>-d</code> flag needs to go in front
of the image name!</p>
<p>But what is happening? We can’t see the output of the container
anymore! Is the container running or not?</p>
</section><section><h2 class="section-heading" id="listing-containers">Listing Containers<a class="anchor" aria-label="anchor" href="#listing-containers"></a>
</h2>
<hr class="half-width">
<p>To see what is happening, we can use the <code>docker ps</code>
command:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">docker</span> ps</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CONTAINER ID   IMAGE                  COMMAND                  CREATED              STATUS              PORTS        NAMES
0bb79cbb5896   spuacv/spuc:latest     "python /spuc/spuc.p…"   About a minute ago   Up About a minute   8321/tcp     ecstatic_nightingale</code></pre>
</div>
<p>This command lists all the containers that are currently running. It
is the equivalent of the ‘Containers’ tab in Docker Desktop, except that
it only shows running containers. You can see that the SPUC container is
running, and that it has been given a random name
<code>ecstatic_nightingale</code>.</p>
<p>If you want to see all containers, including those that are stopped,
you can use the <code>-a</code> flag:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">docker</span> ps <span class="at">-a</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CONTAINER ID   IMAGE                  COMMAND                  CREATED              STATUS                       PORTS        NAMES
0bb79cbb5896   spuacv/spuc:latest     "python /spuc/spuc.p…"   About a minute ago   Up About a minute            8321/tcp     ecstatic_nightingale
03ef43deee20   spuacv/spuc:latest     "python /spuc/spuc.p…"   10 minutes ago       Exited (0) 10 minutes ago                 suspicious_beaver</code></pre>
</div>
</section><section><h2 class="section-heading" id="logs">Logs<a class="anchor" aria-label="anchor" href="#logs"></a>
</h2>
<hr class="half-width">
<p>So we know it is running, but we can’t see the output of the
container. We can still access them though, we just need to ask Docker
for the logs:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">docker</span> logs ecstatic_nightingale</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
            \
             \
              \\
               \\\
                &gt;\/7
            _.-(º   \
           (=___._/` \            ____  ____  _    _  ____
                )  \ |\          / ___||  _ \| |  | |/ ___|
               /   / ||\         \___ \| |_) | |  | | |
              /    &gt; /\\\         ___) |  __/| |__| | |___
             j    &lt; _\           |____/|_|    \____/ \____|
         _.-' :      ``.
         \ r=._\        `.       Space Purple Unicorn Counter
        &lt;`\\_  \         .`-.
         \ r-7  `-. ._  ' .  `\
          \`,      `-.`7  7)   )
           \/         \|  \'  / `-._
                      ||    .'
                       \\  (
                        &gt;\  &gt;
                    ,.-' &gt;.'
                   &lt;.'_.''
                     &lt;'


Welcome to the Space Purple Unicorn Counter!

:::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::

:: Try recording a unicorn sighting with:
    curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100</code></pre>
</div>
<p>Notice that we had to use the name of the container,
<code>ecstatic_nightingale</code>, to get the logs. This is because the
<code>docker logs</code> command requires the name of the
<strong>container</strong> not the <strong>image</strong>.</p>
<p>Great, now that we have a container in the background, lets try to
register a unicorn sighting!</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=100</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>curl: (7) Failed to connect to localhost port 8321 after 0 ms: Couldn't connect to server</code></pre>
</div>
<p>That is right! We need to expose the port to the host machine, as we
did in Docker Desktop.</p>
</section><section><h2 class="section-heading" id="exposing-ports">Exposing ports<a class="anchor" aria-label="anchor" href="#exposing-ports"></a>
</h2>
<hr class="half-width">
<p>The container is running in its own isolated environment. To be able
to communicate with it, we need to tell Docker to expose the port to the
host machine.</p>
<p>This can be done using the <code>-p</code> flag. We also need to
specify the port to be used on the host machine and the port to expose
on the container, like so:</p>
<pre><code>-p &lt;host_port&gt;:&lt;container_port&gt;</code></pre>
<p>In this case we want to expose port 8321 on the host machine to port
8321 on the container:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">-p</span> 8321:8321 spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>6edf9ebd404625541fdb674d1a696707bad775a0161882ef459c5cbcb151e24b</code></pre>
</div>
<p>If you now look at the container that is running, you will see that
the port is exposed:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">docker</span> ps</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CONTAINER ID   IMAGE               COMMAND                  CREATED         STATUS         PORTS                                       NAMES
6edf9ebd4046   spuacv/spuc:latest  "python /spuc/spuc.p…"   4 seconds ago   Up 3 seconds   0.0.0.0:8321-&gt;8321/tcp, :::8321-&gt;8321/tcp   unruffled_noyce</code></pre>
</div>
<p>So we can finally try to register a unicorn sighting:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=100</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span></code></pre>
</div>
<p>And of course we can check the logs if we want to:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">docker</span> logs unruffled_noyce</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]

::::: 2024-10-15 11:19:47.751212 Unicorn spotted at moon!! Brightness: 100 iuhc</code></pre>
</div>
<p>It can be quite inconvenient to have to find out the name of the
container every time we want to see the logs, and it is not the only
time in which we’ll need the name of the container to interact with it.
We can make our lives easier by naming the container when we run it.</p>
</section><section><h2 class="section-heading" id="setting-the-name-of-a-container">Setting the name of a container<a class="anchor" aria-label="anchor" href="#setting-the-name-of-a-container"></a>
</h2>
<hr class="half-width">
<p>We can name the container when we run it using the
<code>--name</code> flag:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>4696d5301a792451f9954ba10cc42604a904fa1a811362733050ba04270c02eb
docker: Error response from daemon: driver failed programming external
connectivity on endpoint spuc_container (67e075648d16fafdf086573169d891bee9b33bec0c1cb5535cf82c715241bb32):
 Bind for 0.0.0.0:8321 failed: port is already allocated.</code></pre>
</div>
<p>Oops! It looks like we already have a container running on port 8321.
Of course, it is the container that we ran earlier, unruffled_noyce, and
we can’t have two containers running on the same port!</p>
<p>To fix this, we can stop and remove the container that is running on
port 8321 using the <code>docker stop</code> command:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">docker</span> stop unruffled_noyce</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="ex">docker</span> rm unruffled_noyce</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">unruffled_noyce</span></span>
<span><span class="va">unruffled_noyce</span></span></code></pre>
</div>
<div id="killing-containers" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="killing-containers" class="callout-inner">
<h3 class="callout-title">Killing containers</h3>
<div class="callout-content">
<p>Using <code>docker kill &lt;container_name&gt;</code>, will
immediately stop a container. This is usually recommended against as a
standard, and should be left as a last resort. However, in practice it
is very often used.</p>
<p>The SPUC container, in particular, responds very slowly to the
<code>stop</code> signal, so we will use <code>kill</code> going
forward. Try it with the other container we left running in the
background:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="ex">docker</span> kill ecstatic_nightingale</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">ecstatic_nightingale</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>Right, now we can try running the container again:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">bf9b2abc95a7c7f25dc8c1c4c334fcf4ce9642754ed7f6b5586d82f9e9e45ac7</span></span></code></pre>
</div>
<p>And now we can see the logs using the name of the container, and even
follow the logs in real time using the <code>-f</code> flag:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="ex">docker</span> logs <span class="at">-f</span> spuc_container</span></code></pre>
</div>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Logs
  </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler2" aria-labelledby="headingSpoiler2">
<div class="accordion-body">
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
            \
             \
              \\
               \\\
                &gt;\/7
            _.-(º   \
           (=___._/` \            ____  ____  _    _  ____
                )  \ |\          / ___||  _ \| |  | |/ ___|
               /   / ||\         \___ \| |_) | |  | | |
              /    &gt; /\\\         ___) |  __/| |__| | |___
             j    &lt; _\           |____/|_|    \____/ \____|
         _.-' :      ``.
         \ r=._\        `.       Space Purple Unicorn Counter
        &lt;`\\_  \         .`-.
         \ r-7  `-. ._  ' .  `\
          \`,      `-.`7  7)   )
           \/         \|  \'  / `-._
                      ||    .'
                       \\  (
                        &gt;\  &gt;
                    ,.-' &gt;.'
                   &lt;.'_.''
                     &lt;'


Welcome to the Space Purple Unicorn Counter!

:::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::

:: Try recording a unicorn sighting with:
    curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100
</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>This also blocks the terminal, so you will need to use
<code>[Ctrl+C]</code> to stop following the logs. There is an important
difference though. Because the container is running in the background,
using <code>[Ctrl+C]</code> will not stop the container, only the log
following.</p>
</section><section><h2 class="section-heading" id="executing-commands-in-a-running-container">Executing commands in a running container<a class="anchor" aria-label="anchor" href="#executing-commands-in-a-running-container"></a>
</h2>
<hr class="half-width">
<p>One of the very useful things we could do in docker compose was to
run commands inside a container. If you remember, we could do this using
the <code>Exec</code> tab. In the Docker CLI, we can do this using the
<code>docker exec</code> command. Lets try for example:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="ex">docker</span> exec spuc_container cat config/print.config</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># This file configures the print output to the terminal.
# Available variables are: count, time, location, brightness, units
# The values of these variables will be replaced if wrapped in curly braces.
# Lines beginning with # are ignored.
::::: {time} Unicorn spotted at {location}!! Brightness: {brightness} {units}</code></pre>
</div>
<p>This command runs <code>cat config/print.config</code> inside the
container. This is a step forward, but it is not quite the experience we
had in Docker Desktop. There, we had a live terminal <em>inside</em> the
container, and we could run commands interactively.</p>
<p>To do that, we need to use the <code>-it</code> flag, and specify a
command that will load the terminal, i.e. <code>bash</code>. Let’s try
launching an interactive terminal session inside the container, running
the bash shell:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> spuc_container bash</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>root@50159dddde44:/spuc#</code></pre>
</div>
<p>This is more like it! now we can run commands as if we were inside
the container itself, as we did in Docker Desktop.</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="ex">apt</span> update</span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="ex">apt</span> install tree</span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a><span class="ex">tree</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]

.
├── __pycache__
│   └── strings.cpython-312.pyc
├── config
│   └── print.config
├── output
├── requirements.txt
├── spuc.py
└── strings.py

4 directories, 5 files</code></pre>
</div>
<p>To get out from this interactive session, we need to use
<code>[Ctrl+D]</code>, or type <code>exit</code>.</p>
<div id="interactive-sessions" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="interactive-sessions" class="callout-inner">
<h3 class="callout-title">Interactive sessions</h3>
<div class="callout-content">
<p>The <code>-it</code> flag that we just used is very useful. It
actually helps us overcome the problem we had with the
<code>alpine</code> container in the previous episode. If we were to
simply run the <code>alpine</code> container we would have the same
issue we had before. Namely, the container exits immediately and we
can’t <code>exec</code> into it. However, we can use the
<code>-it</code> flag on the <code>run</code> command, and get an
interactive terminal session inside the container:</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> alpine:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Unable to find image 'alpine:latest' locally
latest: Pulling from library/alpine
43c4264eed91: Pull complete
Digest: sha256:beefdbd8a1da6d2915566fde36db9db0b524eb737fc57cd1367effd16dc0d06d
Status: Downloaded newer image for alpine:latest
/ #</code></pre>
</div>
<p>We are inside the container, and it stayed alive because we are
running an interactive session. We can play inside as much as we want,
and when we are done, we can simply type <code>exit</code> to leave the
container. As opposed to the <code>spuc</code> container, which was
running a service and we exec’ed into, this container will be terminated
on exit.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="reviving-containers">Reviving Containers<a class="anchor" aria-label="anchor" href="#reviving-containers"></a>
</h2>
<hr class="half-width">
<p>Another thing Docker Desktop allowed us to do was to wake up a
previously stopped container. We can of course do the same thing in the
Docker CLI.</p>
<p>To show this, lets first stop the container we have running:</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="ex">docker</span> kill spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">spuc_container</span></span></code></pre>
</div>
<p>To <em>revive</em> the container, we can use the
<code>docker start</code> command:</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="ex">docker</span> start spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">spuc_container</span></span></code></pre>
</div>
<p>We could now check that the container is running again using the
<code>docker ps</code> command. However, lets try another useful
command:</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="ex">docker</span> stats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CONTAINER ID   NAME              CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O        PIDS
bf9b2abc95a7   spuc_container    0.01%     23.61MiB / 15.29GiB   0.15%     23.6kB / 589B     5.1MB / 201kB    5</code></pre>
</div>
<p>This command lets us see the live resource usage of containers,
similar to the task manager on Windows or top on Linux. We can exit the
stats with <code>[Ctrl+C]</code>.</p>
<p>As we can see, the container is alive and well, and we can now exec
into it again if we want to.</p>
</section><section><h2 class="section-heading" id="cleaning-up">Cleaning up<a class="anchor" aria-label="anchor" href="#cleaning-up"></a>
</h2>
<hr class="half-width">
<p>The last thing we need to know is how to clean up after ourselves. We
have already removed a container using the <code>docker rm</code>
command, and we can use the <code>docker image rm</code> command to
remove an image:</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="ex">docker</span> kill spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">spuc_container</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="ex">docker</span> rm spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">spuc_container</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="ex">docker</span> image rm spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Untagged: spuacv/spuc:latest
Untagged: spuacv/spuc@sha256:ad219064aaaad76860c53ec8420730d69dc5f8beb9345b0a15176111c2a976c5
Deleted: sha256:ce72bd42e51c049fe29b4c15dc912e88c4461e94c2e1d403b90e2e53dfb1b420
Deleted: sha256:975e4f6d3de315ced48fa0d0eda7e3af5cd4953c16adfbd443e65d6d2bf0eaa6
Deleted: sha256:f3fc2c0e51d4240d55e40b0305762df66600cdd5073a5c92008cfe8f867f5437
Deleted: sha256:f3e2fffff5c16237e6507a6196eb76fd2eba64e343c3a1b2692b73b95fcd1298
Deleted: sha256:d4d3e0d103c04b9fd2eb428699c46302a3d38d695729ee49068be07ad7e5c442
Deleted: sha256:700c7bb1865e2ca492d821c689f11175c66e9d27f210b3f04521040290c34126
Deleted: sha256:5d5adb77457c9a495a5037ce44a0db461b8d3b605177a2c3bc6dc0d7876a681d
Deleted: sha256:3a77b40519ce3ffa585333bab02f30371b4c8c7ffa10a35fd4c82a0d3423fa91
Deleted: sha256:791eb7562f83ac1fc48aa6f31129bf947d7de7d8c9b85db92131c3beb5650bd6
Deleted: sha256:c59180f9a5f41ea7e3d92ee36d5b4c01dadf5148075c0d01c394f7efc321a3ca
Deleted: sha256:8d853c8add5d1e7b0aafc4b68a3d9fb8e7a0da27970c2acf831fe63be4a0cd2c</code></pre>
</div>
<p>An alternative is to do a single-line full clean up. We can also
remove all stopped containers and unused images using the
<code>docker system prune</code> command:</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="ex">docker</span> system prune</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARNING! This will remove:
  - all stopped containers
  - all networks not used by at least one container
  - all dangling images
  - unused build cache

Are you sure you want to continue? [y/N] y
Deleted Containers:
90d006980a999176dd82e95119556cdf62431c26147bdbd3513e1733be1a5897

Deleted Images:
untagged: spuacv/spuc@sha256:bc43ebfe7dbdbac5bc0b4d849dd2654206f4e4ed1fb87c827b91be56ce107f2e
deleted: sha256:f03fb04b8bc613f46cc1d1915d2f98dcb6e008ae8e212ae9a3dbfaa68c111476

Total reclaimed space: 13.09MB</code></pre>
</div>
<div class="section level3">
<h3 id="automatic-cleanup">Automatic cleanup<a class="anchor" aria-label="anchor" href="#automatic-cleanup"></a>
</h3>
<p>There is one more point to make. It is nice not to have to clean up
containers manually all the time. Luckily, the Docker CLI has a flag
that will remove the container when it is stopped: <code>--rm</code>.
This can be very useful, especially when you are naming containers, as
it prevents name conflicts.</p>
<p>Lets try it:</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 spuacv/spuc:latest</span></code></pre>
</div>
<p>We can verify that the container exists using <code>docker ps</code>.
When the container is stopped, however, the container is automatically
removed. We don’t have to worry about cleaning up afterwards, but it
comes at a price. Since we’ve deleted the container, there is no way to
bring it back.</p>
<p>We will use the command going forward, as it is a good practice to
keep your system clean and tidy.</p>
<p><br></p>
<p>The last command we ran is a relatively standard command in the
Docker CLI. If you are thinking “wow, that command is getting pretty
long…”, you are right! Things will get even worse before they get
better, but we will cover how to manage this later in the course.</p>
<p>We are now equipped with everything we saw we could do in Docker
Desktop, but with steroids. There are many more things we can do with
the Docker CLI, including data persistance. We will cover these in the
next episode.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>All the commands are structured with a main command, a specialising
command, an action command, and the name of the object to act on.</li>
<li>Everything we did in Docker Desktop (and more!) can be done in the
Docker CLI with:</li>
</ul>
<table class="table">
<colgroup>
<col width="40%">
<col width="59%">
</colgroup>
<thead><tr class="header">
<th>Command</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Images</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>docker pull &lt;image&gt;</code></td>
<td>Pull an image from a registry</td>
</tr>
<tr class="odd">
<td><code>docker image ls</code></td>
<td>List all images on the system</td>
</tr>
<tr class="even">
<td><code>docker inspect &lt;image&gt;</code></td>
<td>Show detailed information about an image</td>
</tr>
<tr class="odd">
<td><code>docker run &lt;image&gt;</code></td>
<td>Run a container from an image</td>
</tr>
<tr class="even">
<td><code>docker image rm &lt;image&gt;</code></td>
<td>Remove an image</td>
</tr>
<tr class="odd">
<td><strong>Containers</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>docker logs &lt;container&gt;</code></td>
<td>Show the logs of a container</td>
</tr>
<tr class="odd">
<td><code>docker exec &lt;container&gt; &lt;cmd&gt;</code></td>
<td>Run a command in a running container</td>
</tr>
<tr class="even">
<td><code>docker stop &lt;container&gt;</code></td>
<td>Stop a running container</td>
</tr>
<tr class="odd">
<td><code>docker kill &lt;container&gt;</code></td>
<td>Immediately stop a running container</td>
</tr>
<tr class="even">
<td><code>docker start &lt;container&gt;</code></td>
<td>Start a stopped container</td>
</tr>
<tr class="odd">
<td><code>docker rm &lt;container&gt;</code></td>
<td>Remove a container</td>
</tr>
<tr class="even">
<td><strong>System</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code>docker ps</code></td>
<td>List all running containers</td>
</tr>
<tr class="even">
<td><code>docker stats</code></td>
<td>Show live resource usage of containers</td>
</tr>
<tr class="odd">
<td><code>docker system prune</code></td>
<td>Remove all stopped containers and unused images</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="12%">
<col width="19%">
<col width="67%">
</colgroup>
<thead><tr class="header">
<th>Flag</th>
<th>Used on</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>-f</code></td>
<td><code>inspect</code></td>
<td>Specify the output format</td>
</tr>
<tr class="even">
<td><code>-f</code></td>
<td><code>logs</code></td>
<td>Follow the logs in real time</td>
</tr>
<tr class="odd">
<td><code>-a</code></td>
<td><code>ps</code></td>
<td>List all containers, including stopped ones</td>
</tr>
<tr class="even">
<td><code>-it</code></td>
<td>
<code>run</code>, <code>exec</code>
</td>
<td>Interactively run a command in a running container</td>
</tr>
<tr class="odd">
<td><code>-d</code></td>
<td><code>run</code></td>
<td>Run a container in the background</td>
</tr>
<tr class="even">
<td><code>-p</code></td>
<td><code>run</code></td>
<td>Expose a port from the container to the host</td>
</tr>
<tr class="odd">
<td><code>--name</code></td>
<td><code>run</code></td>
<td>Name a container</td>
</tr>
<tr class="even">
<td><code>--rm</code></td>
<td><code>run</code></td>
<td>Remove the container when it is stopped</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section></section><section id="aio-docker-volumes"><p>Content from <a href="docker-volumes.html">Sharing information with containers</a></p>
<hr>
<p>Last updated on 2024-12-03 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-volumes.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>Now that we have learned the basics of the Docker CLI, getting set up
with all the tools we came across in Docker Desktop, we can start to
explore the full power of Docker!</p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I save my data?</li>
<li>How do I get information in and out of containers?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to persist and share data with containers using mounts and
volumes</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="making-our-data-persist">Making our data persist<a class="anchor" aria-label="anchor" href="#making-our-data-persist"></a>
</h2>
<hr class="half-width">
<p>In the earlier sections we interacted with the SPUC container and
made changes to the <code>print.config</code> file. We also registered
some unicorn sightings using the API, which were recorded in the
<code>unicorn_sightings.txt</code> file. However, we lost all those
changes when we stopped the container.</p>
<p>Docker containers are naturally isolated from the host system,
meaning that they have their own filesystem, and cannot access the host
filesystem. They are also designed to be temporary, and are destroyed
when they are stopped.</p>
<p>This is mostly a good thing, as it means that containers are
lightweight and can be easily recreated, but we can’t be throwing our
unicorn sightings away like this!</p>
<p>Also, with the file being in the container, we can’t (easily) do much
with it. Luckily, Docker has methods for allowing containers to persist
data.</p>
</section><section><h2 class="section-heading" id="volumes">Volumes<a class="anchor" aria-label="anchor" href="#volumes"></a>
</h2>
<hr class="half-width">
<p>One way to allow a container to access the host filesystem is by
using a <code>volume</code>. A volume is a specially designated
directory hidden away deep in the host filesystem. This directory is
shared with the container.</p>
<p>Volumes are very tightly controlled by Docker. They are designed to
be used for sharing data between containers, or for persisting data
between runs of a container.</p>
<p>Let’s have a look at how we can use a volume to persist the
<code>unicorn_sightings.txt</code> file between runs of the container.
We do this by modifying our <code>run</code> command to include a
<code>-v</code> (for volume) flag, a volume name and a path inside the
container.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">docker</span> kill spuc_container</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> spuc-volume:/spuc/output spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">spuc_container</span></span>
<span><span class="va">f1bd2bb9062348b6a1815f5076fcd1b79e603020c2d58436408c6c60da7e73d2</span></span></code></pre>
</div>
<p>Ok! But what is happening? We can see what containers we have created
using:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">docker</span> volume ls</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>local     spuc-volume</code></pre>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Inspecting the volume </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>We can see more information about the volume using:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">docker</span> volume inspect spuc-volume</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[
    {
        "CreatedAt": "2024-10-11T11:15:09+01:00",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/spuc-volume/_data",
        "Name": "spuc-volume",
        "Options": null,
        "Scope": "local"
    }
]</code></pre>
</div>
<p>Which shows us that the volume is stored in
<code>/var/lib/docker/volumes/spuc-volume/_data</code> on the host
filesystem. You can visit and edit files there if you have superuser
permissions (sudo).</p>
</div>
</div>
</div>
</div>
<p>But what about the container? Has this actually worked?</p>
<p>First… what’s that over there?? A unicorn! No… three unicorns! Let’s
record these sightings.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=100</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=earth\&amp;brightness=10</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=mars\&amp;brightness=400</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span>
<span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span>
<span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span></code></pre>
</div>
<p>Ok, let’s check the sightings file.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">docker</span> exec spuc_container cat /spuc/output/unicorn_sightings.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>count,time,location,brightness,units
1,2024-10-16 09:14:17.719447,moon,100,iuhc
2,2024-10-16 09:14:17.726706,earth,10,iuhc
3,2024-10-16 09:14:17.732191,mars,400,iuhc</code></pre>
</div>
<p>Now, for our test, we will stop the container. Since we used the
<code>-rm</code> flag, the container will also be deleted.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">docker</span> kill spuc_container</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">docker</span> ps <span class="at">-a</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>spuc_container
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</code></pre>
</div>
<p>This would have been game over, but we used a volume. Let’s run it
again and check the sightings file.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> spuc-volume:/spuc/output spuacv/spuc:latest</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="ex">docker</span> exec spuc_container cat /spuc/output/unicorn_sightings.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>536a6d2f73061aa94729df3536ee86b60dcd68f4652bfbdc9e4cfa9c6cfda168
count,time,location,brightness,units
1,2024-10-16 09:14:17.719447,moon,100,iuhc
2,2024-10-16 09:14:17.726706,earth,10,iuhc
3,2024-10-16 09:14:17.732191,mars,400,iuhc</code></pre>
</div>
<p>It’s worked! The unicorn sightings are still there! The only problem
is that the file is still in the container, and we can’t easily access
it from the host filesystem.</p>
</section><section><h2 class="section-heading" id="bind-mounts">Bind mounts<a class="anchor" aria-label="anchor" href="#bind-mounts"></a>
</h2>
<hr class="half-width">
<p>Another way to allow a container to access the host filesystem is by
using a <code>bind mount</code>. A bind mount is a direct mapping of a
specified directory on the host filesystem to a directory in the
container filesystem. This allows you to directly access files on the
host filesystem from the container, but it has its own challenges.</p>
<p>Let’s have a look at how we can use a bind mount to persist the
<code>unicorn_sightings.txt</code> file between runs of the container.
Confusingly, bind mounting is also done using the <code>-v</code> flag.
However, instead of a name for the volume, we have to specify a path on
the host filesystem.</p>
<p><strong>Note:</strong> In older versions of Docker the path had to be
<em>absolute</em>; <em>relative</em> paths are now supported.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">docker</span> kill spuc_container</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./spuc/output:/spuc/output spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>spuc_container
79620ff93fdd8135dcc7f595223144c075a9df53fc32f2ce799ee8e338b9df41</code></pre>
</div>
<p>The directory <code>spuc/output</code> likely did not exist in your
current working directory, so Docker created one. It is currently empty,
as you can see by listing the contents with <code>ls spuc/output</code>.
If we now record a unicorn sighting, we can see the records file in the
directory.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=mercury\&amp;brightness=400</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">cat</span> spuc/output/unicorn_sightings.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{message:"Unicorn sighting recorded!"}
count,time,location,brightness,units
1,2024-10-16 10:31:22.222542,mercury,400,iuhc</code></pre>
</div>
<p>and the file is still there even after stopping the container</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">docker</span> kill spuc_container</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">ls</span> spuc/output</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">spuc_container</span></span>
<span><span class="va">unicorn_sightings.txt</span></span></code></pre>
</div>
<p>If we run the container again, we can see the file is still
there.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./spuc/output:/spuc/output spuacv/spuc:latest</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">cat</span> spuc/output/unicorn_sightings.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>3dd079c21845fc36ddc3b20fd525790a1e194c198c4b98337f4ed82bfc7a9755
count,time,location,brightness,units
1,2024-10-16 10:31:22.222542,mars,400,iuhc</code></pre>
</div>
<p>So we not only managed to persist the data between runs of the
container, but we can also access the file when the container is not
running. This is great!… but there are downsides.</p>
<p>To illustrate this, let’s see what the permissions are on the file we
just created.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> spuc/unicorn_sightings.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-rw-r--r-- 1 root root 57 Oct 11 14:14 spuc/unicorn_sightings.txt</code></pre>
</div>
<p><strong>Note:</strong> This no longer seems to be the case from
Docker version 27.3.1 onwards.</p>
<p>Argh, the file is owned by root! This is because the container runs
as root, and so any files created by the container are owned by root.
This can be a problem, as you will not have permission to access the
file without using <code>sudo</code>.</p>
<p>This is a common problem with bind mounts, and can be a bit of a pain
to deal with. You can change the ownership of the file using
<code>sudo chown</code>, but this can be a bit of a hassle.</p>
<p>Additionally, it is hard for Docker to clean up bind mounts, as they
are not managed by Docker. The management of bind mounts is left to the
user.</p>
<p>Really, neither volumes nor bind mounts are perfect, but they are
both useful tools for persisting data between runs of a container.</p>
<div class="section level3">
<h3 id="bind-mount-files">Bind mount files<a class="anchor" aria-label="anchor" href="#bind-mount-files"></a>
</h3>
<p>Earlier, we looked at how to change the print.config file in SPUC to
format the logs. This was a bit difficult, as we had to do it from
inside the container, and it did not persist between runs of the
container.</p>
<p>We now have the tools to address this! We can use a bind mount to
share the config file with the container.</p>
<p>First we need to make the config file itself. Let’s create a file
with the following content:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"::::: {time} Unicorn number {count} spotted at {location}! Brightness: {brightness} {units}"</span> <span class="op">&gt;</span> print.config</span></code></pre>
</div>
<p>Now, to share it with the container, we need to put it in the path
<code>/spuc/config/print.config</code>. Again we will use
<code>-v</code>, but we will specify the path to the file, instead of a
directory.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">docker</span> kill spuc_container</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./print.config:/spuc/config/print.config <span class="at">-v</span> spuc-volume:/spuc/output spuacv/spuc:latest</span></code></pre>
</div>
<p>Now let’s check if this worked. For that, we need to record another
sighting and then check the logs.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=jupyter\&amp;brightness=210</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="ex">docker</span> logs spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{"message":"Unicorn sighting recorded!"}
[...]
::::: 2024-10-16 10:53:13.449393 Unicorn number 4 spotted at jupyter! Brightness: 210 iuhc</code></pre>
</div>
<p>Fantastic! We have now managed to share a file with the container.
Not only that, but because we created the file before mounting it to the
container, we are the owners, and can modify it. Changes to the file
will reflect immediately on the container.</p>
<p>For example, let’s edit the file to get rid of the date:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"::::: Unicorn number {count} spotted at {location}! Brightness: {brightness} {units}"</span> <span class="op">&gt;</span> print.config</span></code></pre>
</div>
<p>Now let’s register a sighting, and look at the logs:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=venus\&amp;brightness=148</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="ex">docker</span> logs spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{"message":"Unicorn sighting recorded!"}
[...]
::::: Unicorn number 5 spotted at venus! Brightness: 148 iuhc</code></pre>
</div>
<p>It almost seems too easy!</p>
<p><strong>Warning</strong>: We <em>replaced</em> the file in the
container with the file from the host filesystem. We could do the same
with a whole directory, but be careful not to overwrite important files
in the container!</p>
<div id="common-mistakes-with-volumes" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="common-mistakes-with-volumes" class="callout-inner">
<h3 class="callout-title">Common mistakes with volumes</h3>
<div class="callout-content">
<p>You have to be <em>really</em> careful with the syntax for volumes
and mounts.</p>
<p>Let’s imagine you are in a path containing a directory
<code>spuc</code>, with an empty sub-directory <code>output</code> and a
<code>print.config</code> file. What do you think will happen when you
run the following commands?</p>
<ol style="list-style-type: upper-alpha">
<li><code>docker run -v spuc-vol spuacv/spuc:latest</code></li>
<li><code>docker run -v ./spucs/output:/spuc/output spuacv/spuc:latest</code></li>
<li><code>docker run -v ./spuc-vol:/spuc/output spuacv/spuc:latest</code></li>
<li><code>docker run -v ./spuc:/spuc spuacv/spuc:latest</code></li>
<li><code>docker run -v print.config:/spuc/config/print.config spuacv/spuc:latest</code></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: upper-alpha">
<li><p><strong>Problem:</strong> We provided a volume name, but not a
path to mount it to. If the volume already existed, this will mount it
on <code>/spuc-vol</code>. If the volume did not exist, it will create a
directory <code>/spuc-vol</code> in the container, but it wont
persist!<br><strong>Fix:</strong> You only messed up the container, nothing to worry
about. Stop it and try again.</p></li>
<li><p><strong>Problem:</strong> You misspelled the path! This will
create a new directory called spuc<strong>s</strong> and mount it.<br><strong>Fix:</strong> Use <code>sudo rm -rf ./spucs</code> to remove the
directory and try again.</p></li>
<li><p><strong>Problem:</strong> At first, it seems like we will create
a volume. However, we have provided a path, not a name for the volume.
Therefore, Docker thinks you want a bind mount, and will create a (root
owned) directory called <code>spuc-vol</code>.<br><strong>Fix:</strong> Use <code>sudo rm -rf ./spuc-volume</code> to
remove the directory and try again.</p></li>
<li><p><strong>Problem:</strong> This is valid syntax for a bind mount.
It will take the almost empty <code>spuc</code> directory in your
filesystem and mount it to <code>/spuc</code> in the container. However,
it replaced everything in there in the process! Your command most likely
failed because it could not find <code>/spuc/spuc.py</code>.<br><strong>Fix:</strong> You only messed up the container, nothing to worry
about. Try again.</p></li>
<li><p><strong>Problem:</strong> We forgot to use a path for the file!
This will try to create a new volume called <code>print.config</code>
and mount it to <code>/spuc/config/print.config</code>. However, it will
most likely fail because <code>print.config</code> is not a
directory.<br><strong>Fix:</strong> Use <code>docker volume rm print.config</code> to
remove the volume and try again.</p></li>
</ol>
</div>
</div>
</div>
</div>
<p>We now have a print configuration and unicorn sighting record that
persists between runs of the container.</p>
<p>It seems like we have everything we need to run the Space Purple
Unicorn Counter! Or is there anything else we should do? Lets have a
look at the docs!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Volumes and bind mounts help us persist and share data with
containers.</li>
<li>The syntax for both is very similar, but they have different use
cases:
<ul>
<li>
<strong>Volumes</strong> are managed by Docker. They are best for
persisting data you do not need to access.
<code>docker run -v &lt;volume_name&gt;:&lt;path_in_container&gt; image</code>
</li>
<li>
<strong>Bind mounts</strong> are managed by the user. They are best
for passing data to the container.
<code>docker run -v &lt;path_on_host&gt;:&lt;path_in_container&gt; image</code>
</li>
</ul>
</li>
<li>They both overwrite files in the container, and have their own
challenges.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-docker-hub"><p>Content from <a href="docker-hub.html">The Docker Hub</a></p>
<hr>
<p>Last updated on 2024-12-03 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-hub.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>So we want to look at the docs for a container image, but we don’t
want Docker Desktop anymore! Where do the docs live? Actually, they were
never part of Docker Desktop, they are part of the Docker Hub!</p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is the Docker Hub, and why is it useful?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explore the Docker Hub webpage.</li>
<li>Identify the three components of a container image’s
identifier.</li>
<li>Access the readme and other metadata of a container image.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introducing-the-docker-hub">Introducing the Docker Hub<a class="anchor" aria-label="anchor" href="#introducing-the-docker-hub"></a>
</h2>
<hr class="half-width">
<p>The Docker Hub is an online repository of container images, a vast
number of which are publicly available. A large number of the container
images are curated by the developers of the software that they package.
Also, many commonly used pieces of software that have been containerized
into images are officially endorsed, which means that you can trust the
container images to have been checked for functionality, stability, and
that they don’t contain malware.</p>
<div id="docker-can-be-used-without-connecting-to-the-docker-hub" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="docker-can-be-used-without-connecting-to-the-docker-hub" class="callout-inner">
<h3 class="callout-title">Docker can be used without connecting to the Docker Hub</h3>
<div class="callout-content">
<p>Note that while the Docker Hub is well integrated into Docker
functionality, the Docker Hub is certainly not required for all types of
use of Docker containers. For example, some organizations may run
container infrastructure that is entirely disconnected from the
Internet.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="exploring-an-example-docker-hub-page">Exploring an example Docker Hub page<a class="anchor" aria-label="anchor" href="#exploring-an-example-docker-hub-page"></a>
</h2>
<hr class="half-width">
<p>The reason we are here is to find the documentation for the SPUC
container image. Lets go ahead and find the image we need for
registering our unicorn sightings.</p>
<p>Open your web browser to <a href="https://hub.docker.com" class="external-link">https://hub.docker.com</a></p>
<figure><img src="../fig/docker-hub/01_dockerhub_landing.png" alt="Dockerhub_landing" class="figure mx-auto d-block"></figure><p>In the search bar type “spuc” and hit enter.</p>
<figure><img src="../fig/docker-hub/02_search_spuc_h.png" alt="Dockerhub_search" class="figure mx-auto d-block"></figure><p>You should see a list of images related to spuc and, amongst them,
the one we were directed to. Lets go ahead and select the <a href="https://hub.docker.com/r/spuacv/spuc" class="external-link">spuacv/spuc</a> container
image.</p>
<figure><img src="../fig/docker-hub/03_spuc.png" alt="Dockerhub_spuc" class="figure mx-auto d-block"></figure><p>This is a fairly standard docker repository page. The page is divided
into several sections:</p>
<p>The top provides information about the name, endorsements, creator, a
short description, tags, and popularity (i.e. how many downloads it
has).</p>
<p>The top-right provides the command to pull this container image to
your computer.</p>
<p>The main body of the page contains two tabs, one with the overview,
and another with the tags.</p>
<p>The overview tab contains the documentation of the container image.
This is what we wanted!</p>
<p>Since we are here though, lets also look at the tags tab.</p>
<p>The tags tab contains the list of versions of the container image. A
single repository can have many different versions of container images.
These versions are indicated by “tags”.</p>
<p>If we select the “Tags” tab, we can see the list of tags for this
container image.</p>
<figure><img src="../fig/docker-hub/04_spuc_tags.png" alt="Dockerhub_spuc_tags" class="figure mx-auto d-block"></figure><p>If we click the version tag for <code>latest</code> of this image,
Docker Hub shows it as <code>spuacv/spuc:latest</code>.</p>
<p>This name structure is the full identifier of the container image and
consists of three parts:</p>
<pre><code><span><span class="va">OWNER</span><span class="op">/</span><span class="va">REPOSITORY</span><span class="op">:</span><span class="va">TAG</span></span></code></pre>
<p>The <code>REPOSITORY</code> is what we would commonly refer to as the
name of the container image.</p>
<p>The <code>latest</code> tag is actually the default, and it is used
if no tag is specified.</p>
<p><strong>Note:</strong> The <code>latest</code> tag is not always the
most recent version of the software. Tags are actually just labels, and
the <code>latest</code> tag is just a convention.</p>
<p>You may also have noticed that there are a lot more details about the
container image in the page.</p>
<figure><img src="../fig/docker-hub/05_spuc_latest.png" alt="Dockerhub_spuc_latest" class="figure mx-auto d-block"></figure><p>In particular, we can see the image layers, which describe in part
how the image was created. This is a very useful feature for
understanding what is in the image and evaluating its security.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Official Images
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>Some images on Docker Hub are “official images,” which means that
they are endorsed by the Docker team.</p>
<p>You can see this, for example, with the Python official image.</p>
<p>In the search box, type “python” and hit enter.</p>
<p>You should see a list of images related to python. We can immediately
get a feel of the sheer number of container images hosted here. There is
upwards from 10,000 images related to python alone.</p>
<p>Select the top result, which is the endorsed <a href="https://hub.docker.com/_/python" class="external-link">python</a> container image.</p>
<p>The “official” badge is shown on the top right of the repository.</p>
<figure><img src="../fig/docker-hub/06_python_h.png" alt="Dockerhub_python" class="figure mx-auto d-block"></figure><p>Another thing you may have noticed is that the “owner” of the image
is not shown. This is only true for official images, so instead of
<code>OWNER/CONTAINER_IMAGE_NAME:TAG</code>, the name is just
<code>CONTAINER_IMAGE_NAME:TAG</code>.</p>
</div>
</div>
</div>
</div>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Choosing Container Images on Docker Hub
  </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<p>Note that anyone can create an account on Docker Hub and share
container images there, so it’s important to exercise caution when
choosing a container image on Docker Hub. These are some indicators that
a container image on Docker Hub is consistently maintained, functional
and secure:</p>
<ul>
<li>The container image is updated regularly.</li>
<li>The container image associated with a well established company,
community, or other group that is well-known. Docker helps with badges
to mark official images, verified publishers and sponsored open source
software.</li>
<li>There is a Dockerfile or other listing of what has been installed to
the container image.</li>
<li>The container image page has documentation on how to use the
container image.</li>
<li>The container image is used by the wider community. The graph on the
right at the search page can help with this.</li>
</ul>
<p>If a container image is never updated, created by a random person,
and does not have a lot of metadata, it is probably worth skipping
over.</p>
</div>
</div>
</div>
</div>
<div id="accordionSpoiler3" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler3" aria-expanded="false" aria-controls="collapseSpoiler3">
  <h3 class="accordion-header" id="headingSpoiler3">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Other sources of Container Images
  </h3>
</button>
<div id="collapseSpoiler3" class="accordion-collapse collapse" aria-labelledby="headingSpoiler3" data-bs-parent="#accordionSpoiler3">
<div class="accordion-body">
<p>Although many of the containers made for docker are hosted in the
Docker Hub, there are other places where these can be distributed,
including (but not limited to):</p>
<ul>
<li>
<a href="https://github.com/features/packages" class="external-link">GHCR</a> from
Github.</li>
<li>
<a href="https://quay.io/" class="external-link">Quay</a> from Red Hat.</li>
<li>
<a href="https://cloud.google.com/artifact-registry" class="external-link">Artifact
Registry</a> from Google.</li>
<li>
<a href="https://docs.gitlab.com/ee/user/packages/container_registry/" class="external-link">GLR</a>
from GitLab.</li>
<li>
<a href="https://aws.amazon.com/ecr/" class="external-link">ECR</a> from Amazon.</li>
<li>
<a href="https://azure.microsoft.com/en-us/products/container-registry" class="external-link">ACR</a>
from Azure, Microsoft.</li>
</ul>
</div>
</div>
</div>
</div>
<p>So we found our documentation, lets have a careful read through.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The Docker Hub is an online repository of container images.</li>
<li>The repositories include the container image documentation.</li>
<li>Container images may have multiple versions, indicated by tags.</li>
<li>The naming convention for Docker container images is:
<code>OWNER/CONTAINER_IMAGE_NAME:TAG</code>
</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-docker-run-configuration"><p>Content from <a href="docker-run-configuration.html">Configuring containers</a></p>
<hr>
<p>Last updated on 2024-12-03 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-run-configuration.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>Well this is interesting! The documentation for the SPUC container
tells us that we can set an environment variable to enable an API
endpoint for exporting the unicorn sightings. It also mentions that we
can pass a parameter to change the units of the brightness of the
unicorns. But how can we do this?</p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I set environment variables in a container?</li>
<li>How can I pass parameters to a container?</li>
<li>How can I override the default command and entrypoint of a
container?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to configure environment variables and parameters in
containers</li>
<li>Learn how to override the default command and entrypoint of a
container</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="setting-the-environment">Setting the environment<a class="anchor" aria-label="anchor" href="#setting-the-environment"></a>
</h2>
<hr class="half-width">
<p>We know we have to modify the environment variable
<code>EXPORT</code> and set it to <code>True</code>. This should enable
an API endpoint for exporting the unicorn sightings.</p>
<p>This sounds like a useful feature, but how can we set an environment
variable in a container? Thankfully this is quite straightforward, we
can use the <code>-e</code> flag to set an environment variable in a
container.</p>
<p>Lets modifying our run command again:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">docker</span> stop spuc_container</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./print.config:/spuc/config/print.config <span class="at">-v</span> spuc-volume:/spuc/output <span class="at">-e</span> EXPORT=true spuacv/spuc:latest</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">docker</span> logs spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
Welcome to the Space Purple Unicorn Counter!

:::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::

:: Try recording a unicorn sighting with:
    curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100

:: No plugins detected

:::: Unicorn sightings export activated! ::::
:: Try downloading the unicorn sightings record with:
    curl localhost:8321/export</code></pre>
</div>
<p>And now we can see that the export endpoint is available! Lets try it
out!</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">curl</span> localhost:8321/export</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>count,time,location,brightness,units
1,2024-10-16 09:14:17.719447,moon,100,iuhc
2,2024-10-16 09:14:17.726706,earth,10,iuhc
3,2024-10-16 09:14:17.732191,mars,400,iuhc
4,2024-10-16 10:53:13.449393,jupyter,210,iuhc
5,2024-10-16 12:53:51.726902,venus,148,iuhc</code></pre>
</div>
<p>This is great! No need to bind mount or exec to get the data out of
the container, we can just use the API endpoint.</p>
<p>Defaulting to network style connections is very common in Docker
containers and saves a lot of hassle.</p>
<p>Environment variables are a very common tool for configuring
containers. They are used to set things like API keys, database
connection strings, and other configuration options.</p>
</section><section><h2 class="section-heading" id="passing-parameters-overriding-the-command">Passing parameters (overriding the command)<a class="anchor" aria-label="anchor" href="#passing-parameters-overriding-the-command"></a>
</h2>
<hr class="half-width">
<p>In some other cases, parameters are passed to the container to
configure its behaviour. This is the case for the brightness units in
the SPUC container.</p>
<p>It is actually probably the first change you’d want to do to this
particular container. It is recording the brightness of the unicorns in
<em>Imperial Unicorn Hoove Candles</em> (iuhc)! This is a very outdated
unit and we <strong>must</strong> change it to the much more standard
<em>Intergalactic Unicorn Luminosity Units</em> (iulu).</p>
<p>Fortunately the SPUC documentations tells us that we can pass a
parameter to the container to set these units right. If we look
carefully at the entrypoint and command of the container, we can see
that the default units are set to <code>iuhc</code> there:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">docker</span> inspect spuacv/spuc:latest <span class="at">-f</span> <span class="st">"Entrypoint: {{.Config.Entrypoint}}\nCommand: {{.Config.Cmd}}"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Entrypoint: [python /spuc/spuc.py]
Command: [--units iuhc]</code></pre>
</div>
<p>What we have to do, then, is to override the <em>Command</em> part of
the default command. This is actually a very common thing to do when
running containers. It is done by passing a parameter at the end of our
<code>run</code> command, after the image name:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">docker</span> stop spuc_container</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./print.config:/spuc/config/print.config <span class="at">-v</span> spuc-volume:/spuc/output <span class="at">-e</span> EXPORT=true spuacv/spuc:latest <span class="at">--units</span> iulu</span></code></pre>
</div>
<p>if we now register some unicorn sightings, we should see the
brightness in iulu units.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=pluto\&amp;brightness=66</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">curl</span> localhost:8321/export</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>count,time,location,brightness,units
1,2024-10-16 09:14:17.719447,moon,100,iuhc
2,2024-10-16 09:14:17.726706,earth,10,iuhc
3,2024-10-16 09:14:17.732191,mars,400,iuhc
4,2024-10-16 10:53:13.449393,jupyter,210,iuhc
5,2024-10-16 12:53:51.726902,venus,148,iuhc
6,2024-10-16 13:14:17.719447,pluto,66,iulu</code></pre>
</div>
<p>We can already feel the weight lifting off our shoulders already! But
we cannot mix iuhcs with iulus, so lets remove the volume and
re-register our sightings with the correct units</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">docker</span> stop spuc_container</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="ex">docker</span> volume rm spuc-volume</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./print.config:/spuc/config/print.config <span class="at">-v</span> spuc-volume:/spuc/output <span class="at">-e</span> EXPORT=true spuacv/spuc:latest <span class="at">--units</span> iulu</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=177</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=earth\&amp;brightness=18</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=mars\&amp;brightness=709</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=jupyter\&amp;brightness=372</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=venus\&amp;brightness=262</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=pluto\&amp;brightness=66</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="ex">curl</span> localhost:8321/export</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>count,time,location,brightness,units
1,2024-10-16 13:15:03.719371,moon,177,iulu
2,2024-10-16 13:15:03.719398,earth,18,iulu
3,2024-10-16 13:15:03.719410,mars,709,iulu
6,2024-10-16 13:15:03.719425,jupyter,372,iulu
5,2024-10-16 13:15:03.719437,venus,262,iulu
6,2024-10-16 13:15:03.719447,pluto,66,iulu</code></pre>
</div>
<p>Finally, we have the correct units for the brightness of the
unicorns!</p>
</section><section><h2 class="section-heading" id="overriding-the-entrypoint">Overriding the entrypoint<a class="anchor" aria-label="anchor" href="#overriding-the-entrypoint"></a>
</h2>
<hr class="half-width">
<p>We can also override the entrypoint of a container using the
<code>--entrypoint</code> flag. This is useful if you want to run a
different command in the container, or if you want to run the container
interactively.</p>
<p>SPUC has an entrypoint of <code>python /spuc/spuc.py</code> making it
hard to interact with. We can override this using the
<code>--entrypoint</code> flag.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--rm</span> <span class="at">--entrypoint</span> /bin/sh spuacv/spuc:latest</span></code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Which of these are valid entrypoint and command combinations for the
SPUC container? What are the advantages and disadvantages of each?</p>
<table class="table">
<colgroup>
<col width="3%">
<col width="48%">
<col width="48%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>Entrypoint</th>
<th>Command</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>A</td>
<td><code>python /spuc/spuc.py --units iuhc</code></td>
<td></td>
</tr>
<tr class="even">
<td>B</td>
<td><code>python /spuc/spuc.py</code></td>
<td><code>--units iuhc</code></td>
</tr>
<tr class="odd">
<td>C</td>
<td><code>python</code></td>
<td><code>/spuc/spuc.py --units iuhc</code></td>
</tr>
<tr class="even">
<td>D</td>
<td></td>
<td><code>python /spuc/spuc.py --units iuhc</code></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>These are all valid combinations! The best choice depends on the use
case.</p>
<ol style="list-style-type: upper-alpha">
<li><p>This combination bakes the command and the parameters into the
image. This is useful if the command is always the same and the
specified parameters are unlikely to change (although more may be
appended).</p></li>
<li><p>This combination allows the command’s arguments to be changed
easily, while baking-in which Python script to run.</p></li>
<li><p>This combination allows the Python script to be changed easily,
which is more likely to be bad than good!</p></li>
<li><p>This combination allows maximum flexibility, but it requires the
user to write the whole command to modify even the parameters.</p></li>
</ol>
</div>
</div>
</div>
</div>
<p>Thanks to the SPUC documentation, our service is now running with the
best units, and we can export the unicorn sightings using the API
endpoint!</p>
<p>What else could we do with this container? Lets look at the docs
again!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Environment variables and overriding the command and entrypoint of
containers are the main ways to configure the behaviour of a container.
A well structured container will have sensible defaults, but will also
allow for configuration to be changed easily.</li>
<li>Environment variables can be configured using the flag
<code>-e</code>
</li>
<li>The command can be used to pass parameters to the container, like
so:<br><code>docker run &lt;image&gt; &lt;parameters&gt;</code><br>
This actually <em>overrides</em> the default command of the
container.</li>
<li>The entrypoint can also be overridden using the
<code>--entrypoint</code> flag.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-dockerfiles"><p>Content from <a href="dockerfiles.html">Creating Your Own Container Images</a></p>
<hr>
<p>Last updated on 2024-12-03 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/dockerfiles.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create my own container images?</li>
<li>What is a <code>Dockerfile</code>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to create your own container images using a
<code>Dockerfile</code>.</li>
<li>Introduce the core instructions used in a
<code>Dockerfile</code>.</li>
<li>Learn how to build a container image from a
<code>Dockerfile</code>.</li>
<li>Learn how to run a container from a <em>local</em> container
image.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>The SPUC documentation just keeps on giving, let’s keep the streak
going!</p>
<p>There is another cool feature on there that we haven’t used yet - the
ability to add new unicorn analysis features using plugins! Let’s try
that out.</p>
<p>The docs says that we need to add a Python file at
<code>/spuc/plugins/</code> that defines an endpoint for the new
feature.</p>
<p>It would be very handy to be able to get some basic statistics about
our Unicorns. Let’s add a new plugin that will return a statistical
analysis of the brightness of the unicorns in the database.</p>
<p>First lets make a file <code>stats.py</code> with the following
content:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">from</span> __main__ <span class="im">import</span> app</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">from</span> __main__ <span class="im">import</span> file_path</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">"/stats"</span>, methods<span class="op">=</span>[<span class="st">"GET"</span>])</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="kw">def</span> stats():</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(file_path):</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"message"</span>: <span class="st">"No unicorn sightings yet!"</span>}</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(file_path) <span class="im">as</span> f:</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(f)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>        df <span class="op">=</span> df.iloc[:, <span class="dv">1</span>:]</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>        stats <span class="op">=</span> df.describe()</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>        <span class="cf">return</span> stats.to_json()</span></code></pre>
</div>
<p>Don’t worry if you’re not familiar with Python or Pandas.
Understanding this snippet of code is not our aim. The code will return
some statistics about the data in <code>file_path</code>.</p>
<p>We already know how to load this file. Let’s use a bind mount to
share the file with the container. Since we are debugging, we’ll leave
out the <code>-d</code> flag so we can see the output easily.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">docker</span> kill spuc_container</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./print.config:/spuc/config/print.config <span class="at">-v</span> spuc-volume:/spuc/output <span class="at">-v</span> ./stats.py:/spuc/plugins/stats.py <span class="at">-e</span> EXPORT=true spuacv/spuc:latest <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
Traceback (most recent call last):
  File "/spuc/spuc.py", line 31, in &lt;module&gt;
    __import__(f"{plugin_dir}.{plugin[:-3]}")
  File "/spuc/plugins/stats.py", line 4, in &lt;module&gt;
    import pandas as pd
ModuleNotFoundError: No module named 'pandas'</code></pre>
</div>
<p>Oh… well what can we do about this? Clearly we need to install the
<code>pandas</code> package in the container but how do we do that? We
could do this interactively, but we know that won’t survive a
restart!</p>
<p>Really what we need to do is <strong>change</strong> the image
itself, so that it has <code>pandas</code> installed by default. This
takes us to one of the most fundamental features of Docker - the ability
to create your own container images.</p>
<section><h2 class="section-heading" id="creating-docker-images">Creating Docker Images<a class="anchor" aria-label="anchor" href="#creating-docker-images"></a>
</h2>
<hr class="half-width">
<p>So how are images made? With a recipe!</p>
<p>Images are created from a text file that contains a list of
instructions, called a <code>Dockerfile</code>. The instructions are
terminal commands, and build the container image up layer by layer.</p>
<p>All <em>Dockerfiles</em> start with a <code>FROM</code> instruction.
This sets the <em>base image</em> for the container. The base image is
the starting point for the container, and all subsequent instructions
are run on top of this base image.</p>
<p>You can use <strong>any</strong> image as a base image. There are
several <em>official</em> images available on Docker Hub which are very
commonly used. For example, <code>ubuntu</code> for general purpose
Linux, <code>python</code> for Python development, <code>alpine</code>
for a lightweight Linux distribution, and many more.</p>
<p>But of course, the most natural fit for us right now is to use the
SPUC image as a base image. This way we can be sure that our new image
will have all the dependencies we need.</p>
<p>Let’s create a new file called <code>Dockerfile</code> and add the
following content:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">FROM</span> spuacv/spuc:latest</span></code></pre>
</div>
<p>This is the simplest possible Dockerfile - it just says that our new
image will be based on the SPUC image.</p>
<p>But what do we do with it? We need to build the image!</p>
<p>To do this we use the <code>docker build</code> command (short for
<code>docker image build</code>). This command takes a Dockerfile and
builds a new image from it. Just as when saving a file, we also need to
name the image we are building. We give the image a name with the
<code>-t</code> (tag) flag:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> spuc-stats ./</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Building 0.0s (5/5) FINISHED                                                             docker:default
 =&gt; [internal] load build definition from Dockerfile                                                   0.0s
 =&gt; =&gt; transferring dockerfile: 61B                                                                    0.0s
 =&gt; [internal] load metadata for docker.io/spuacv/spuc:latest                                          0.0s
 =&gt; [internal] load .dockerignore                                                                      0.0s
 =&gt; =&gt; transferring context: 2B                                                                        0.0s
 =&gt; [1/1] FROM docker.io/spuacv/spuc:latest                                                            0.1s
 =&gt; exporting to image                                                                                 0.0s
 =&gt; =&gt; exporting layers                                                                                0.0s
 =&gt; =&gt; writing image sha256:ccde35b1f9e872bde522e9fe91466ef983f9b579cffc2f457bff97f74206e839           0.0s
 =&gt; =&gt; naming to docker.io/library/spuc-stats                                                          0.0s</code></pre>
</div>
<p>Congratulations, you have now built an image! The command built a new
image called <code>spuc-stats</code> from the <code>Dockerfile</code> in
the current directory.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Context
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>By default, the <code>docker build</code> command looks for a file
called <code>Dockerfile</code> in the path specified by the last
argument.</p>
<p>This last argument is called the <em>build context</em>, and it
<strong>must</strong> be the path to a directory.</p>
<p>It is very common to see <code>.</code> or <code>./</code> used as
the build context, both of which refer to the current directory.</p>
<p>All of the instructions in the <code>Dockerfile</code> are run as if
we were in the build context directory.</p>
</div>
</div>
</div>
</div>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  The Dockerfile name
  </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler2" aria-labelledby="headingSpoiler2">
<div class="accordion-body">
<p>As mentioned before, by default the <code>docker build</code> command
looks for a file called <code>Dockerfile</code>.</p>
<p>However, you can specify a different file name using the
<code>-f</code> flag. For example, if your Dockerfile is called
<code>my_recipe</code> you can use:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> spuc-stats <span class="at">-f</span> my_recipe ./</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>If you now list the images on your system you should see the new
image <code>spuc-stats</code> listed:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">docker</span> image ls</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>spuacv/spuc                             latest    ccde35b1f9e8   25 hours ago     137MB
spuc-stats                              latest    21210c129ca9   5 minutes ago    137MB</code></pre>
</div>
<p>We can now run this image in the same way we would run any other
image:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> spuc-stats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
            \
             \
              \\
               \\\
                &gt;\/7
            _.-(º   \
           (=___._/` \            ____  ____  _    _  ____
                )  \ |\          / ___||  _ \| |  | |/ ___|
               /   / ||\         \___ \| |_) | |  | | |
              /    &gt; /\\\         ___) |  __/| |__| | |___
             j    &lt; _\           |____/|_|    \____/ \____|
         _.-' :      ``.
         \ r=._\        `.       Space Purple Unicorn Counter
        &lt;`\\_  \         .`-.
         \ r-7  `-. ._  ' .  `\
          \`,      `-.`7  7)   )
           \/         \|  \'  / `-._
                      ||    .'
                       \\  (
                        &gt;\  &gt;
                    ,.-' &gt;.'
                   &lt;.'_.''
                     &lt;'


Welcome to the Space Purple Unicorn Counter!

:::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::

:: Try recording a unicorn sighting with:
    curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100

:: No plugins detected</code></pre>
</div>
<p>So we have a copy of the SPUC image with a new name, but nothing has
changed! In fact, we can pass all the same arguments to the
<code>docker run</code> command as we did before:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">--name</span> spuc-stats_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./print.config:/spuc/config/print.config <span class="at">-v</span> spuc-volume:/spuc/output <span class="at">-v</span> ./stats.py:/spuc/plugins/stats.py <span class="at">-e</span> EXPORT=true spuc-stats <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Traceback (most recent call last):
  File "/spuc/spuc.py", line 31, in &lt;module&gt;
    __import__(f"{plugin_dir}.{plugin[:-3]}")
  File "/spuc/plugins/stats.py", line 4, in &lt;module&gt;
    import pandas as pd
ModuleNotFoundError: No module named 'pandas'</code></pre>
</div>
<p>We are back where we were, but we can now start to make this
container image our own!</p>
<p>Let’s first fix that dependency problem. We do this by adding a
<code>RUN</code> instruction to the <code>Dockerfile</code>. This
instruction runs a command in the container and then saves the result as
a new layer in the image. In this case we want to install the
<code>pandas</code> package so we add the following lines to the
<code>Dockerfile</code>:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install pandas</span></code></pre>
</div>
<p>This will install the <code>pandas</code> package in the container
using Python’s package manager <code>pip</code>. Now we can build the
image again:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> spuc-stats ./</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Building 11.1s (6/6) FINISHED                                                            docker:default
 [...]
 =&gt; CACHED [1/2] FROM docker.io/spuacv/spuc:latest                                                     0.0s
 =&gt; [2/2] RUN pip install pandas                                                                      10.5s
 =&gt; exporting to image                                                                                 0.4s
 =&gt; =&gt; exporting layers                                                                                0.4s
 =&gt; =&gt; writing image sha256:e548b862a5c4dd91551668e068d4ad46e6a25d3a3dbed335e780a01f954a2c26           0.0s
 =&gt; =&gt; naming to docker.io/library/spuc-stats                                                          0.0s</code></pre>
</div>
<p>You might have noticed a warning about running <code>pip</code> as
the root user. We are building a container image, not installing
software on our host machine, so we can ignore this warning.</p>
<p>Let’s run the image again:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">--name</span> spuc-stats_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./print.config:/spuc/config/print.config <span class="at">-v</span> spuc-volume:/spuc/output <span class="at">-v</span> ./stats.py:/spuc/plugins/stats.py <span class="at">-e</span> EXPORT=true spuc-stats <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
Welcome to the Space Purple Unicorn Counter!
[...]
:::: Plugins loaded! ::::
:: Available plugins
    stats.py

[...]</code></pre>
</div>
<p>It worked! We no longer get the error about the missing
<code>pandas</code> package, and the plugin is loaded!</p>
<p>Let’s try out the new endpoint (you may want to do this from another
terminal, or exit with <code>Ctrl+C</code> and re-run with
<code>-d</code> first):</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">curl</span> localhost:8321/stats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{"brightness":{"count":6.0,"mean":267.3333333333,"std":251.7599385658,"min":18.0,"25%":93.75,"50%":219.5,"75%":344.5,"max":709.0}}</code></pre>
</div>
<p>And there we have it! We have created our own container image with a
new feature!</p>
<p>But why stop here? We could keep modifying the image to make it more
how we would like by default.</p>
</section><section><h2 class="section-heading" id="copy">COPY<a class="anchor" aria-label="anchor" href="#copy"></a>
</h2>
<hr class="half-width">
<p>It is a bit annoying having to bind mount the <code>stats.py</code>
file every time we run the container. This makes sense for development,
because we can potentially modify the script while the container runs,
but we would like to distribute the image with the plugin already
installed.</p>
<p>We can add this file to the image itself using the <code>COPY</code>
instruction. This copies files from the host machine into the container
image. It takes two arguments: the source file on the host machine and
the destination in the container image.</p>
<p>Let’s add it to the <code>Dockerfile</code>:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="kw">COPY</span> stats.py /spuc/plugins/stats.py</span></code></pre>
</div>
<p>Now we can build the image again:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> spuc-stats ./</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
 =&gt; [1/3] FROM docker.io/spuacv/spuc:latest                                                         0.0s
 =&gt; [internal] load build context                                                                   0.0s
 =&gt; =&gt; transferring context: 287B                                                                   0.0s
 =&gt; CACHED [2/3] RUN pip install pandas                                                             0.0s
 =&gt; [3/3] COPY stats.py /spuc/plugins/stats.py                                                      0.0s
 =&gt; exporting to image                                                                              0.0s
 [...]</code></pre>
</div>
<div id="accordionSpoiler3" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler3" aria-expanded="false" aria-controls="collapseSpoiler3">
  <h3 class="accordion-header" id="headingSpoiler3">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Layers
  </h3>
</button>
<div id="collapseSpoiler3" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler3" aria-labelledby="headingSpoiler3">
<div class="accordion-body">
<p>You might have now noticed that on every build we are getting
messages like <code>CACHED [2/3]...</code> above.</p>
<p>Every instruction* in a Dockerfile creates a new <code>layer</code>
in the image.</p>
<p>Each layer is saved with a specific hash. If the set of instructions
up to that layer remain unchanged, Docker will use the cached layer,
instead of rebuilding it. This results in a lot of time and space being
saved!</p>
<p>In the case above, we had already run the <code>FROM</code> and
<code>RUN</code> instructions in a previous build. Docker was able to
use the cached layers for those 2 instructions, and only had to do some
work for the <code>COPY</code> layer.</p>
</div>
</div>
</div>
</div>
<p>And run the image again, but this time without the bind mount for the
<code>stats.py</code> file:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">--name</span> spuc-stats_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./print.config:/spuc/config/print.config <span class="at">-v</span> spuc-volume:/spuc/output <span class="at">-e</span> EXPORT=true spuc-stats <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
Welcome to the Space Purple Unicorn Counter!
[...]
:::: Plugins loaded! ::::
:: Available plugins
    stats.py
[...]</code></pre>
</div>
<p>The plugin is still loaded!</p>
<p>And again… why stop there? We’ve already configured the print how we
like it, so lets add it to the image as well!</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="kw">COPY</span> print.config /spuc/config/print.config</span></code></pre>
</div>
<p>Now we rebuild and re-run (without the bind mount for
<code>print.config</code>):</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> spuc-stats ./</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> spuc-volume:/spuc/output <span class="at">-e</span> EXPORT=True spuc-stats <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
 =&gt; [1/4] FROM docker.io/spuacv/spuc:latest                                                         0.0s
 =&gt; [internal] load build context                                                                   0.0s
 =&gt; =&gt; transferring context: 152B                                                                   0.0s
 =&gt; CACHED [2/4] RUN pip install pandas                                                             0.0s
 =&gt; CACHED [3/4] COPY stats.py /spuc/plugins/stats.py                                               0.0s
 =&gt; [4/4] COPY print.config /spuc/config/print.config                                               0.0s
 =&gt; exporting to image                                                                              0.0s
[...]
Welcome to the Space Purple Unicorn Counter!
[...]</code></pre>
</div>
<p>OOh! a unicorn! lets record it!</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=saturn\&amp;brightness=87</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span></code></pre>
</div>
<p>and the logs confirm copying the print config worked:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">docker</span> logs spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
::::: Unicorn number 7 spotted at saturn! Brightness: 87 iulu</code></pre>
</div>
<p>The <code>run</code> command is definitely improving! Is there
anything else we can do to make it even better?</p>
</section><section><h2 class="section-heading" id="env">ENV<a class="anchor" aria-label="anchor" href="#env"></a>
</h2>
<hr class="half-width">
<p>We can also set environment variables in the <code>Dockerfile</code>
using the <code>ENV</code> instruction. These can always be overridden
when running the container, as we have done ourselves, but it is useful
to set defaults. We like the <code>EXPORT</code> variable set to
<code>True</code>, so let’s add that to the <code>Dockerfile</code>:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="kw">ENV</span> EXPORT=True</span></code></pre>
</div>
<p>Rebuilding and running (without the <code>-e EXPORT=True</code> flag)
results in:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> spuc-stats ./</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">--name</span> spuc-stats_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> spuc-volume:/spuc/output spuc-stats <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
 =&gt; [1/4] FROM docker.io/spuacv/spuc:latest                                                         0.0s
 =&gt; [internal] load build context                                                                   0.0s
 =&gt; =&gt; transferring context: 61B                                                                    0.0s
 =&gt; CACHED [2/4] RUN pip install pandas                                                             0.0s
 =&gt; CACHED [3/4] COPY stats.py /spuc/plugins/stats.py                                               0.0s
 =&gt; CACHED [4/4] COPY print.config /spuc/config/print.config                                        0.0s
 =&gt; exporting to image                                                                              0.0s
[...]
Welcome to the Space Purple Unicorn Counter!
[...]
:::: Unicorn sightings export activated! ::::
:: Try downloading the unicorn sightings record with:
    curl localhost:8321/export</code></pre>
</div>
<p>The <code>EXPORT</code> variable is now set to <code>True</code> by
default!</p>
<div id="arg" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="arg" class="callout-inner">
<h3 class="callout-title">ARG</h3>
<div class="callout-content">
<p>There is another instruction called <code>ARG</code> that is used to
set variables in the <code>Dockerfile</code>. These variables are only
available during the build process, and are not saved in the image.</p>
</div>
</div>
</div>
<div id="accordionSpoiler4" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler4" aria-expanded="false" aria-controls="collapseSpoiler4">
  <h3 class="accordion-header" id="headingSpoiler4">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Layers - continued
  </h3>
</button>
<div id="collapseSpoiler4" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler4" aria-labelledby="headingSpoiler4">
<div class="accordion-body">
<p>You might have noticed that the <code>ENV</code> instruction did not
create a new layer in the image.</p>
<p>This instruction is a bit special, as it only modifies the
configuration of the image. The environment is set on every instruction
of the dockerfile, so it is not saved as a separate layer.</p>
<p>However, environment variables <em>can</em> have an effect on
instructions bellow it. Because of this, moving the <code>ENV</code>
instruction will <em>change</em> the layers, and the cache is no longer
valid.</p>
<p>We can see this by moving the <code>ENV</code> instruction in our
<code>Dockerfile</code> before the RUN command:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="kw">FROM</span> spuacv/spuc:latest</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="kw">ENV</span> EXPORT=True</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install pandas</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a><span class="kw">COPY</span> stats.py /spuc/plugins/stats.py</span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a><span class="kw">COPY</span> print.config /spuc/config/print.config</span></code></pre>
</div>
<p>If we now try to build again, we will get this output:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> spuc-stats ./</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Building 10.4s (9/9) FINISHED                                                         docker:default
 =&gt; [internal] load build definition from Dockerfile                                                0.0s
 =&gt; =&gt; transferring dockerfile: 187B                                                                0.0s
 =&gt; [internal] load metadata for docker.io/spuacv/spuc:latest                                       0.0s
 =&gt; [internal] load .dockerignore                                                                   0.0s
 =&gt; =&gt; transferring context: 2B                                                                     0.0s
 =&gt; CACHED [1/4] FROM docker.io/spuacv/spuc:latest                                                  0.0s
 =&gt; [internal] load build context                                                                   0.0s
 =&gt; =&gt; transferring context: 61B                                                                    0.0s
 =&gt; [2/4] RUN pip install pandas                                                                    9.8s
 =&gt; [3/4] COPY stats.py /spuc/plugins/stats.py                                                      0.0s
 =&gt; [4/4] COPY print.config /spuc/config/print.config                                               0.0s
 =&gt; exporting to image                                                                              0.5s
 =&gt; =&gt; exporting layers                                                                             0.5s
 =&gt; =&gt; writing image sha256:5a64cc132a7cbbc532b9e97dd17e5fb83239dfe42dae9e6df4d150c503d73691        0.0s
 =&gt; =&gt; naming to docker.io/library/spuc-stats                                                       0.0s</code></pre>
</div>
<p>As you can see, the first layer is cached, but everything after the
<code>ENV</code> instruction is rebuilt. Our environment variable has
absolutely no effect on the <code>RUN</code> instruction, but Docker
does not know that. The only thing that matters is that it
<em>could</em> have had an effect.</p>
<p>It is therefore recommended that you put the <code>ENV</code>
instructions only when they are needed.</p>
<p>A similar thing happens with the <code>ENTRYPOINT</code> and
<code>CMD</code> instructions, which we will cover next. Since these are
not needed at all during the build, they are best placed at the end of
the <code>Dockerfile</code>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="entrypoint-and-cmd">ENTRYPOINT and CMD<a class="anchor" aria-label="anchor" href="#entrypoint-and-cmd"></a>
</h2>
<hr class="half-width">
<p>We’re on a bit of a roll here! Let’s add one more modification to the
image. Let’s change away from those imperial units by default.</p>
<p>We can do this by changing the default command in the
<code>Dockerfile</code>. As you may remember, the default command is
composed of an <em>entrypoint</em> and a <em>command</em>. We can modify
either of them in the Dockerfile. Just to make clear wheat the full
command is directly from our dockerfile, lets write down both:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [<span class="st">"python"</span>, <span class="st">"/spuc/spuc.py"</span>]</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"--units"</span>, <span class="st">"iulu"</span>]</span></code></pre>
</div>
<p>Notice that we used an array syntax. Both the <code>ENTRYPOINT</code>
and <code>CMD</code> instructions can take a list of arguments, and the
array syntax ensures that the arguments are passed correctly.</p>
<p>Let’s give this a try, dropping the now unnecessary
<code>--units iulu</code> from the <code>docker run</code> command:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> spuc-stats ./</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--rm</span> <span class="at">--name</span> spuc-stats_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> spuc-volume:/spuc/output spuc-stats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
 =&gt; [1/4] FROM docker.io/spuacv/spuc:latest                                                         0.0s
 =&gt; CACHED [2/4] RUN pip install pandas                                                             0.0s
 =&gt; CACHED [3/4] COPY stats.py /spuc/plugins/stats.py                                               0.0s
 =&gt; CACHED [4/4] COPY print.config /spuc/config/print.config                                        0.0s
 =&gt; exporting to image                                                                              0.0s
[...]
:::: Units set to Intergalactic Unicorn Luminosity Units [iulu] ::::
[...]</code></pre>
</div>
<p>Much better! A far cleaner command, much more customised for our use
case!</p>
</section><section><h2 class="section-heading" id="building-containers-from-the-ground-up">Building containers from the ground up<a class="anchor" aria-label="anchor" href="#building-containers-from-the-ground-up"></a>
</h2>
<hr class="half-width">
<p>In this lesson we adjusted the SPUC image, which already contains a
service. This is a perfectly valid way of using Dockerfiles! But it is
not the most common.</p>
<p>While you can base your images on any other public image, it is most
common for developers to be creating containers ‘from the ground
up’.</p>
<p>The most common practice is creating images from images like
<code>ubuntu</code> or <code>alpine</code> and adding your own software
and configuration files. An example of this is how the developers of the
SPUC service created their image. The Dockerfile is reproduced
below:</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="kw">FROM</span> python:3.12-slim</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt</span> update</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt</span> install <span class="at">-y</span> curl</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a><span class="kw">WORKDIR</span> /spuc</span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a><span class="kw">COPY</span> ./requirements.txt /spuc/requirements.txt</span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install <span class="at">--no-cache-dir</span> <span class="at">--upgrade</span> <span class="at">-r</span> /spuc/requirements.txt</span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a><span class="kw">COPY</span> ./*.py /spuc/</span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a><span class="kw">COPY</span> ./config/*.config /spuc/config/</span>
<span id="cb42-14"><a href="#cb42-14" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> /spuc/output</span>
<span id="cb42-15"><a href="#cb42-15" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" tabindex="-1"></a><span class="kw">EXPOSE</span> 8321</span>
<span id="cb42-17"><a href="#cb42-17" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [<span class="st">"python"</span>, <span class="st">"/spuc/spuc.py"</span>]</span>
<span id="cb42-19"><a href="#cb42-19" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"--units"</span>, <span class="st">"iuhc"</span>]</span></code></pre>
</div>
<p>From this we can see the developers:</p>
<ul>
<li>Started <code>FROM</code> a <code>python:3.12-slim</code> image</li>
<li>Use <code>RUN</code> to install the required packages</li>
<li>
<code>COPY</code> the source code and configuration files</li>
<li>Set the default <code>ENTRYPOINT</code> and <code>CMD</code>.</li>
</ul>
<p>There are also two other instructions in this Dockerfile that we
haven’t covered yet.</p>
<ul>
<li>
<code>WORKDIR</code> sets the working directory for the container.
It is used to create a directory and then change into it. You may have
noticed before that when we exec into the SPUC container we start in the
<code>/spuc</code> directory. All of the commands after a
<code>WORKDIR</code> instruction are run from the directory it
sets.</li>
<li>
<code>EXPOSE</code> is used to expose a port from the container to
the host machine. This is not strictly necessary, but it is a good
practice to document which ports the service uses.</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>You can create your own container images using a
<code>Dockerfile</code>.</li>
<li>A <code>Dockerfile</code> is a text file that contains a list of
instructions to produce a container image.</li>
<li>Each instruction in a <code>Dockerfile</code> creates a new
<code>layer</code> in the image.</li>
<li>
<code>FROM</code>, <code>WORKDIR</code>, <code>RUN</code>,
<code>COPY</code>, <code>ENV</code>, <code>ENTRYPOINT</code> and
<code>CMD</code> are some of the most important instructions used in a
<code>Dockerfile</code>.</li>
<li>To build a container image from a <code>Dockerfile</code> you use
the command:<br><code>docker build -t &lt;image_name&gt; &lt;context_path&gt;</code>
</li>
<li>You can run a container from a local image just like any other
image, with docker run.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-docker-compose"><p>Content from <a href="docker-compose.html">Using Docker Compose</a></p>
<hr>
<p>Last updated on 2024-12-03 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-compose.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is Docker Compose?</li>
<li>Why and when would I use it?</li>
<li>How can I translate my <code>docker run</code> commands into a
<code>docker-compose.yml</code> file?</li>
<li>How can I make containers communicate with each other?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to run multiple containers together.</li>
<li>Clean up our run command for once and for all.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>We’ve manage to come a long way in making the SPUC container work
better for us, but it still lacks a little something. If we want to open
this service to our local community, we can hardly expect them to hit
the API with a curl command!</p>
<p>Luckily, the SPUA released the SPUC Super Visualiser (SPUCSVi)! The
SPUCSVi is a web-based tool that allows you to register unicorn
sightings, and also see the record of unicorn sightings. Handily, the
SPUA also made it available as a Docker container.</p>
<p>Now that you have seen several <code>docker run</code> commands, you
can well imagine how cumbersome running multiple containers can get.
Even more so if we want the different containers to play well with each
other.</p>
<p>Enter: Docker Compose!</p>
<p>Docker Compose is a tool for defining and running multi-container
applications. With Compose, you use a YAML file to configure your
application’s services. Then, with a single command, you create and
start all the services from your configuration.</p>
<p>Let’s take a look at Docker Compose and see how it can help us run
SPUC and SPUCSVi.</p>
<section><h2 class="section-heading" id="running-a-container">Running a container<a class="anchor" aria-label="anchor" href="#running-a-container"></a>
</h2>
<hr class="half-width">
<p>As an initial step, we will learn how to run a container using Docker
Compose.</p>
<p>The first thing we need to do is create a
<code>docker-compose.yml</code> file. All
<code>docker-compose.yml</code> files start with <code>services:</code>.
This is the root element under which we define the services we want to
run.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span></code></pre>
</div>
<p>Next, let’s add the service for the SPUC container. We’ll call it
<code>spuc</code> and we will tell it what <code>image</code> to
use.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span><span class="co">                            # The name of the service</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spuc:latest</span><span class="co">      # The image to use</span></span></code></pre>
</div>
<p>This is actually enough for us to run the container! But we won’t use
<code>docker run</code> any more.</p>
<p>Instead, we will use the base command <code>docker compose</code>. To
run the services, we add the command <code>up</code>, signalling that we
want to bring services up (i.e. start them).</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">docker</span> compose up</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 2/0
 ✔ Network docker_intro_default   Created                           0.1s
 ✔ Container docker_intro-spuc-1  Created                           0.0s
Attaching to spuc-1
spuc-1  |
spuc-1  |             \
spuc-1  |              \
spuc-1  |               \\
spuc-1  |                \\\
spuc-1  |                 &gt;\/7
spuc-1  |             _.-(º   \
spuc-1  |            (=___._/` \            ____  ____  _    _  ____
spuc-1  |                 )  \ |\          / ___||  _ \| |  | |/ ___|
spuc-1  |                /   / ||\         \___ \| |_) | |  | | |
spuc-1  |               /    &gt; /\\\         ___) |  __/| |__| | |___
spuc-1  |              j    &lt; _\           |____/|_|    \____/ \____|
spuc-1  |          _.-' :      ``.
spuc-1  |          \ r=._\        `.       Space Purple Unicorn Counter
spuc-1  |         &lt;`\\_  \         .`-.
spuc-1  |          \ r-7  `-. ._  ' .  `\
spuc-1  |           \`,      `-.`7  7)   )
spuc-1  |            \/         \|  \'  / `-._
spuc-1  |                       ||    .'
spuc-1  |                        \\  (
spuc-1  |                         &gt;\  &gt;
spuc-1  |                     ,.-' &gt;.'
spuc-1  |                    &lt;.'_.''
spuc-1  |                      &lt;'
spuc-1  |
spuc-1  |
spuc-1  | Welcome to the Space Purple Unicorn Counter!
spuc-1  |
spuc-1  | :::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::
spuc-1  |
spuc-1  | :: Try recording a unicorn sighting with:
spuc-1  |     curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100
spuc-1  |
spuc-1  | :: No plugins detected
spuc-1  |</code></pre>
</div>
<p>So we have our container running! With a couple of interesting bits
of output to note:</p>
<ul>
<li>A container was created named <code>docker-intro-spuc-1</code>. (The
directory name is prepended to the container name)</li>
<li>A <code>network</code> was created for the container - we will dig
into what this means later!</li>
<li>The tool is running in the foreground, so we can see the output of
the tool</li>
</ul>
<p>We can stop the container by pressing <code>[Ctrl+C]</code> in the
terminal.</p>
</section><section><h2 class="section-heading" id="configuring-the-container">Configuring the container<a class="anchor" aria-label="anchor" href="#configuring-the-container"></a>
</h2>
<hr class="half-width">
<p>We have managed to run our container, but we are still a way off from
reproducing our last <code>run</code> command. It’s ok, we need to add
more configuration to our Docker Compose file.</p>
<p>Let’s recall our <code>docker run</code> command for the regular SPUC
container (rather than the one we made ourselves - we’ll get to that in
a bit):</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> ./print.config:/spuc/config/print.config <span class="at">-v</span> spuc-volume:/spuc/output <span class="at">-v</span> stats.py:/spuc/plugins/stats.py <span class="at">-e</span> EXPORT=true spuacv/spuc:latest <span class="at">--units</span> iulu</span></code></pre>
</div>
<p>There are a lot of flags here! Each of these flags has a
corresponding key in Docker Compose. Lets order all the elements we want
in a table, so we can see what we need to add to our
<code>docker-compose.yml</code> file.</p>
<table class="table">
<colgroup>
<col width="45%">
<col width="54%">
</colgroup>
<thead><tr class="header">
<th>Flag</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>-d</code></td>
<td>Run the container in the background</td>
</tr>
<tr class="even">
<td><code>--rm</code></td>
<td>Remove the container when it stops</td>
</tr>
<tr class="odd">
<td><code>--name spuc_container</code></td>
<td>Name the container <code>spuc_container</code>
</td>
</tr>
<tr class="even">
<td><code>-p 8321:8321</code></td>
<td>Map port 8321 on the host to port 8321 in the container</td>
</tr>
<tr class="odd">
<td><code>-v ./print.config:/spuc/config/print.config</code></td>
<td>Bind mount the <code>./print.config</code> file into the
container</td>
</tr>
<tr class="even">
<td><code>-v spuc-volume:/spuc/output</code></td>
<td>Persist the <code>/spuc/output</code> directory in a volume</td>
</tr>
<tr class="odd">
<td><code>-v ./stats.py:/spuc/plugins/stats.py</code></td>
<td>Bind mount the <code>./stats.py</code> plugin into the
container</td>
</tr>
<tr class="even">
<td><code>-e EXPORT=true</code></td>
<td>Set the environment variable <code>EXPORT</code> to
<code>true</code>
</td>
</tr>
<tr class="odd">
<td><code>--units iulu</code></td>
<td>Set the units to Imperial Unicorn Length Units</td>
</tr>
</tbody>
</table>
<p>We can now start translate this into a Docker Compose file bit by
bit!</p>
<div class="section level3">
<h3 id="running-in-the-background">Running in the background<a class="anchor" aria-label="anchor" href="#running-in-the-background"></a>
</h3>
<p>To run a docker compose stack in the background, we can use the
<code>-d</code> (for detach) flag when calling
<code>docker compose up</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> docker compose up <span class="at">-d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 1/1
 ✔ Container docker-intro-spuc-1  Started                                   0.2s</code></pre>
</div>
<p>Of course, this means we can no longer see the logs! But we can still
access them using the <code>logs</code> command.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">docker</span> compose logs</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>spuc-1  |
spuc-1  |             \
spuc-1  |              \
spuc-1  |               \\
spuc-1  |                \\\
spuc-1  |                 &gt;\/7
spuc-1  |             _.-(º   \
spuc-1  |            (=___._/` \            ____  ____  _    _  ____
spuc-1  |                 )  \ |\          / ___||  _ \| |  | |/ ___|
spuc-1  |                /   / ||\         \___ \| |_) | |  | | |
spuc-1  |               /    &gt; /\\\         ___) |  __/| |__| | |___
spuc-1  |              j    &lt; _\           |____/|_|    \____/ \____|
spuc-1  |          _.-' :      ``.
spuc-1  |          \ r=._\        `.       Space Purple Unicorn Counter
spuc-1  |         &lt;`\\_  \         .`-.
spuc-1  |          \ r-7  `-. ._  ' .  `\
spuc-1  |           \`,      `-.`7  7)   )
spuc-1  |            \/         \|  \'  / `-._
spuc-1  |                       ||    .'
spuc-1  |                        \\  (
spuc-1  |                         &gt;\  &gt;
spuc-1  |                     ,.-' &gt;.'
spuc-1  |                    &lt;.'_.''
spuc-1  |                      &lt;'
spuc-1  |
spuc-1  |
spuc-1  | Welcome to the Space Purple Unicorn Counter!
spuc-1  |
spuc-1  | :::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::
spuc-1  |
spuc-1  | :: Try recording a unicorn sighting with:
spuc-1  |     curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100
spuc-1  |
spuc-1  | :: No plugins detected
spuc-1  |
spuc-1  |
spuc-1  |             \
spuc-1  |              \
spuc-1  |               \\
spuc-1  |                \\\
spuc-1  |                 &gt;\/7
spuc-1  |             _.-(º   \
spuc-1  |            (=___._/` \            ____  ____  _    _  ____
spuc-1  |                 )  \ |\          / ___||  _ \| |  | |/ ___|
spuc-1  |                /   / ||\         \___ \| |_) | |  | | |
spuc-1  |               /    &gt; /\\\         ___) |  __/| |__| | |___
spuc-1  |              j    &lt; _\           |____/|_|    \____/ \____|
spuc-1  |          _.-' :      ``.
spuc-1  |          \ r=._\        `.       Space Purple Unicorn Counter
spuc-1  |         &lt;`\\_  \         .`-.
spuc-1  |          \ r-7  `-. ._  ' .  `\
spuc-1  |           \`,      `-.`7  7)   )
spuc-1  |            \/         \|  \'  / `-._
spuc-1  |                       ||    .'
spuc-1  |                        \\  (
spuc-1  |                         &gt;\  &gt;
spuc-1  |                     ,.-' &gt;.'
spuc-1  |                    &lt;.'_.''
spuc-1  |                      &lt;'
spuc-1  |
spuc-1  |
spuc-1  | Welcome to the Space Purple Unicorn Counter!
spuc-1  |
spuc-1  | :::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::
spuc-1  |
spuc-1  | :: Try recording a unicorn sighting with:
spuc-1  |     curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100
spuc-1  |
spuc-1  | :: No plugins detected
spuc-1  |</code></pre>
</div>
<p>Now… something a bit funny is happening here… why are we seeing the
output twice?</p>
<p>We’ve actually started the same container twice! We only
<strong>stopped</strong> the container when we pressed
<code>[Ctrl+C]</code>, and didn’t remove it.</p>
</div>
<div class="section level3">
<h3 id="removing-the-container-when-it-stops">Removing the container when it stops<a class="anchor" aria-label="anchor" href="#removing-the-container-when-it-stops"></a>
</h3>
<p>We can stop and remove the container with the <code>down</code>
command.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">docker</span> compose down</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 2/2
 ✔ Container docker_intro-spuc-1  Removed                                  0.1s
 ✔ Network docker_intro_default   Removed                                  0.2s</code></pre>
</div>
<p>In practice, you only <em>need</em> to use <code>down</code> if you
<em>need</em> to remove the container. If you just want to stop it, you
can use <code>[Ctrl+C]</code> like we did before.</p>
</div>
<div class="section level3">
<h3 id="naming-the-container">Naming the container<a class="anchor" aria-label="anchor" href="#naming-the-container"></a>
</h3>
<p>The next item in our list is the name of the container. We can name
the container using the <code>container_name</code> key.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spuc:latest</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span><span class="co">            # The name of the container</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 2/0
 ✔ Network docker-intro_default          Created                           0.0s
 ✔ Container spuc_container              Started                           0.0s</code></pre>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Updating the compose file
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>You do not necessarily need to <code>down</code> your containers to
update the configuration, Docker Compose can be <em>smart</em> like
that.</p>
<p>You can update the <code>docker-compose.yml</code> file in your text
editor and then run <code>docker compose up -d</code> to see the changes
take effect.</p>
<p><strong>Warning</strong>: This is not always foolproof! Some changes
will require a rebuild of the container. It is also worth noting that
Docker Compose does not <em>save</em> the status with which you started
your services. When you do a <code>down</code>, it will look at the
<em>current</em> file, and stop the services as described in that
file.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="exporting-a-port">Exporting a port<a class="anchor" aria-label="anchor" href="#exporting-a-port"></a>
</h3>
<p>Currently, if we attempt to record a sighting of a unicorn, we will
get a connection refused error.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=asteroid\&amp;brightness=242</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>curl: (7) Failed to connect to localhost port 8321 after 0 ms: Could not connect to server</code></pre>
</div>
<p>This is because we haven’t mapped the port from the container to the
host. We can do this using the <code>ports</code> key using the notation
<code>host_port:container_port</code>.</p>
<p>It’s worth noting the <code>ports</code> key is a list, so we can map
multiple ports if we need to, and that the host and container ports
don’t have to be the same!</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spuc:latest</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span><span class="co">                          # Starts the list of ports to map</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8321:8321</span><span class="co">                   # Maps port 8321 on the host to port 8321 in the container</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 2/0
 ✔ Network docker-intro_default          Created                           0.0s
 ✔ Container spuc_container              Created                           0.0s</code></pre>
</div>
<p>Now we can record a unicorn sighting!</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=asteroid\&amp;brightness=242</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="bind-mounts">Bind mounts<a class="anchor" aria-label="anchor" href="#bind-mounts"></a>
</h3>
<p>As before, we want to make sure that our print configuration is being
used by SPUC. We will use a bind mount for this - mapping a file from
the host to the container.</p>
<p>As with the CLI, this is (confusingly) done using the
<code>volumes</code> key.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spuc:latest</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8321:8321</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span><span class="co">                                        # Starts the list of volumes/bind mounts</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span><span class="co">    # Bind mounts the print.config file</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 2/2
 ✔ Network docker_intro_default  Created                           0.1s
 ✔ Container spuc_container      Started                           0.2s</code></pre>
</div>
<p>Now, if you record some sightings, you should see them formatted
according to the configuration in <code>print.config</code>.</p>
<p>As before, whether a bind mount or volume is performed is based on
whether the argument on the left of the colon is a <em>name</em> or a
<em>path</em>. If it is a <em>path</em> (i.e. starts with <code>/</code>
or <code>./</code>), it generates a bind mount. Otherwise, it generates
a volume.</p>
</div>
<div class="section level3">
<h3 id="volumes">Volumes<a class="anchor" aria-label="anchor" href="#volumes"></a>
</h3>
<p>Let’s add a volume to persist the unicorn sightings between runs of
the container.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spuc:latest</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8321:8321</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span><span class="co">                  # Mounts the volume named spuc-volume</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>service "spuc" refers to undefined volume spuc-volume: invalid compose project</code></pre>
</div>
<p>Oops! We forgot to declare the volume! Although we added the
instruction to use the volume, we didn’t tell Docker Compose that we
needed that volume.</p>
<p>We can do this by adding a <code>volumes</code> key to the file. The
volumes are separate from <em>services</em>, so they are declared at the
same level. To declare a named volume, we specify its name and end with
a <code>:</code>. We will do this at the end of the file.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spuc:latest</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8321:8321</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span><span class="co">              # Mounts the volume named spuc-volume</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span><span class="co">                                      # Starts section for declaring volumes</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span><span class="co">                                # Declares a volume named spuc-volume</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 2/2
 ✔ Volume "docker_intro_spuc-volume"  Created                            0.0s
 ✔ Container spuc_container           Started                           10.3s</code></pre>
</div>
<p>Now, if you record some sightings and then stop and start the
container, you should see that the sightings are still there!</p>
<p>However, we can now use a cool feature of Docker Compose - the
ability to remove volumes when the container is removed.</p>
<p>We can do this using the <code>-v</code> flag with the
<code>down</code> command. Which tells Docker to remove any volumes
named in the <code>volumes</code> key.</p>
<p>You can confirm this by running <code>docker volume ls</code> before
and after running <code>down</code>.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">$</span> docker volume ls</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="ex">$</span> docker compose down <span class="at">-v</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="ex">$</span> docker volume ls</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>DRIVER        VOLUME NAME
local         docker_intro_spuc-volume
local         spuc-volume

[+] Running 3/3
 ✔ Container spuc_container         Removed                   10.2s
 ✔ Volume docker_intro_spuc-volume  Removed                    0.0s
 ✔ Network docker_intro_default     Removed                    0.2s

DRIVER        VOLUME NAME
local         spuc-volume</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="setting-an-environment-variable">Setting an environment variable<a class="anchor" aria-label="anchor" href="#setting-an-environment-variable"></a>
</h3>
<p>Next, we need to set the <code>EXPORT</code> environment variable to
<code>true</code>. This is done using the <code>environment</code>
key.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spuc:latest</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8321:8321</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span><span class="co">                      # Starts list of environment variables to set</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span><span class="co">                   # Sets the EXPORT environment variable to true</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="ex">docker</span> compose logs</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
spuc_container  |
spuc_container  | :::: Unicorn sightings export activated! ::::
spuc_container  | :: Try downloading the unicorn sightings record with:
spuc_container  |     curl localhost:8321/export
spuc_container  |</code></pre>
</div>
<p>We can see that the environment variable has been set by the output
of the tool and the export functionality is now available.</p>
</div>
<div class="section level3">
<h3 id="overriding-the-default-command">Overriding the default command<a class="anchor" aria-label="anchor" href="#overriding-the-default-command"></a>
</h3>
<p>Finally, lets set the units by overriding the command, as we did
before. For this, we use the <code>command</code> key.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spuc:latest</span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8321:8321</span></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span></span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span><span class="co">          # Overrides the default command</span></span>
<span id="cb36-13"><a href="#cb36-13" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb36-15"><a href="#cb36-15" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="ex">docker</span> compose logs</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
spuc_container  |
spuc_container  | :::: Units set to Intergalactic Unicorn Luminosity Units [iulu] ::::
spuc_container  |
[...]</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="enabling-the-plugin">Enabling the plugin<a class="anchor" aria-label="anchor" href="#enabling-the-plugin"></a>
</h3>
<p>We’re nearly back to where we were with our <code>docker run</code>
command! The only thing we are missing is enabling the plugin.</p>
<p>We used a bind mount before to put the plugin file in the container,
so lets try again:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spuc:latest</span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8321:8321</span></span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./stats.py:/spuc/plugins/stats.py</span><span class="co">        # Mounts the stats.py plugin</span></span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span></span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span></span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 1/1
 ✔ Container spuc_container  Started                            10.3s</code></pre>
</div>
<p>Seems to have worked, lets look at the logs to see if the plugin was
loaded.</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="ex">docker</span> compose logs</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>spuc_container  | Traceback (most recent call last):
spuc_container  |   File "/spuc/spuc.py", line 31, in &lt;module&gt;
spuc_container  |     __import__(f"{plugin_dir}.{plugin[:-3]}")
spuc_container  |   File "/spuc/plugins/stats.py", line 4, in &lt;module&gt;
spuc_container  |     import pandas as pd
spuc_container  | ModuleNotFoundError: No module named 'pandas'</code></pre>
</div>
<p>Oh no! We’ve hit an error! The <code>pandas</code> library isn’t
installed in the container - which was the whole reason that we made our
own container in the first place!</p>
<p>Let’s go back to that.</p>
</div>
</section><section><h2 class="section-heading" id="building-containers-in-docker-compose">Building containers in Docker Compose<a class="anchor" aria-label="anchor" href="#building-containers-in-docker-compose"></a>
</h2>
<hr class="half-width">
<p>We could use the tag we used when we built the container to use that
image. However, this would mean that if we want to adjust our locally
built container, we would have to rebuild it separately.</p>
<p>Instead, we can use the <code>build</code> key to tell Docker Compose
to build the container if needed.</p>
<p>To do that, we use the <code>build</code> key instead of the
<code>image</code> key:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a><span class="co">  # image: spuacv/spuc:latest</span></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="co">                        # Instead of using the 'image' key, we use the 'build' key</span></span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span><span class="co">                  # Sets the build context (the directory in which the Dockerfile is located)</span></span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span><span class="co">      # Sets the name of the Dockerfile</span></span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8321:8321</span></span>
<span id="cb44-10"><a href="#cb44-10" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb44-11"><a href="#cb44-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb44-12"><a href="#cb44-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb44-13"><a href="#cb44-13" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./stats.py:/spuc/plugins/stats.py</span></span>
<span id="cb44-14"><a href="#cb44-14" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb44-15"><a href="#cb44-15" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span></span>
<span id="cb44-16"><a href="#cb44-16" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span></span></code></pre>
</div>
<p>This tells docker compose to look for the Dockerfile in the current
directory. If needed, it will then build the container and tag it with
the current directory and service names.</p>
<p>Now, we have to be a little careful with our up command! If we run
<code>up</code>, Docker Compose will default to checking if the image
exists and if it does, it will use that image. This is ok… unless we
have made changes to the Dockerfile!</p>
<p>To ensure that the image is built, we can run
<code>docker compose build</code>. This will build (all) the image(s)
specified inside our <code>docker-compose.yml</code>. After building, we
use the usual <code>up</code> command.</p>
<p>Alternatively, we can add the <code>--build</code> flag to the
<code>up</code> command, which results in Docker building the image
right before starting the container. This will rebuild the image every
time you run it, but use cached layers if they exist.</p>
<p>Let’s start our services using that flag, and verify that the plugin
is loaded.</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">--build</span> <span class="at">-d</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a><span class="ex">docker</span> compose logs</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Building 9.2s (10/10) FINISHED                                                        docker:default
 =&gt; [spuc internal] load build definition from Dockerfile                                           0.0s
 =&gt; =&gt; transferring dockerfile: 250B                                                                0.0s
 =&gt; [spuc internal] load metadata for docker.io/spuacv/spuc:latest                                  0.0s
 =&gt; [spuc internal] load .dockerignore                                                              0.0s
 =&gt; =&gt; transferring context: 2B                                                                     0.0s
 =&gt; [spuc 1/4] FROM docker.io/spuacv/spuc:latest                                                    0.1s
 =&gt; [spuc internal] load build context                                                              0.0s
 =&gt; =&gt; transferring context: 546B                                                                   0.0s
 =&gt; [spuc 2/4] RUN pip install pandas                                                               8.5s
 =&gt; [spuc 3/4] COPY stats.py /spuc/plugins/stats.py                                                 0.0s
 =&gt; [spuc 4/4] COPY print.config /spuc/config/print.config                                          0.0s
 =&gt; [spuc] exporting to image                                                                       0.5s
 =&gt; =&gt; exporting layers                                                                             0.5s
 =&gt; =&gt; writing image sha256:b17d7f75ac398b083476cc3fda502875b1d1355b59ad2bdc9d0526f202be9c05        0.0s
 =&gt; =&gt; naming to docker.io/library/docker_intro-spuc                                                0.0s
 =&gt; [spuc] resolving provenance for metadata file                                                   0.0s
[+] Running 1/1
 ✔ Container spuc_container  Started                                                                0.3s
[...]
spuc_container  |
spuc_container  | :::: Plugins loaded! ::::
spuc_container  | :: Available plugins
spuc_container  |     stats.py
spuc_container  |
[...]</code></pre>
</div>
<p>You should now have a container running with the stats plugin
enabled!</p>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Simpler Dockerfile
  </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<p>You may have noticed that we ended up <em>duplicating</em> most of
the configuration from the Dockerfile within the
<code>docker-compose.yml</code> file.</p>
<p>In reality, if we are using Docker Compose we do not need to bake in
all of the configuration inside the Dockerfile. The only thing that was
different was the <code>pip install pandas</code> command. Therefore,
our dockerfile could be as simple as this:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="kw">FROM</span> spuacv/spuc:latest</span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install pandas</span></code></pre>
</div>
<p>Alternatively, we could simplify our <code>docker-compose.yml</code>
file by removing the duplicated configuration. However, this would make
the <code>docker-compose.yml</code> file less self-contained and more
dependent on the Dockerfile. It is usually a better idea to keep the
configuration in the <code>docker-compose.yml</code> file, as it makes
it easier to understand and maintain.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="connecting-multiple-services">Connecting multiple services<a class="anchor" aria-label="anchor" href="#connecting-multiple-services"></a>
</h2>
<hr class="half-width">
<p>We have now managed to replicate our <code>docker run</code> command
in a more readable and maintainable way.</p>
<p>There is an argument to be made that, even for running a single
service, Docker Compose is a useful tool. It brings an ephemeral run
command, that would need careful documentation to replicate, into a
single file that can be version controlled and shared. It is also much
easier on the eye than a long <code>docker run</code> command!</p>
<p>Where Docker Compose really shines, though, is when you have multiple
services that need to be run together. And we happen to have another
service that we need to run - SPUCSVi!</p>
<div class="section level3">
<h3 id="adding-spucsvi-to-our-docker-compose-file">Adding SPUCSVi to our Docker Compose file<a class="anchor" aria-label="anchor" href="#adding-spucsvi-to-our-docker-compose-file"></a>
</h3>
<p>We can add SPUCSVi to our Docker Compose file in the same way that we
added SPUC, by adding another service to the <code>services</code>
key.</p>
<p>The SPUCSVi documentation helpfully provides a table of configuration
options what we can use to configure the service, reproduced here:</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="59%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th>Item</th>
<th>Description</th>
<th>Default</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Image Name</td>
<td>The name of the image to use</td>
<td><code>spuacv/spucsvi:latest</code></td>
</tr>
<tr class="even">
<td>Port</td>
<td>The container port the service runs on</td>
<td><code>8322</code></td>
</tr>
<tr class="odd">
<td>SPUC_URL</td>
<td>An environment variable to set the URL of the SPUC service</td>
<td><code>http://spuc:8321</code></td>
</tr>
</tbody>
</table>
<p>We can use this to add SPUCSVi to our Docker Compose file!</p>
<p>But how do we know the correct URL for the SPUC service? This touches
on a couple of clever tricks that Docker Compose uses to make running
multiple services easier.</p>
<p>First, Docker Compose creates a network for each stack that it
starts. This means that, unless overridden, all services in the stack
can communicate with each other.</p>
<p>Second, Docker Compose uses the service name as the hostname for the
service. This means that we can use the service name as the hostname in
the URL! For our service named <code>spuc</code>, the hostname would be
<code>spuc</code> with the protocol <code>http</code> prepended and
<code>port</code> appended i.e. <code>http://spuc:8321</code>.</p>
<p>Knowing this, we are able to add SPUCSVi to our Docker Compose
file!</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8321:8321</span></span>
<span id="cb48-9"><a href="#cb48-9" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb48-10"><a href="#cb48-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb48-11"><a href="#cb48-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb48-12"><a href="#cb48-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./stats.py:/spuc/plugins/stats.py</span></span>
<span id="cb48-13"><a href="#cb48-13" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb48-14"><a href="#cb48-14" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span></span>
<span id="cb48-15"><a href="#cb48-15" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span></span>
<span id="cb48-16"><a href="#cb48-16" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" tabindex="-1"></a><span class="at">  </span><span class="fu">spucsvi</span><span class="kw">:</span><span class="co">                            # Declare a new service named spucsvi</span></span>
<span id="cb48-18"><a href="#cb48-18" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spucsvi:latest</span><span class="co">      # Specify the image to use</span></span>
<span id="cb48-19"><a href="#cb48-19" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spucsvi_container</span><span class="co"> # Name the container spucsvi</span></span>
<span id="cb48-20"><a href="#cb48-20" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span><span class="co">                            # </span></span>
<span id="cb48-21"><a href="#cb48-21" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8322:8322"</span><span class="co">                   # Map port 8322 on the host to port 8322 in the container</span></span>
<span id="cb48-22"><a href="#cb48-22" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span><span class="co">                      # </span></span>
<span id="cb48-23"><a href="#cb48-23" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SPUC_URL=http://spuc:8321</span><span class="co">     # Specify the SPUC_URL environment variable</span></span>
<span id="cb48-24"><a href="#cb48-24" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb48-26"><a href="#cb48-26" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span></span></code></pre>
</div>
<p>Now both services will be started at the same time!</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="ex">docker</span> compose logs</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 3/3
 ✔ Network docker_intro_default  Created                                                           0.1s
 ✔ Container spuc_container      Created                                                           0.0s
 ✔ Container spucsvi_container   Created                                                           0.0s
Attaching to spuc_container, spucsvi_container
spuc_container     |
spuc_container     |             \
spuc_container     |              \
spuc_container     |               \\
spuc_container     |                \\\
spuc_container     |                 &gt;\/7
spuc_container     |             _.-(º   \
spuc_container     |            (=___._/` \            ____  ____  _    _  ____
spuc_container     |                 )  \ |\          / ___||  _ \| |  | |/ ___|
spuc_container     |                /   / ||\         \___ \| |_) | |  | | |
spuc_container     |               /    &gt; /\\\         ___) |  __/| |__| | |___
spuc_container     |              j    &lt; _\           |____/|_|    \____/ \____|
spuc_container     |          _.-' :      ``.
spuc_container     |          \ r=._\        `.       Space Purple Unicorn Counter
spuc_container     |         &lt;`\\_  \         .`-.
spuc_container     |          \ r-7  `-. ._  ' .  `\
spuc_container     |           \`,      `-.`7  7)   )
spuc_container     |            \/         \|  \'  / `-._
spuc_container     |                       ||    .'
spuc_container     |                        \\  (
spuc_container     |                         &gt;\  &gt;
spuc_container     |                     ,.-' &gt;.'
spuc_container     |                    &lt;.'_.''
spuc_container     |                      &lt;'
spuc_container     |
spuc_container     |
spuc_container     | Welcome to the Space Purple Unicorn Counter!
spuc_container     |
spuc_container     | :::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::
spuc_container     |
spuc_container     | :: Try recording a unicorn sighting with:
spuc_container     |     curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100
spuc_container     |
spuc_container     | :::: Plugins loaded! ::::
spuc_container     | :: Available plugins
spuc_container     |     stats.py
spuc_container     |
spuc_container     | :::: Unicorn sightings export activated! ::::
spuc_container     | :: Try downloading the unicorn sightings record with:
spuc_container     |     curl localhost:8321/export
spuc_container     |
spucsvi_container  |
spucsvi_container  |      .-'''-. .-------.   ___    _     _______      .-'''-. ,---.  ,---..-./`)
spucsvi_container  |     / _     \\  _(`)_ \.'   |  | |   /   __  \    / _     \|   /  |   |\ .-.')
spucsvi_container  |    (`' )/`--'| (_ o._)||   .'  | |  | ,_/  \__)  (`' )/`--'|  |   |  .'/ `-' \
spucsvi_container  |   (_ o _).   |  (_,_) /.'  '_  | |,-./  )       (_ o _).   |  | _ |  |  `-'`"`
spucsvi_container  |    (_,_). '. |   '-.-' '   ( \.-.|\  '_ '`)      (_,_). '. |  _( )_  |  .---.
spucsvi_container  |   .---.  \  :|   |     ' (`. _` /| &gt; (_)  )  __ .---.  \  :\ (_ o._) /  |   |
spucsvi_container  |   \    `-'  ||   |     | (_ (_) _)(  .  .-'_/  )\    `-'  | \ (_,_) /   |   |
spucsvi_container  |    \       / /   )      \ /  . \ / `-'`-'     /  \       /   \     /    |   |
spucsvi_container  |     `-...-'  `---'       ``-'`-''    `._____.'    `-...-'     `---`     '---'
spucsvi_container  |
spucsvi_container  |     :::: SPUC Super Visualizer serving on localhost:8322 ::::
spucsvi_container  |</code></pre>
</div>
<p>As the logs suggest, we can now view the SPUCSVi interface by
visiting <code>localhost:8322</code> in our browser.</p>
<p>A visual treat awaits, and an easier way to record and view our
unicorn sightings!</p>
</div>
<div class="section level3">
<h3 id="networks">Networks<a class="anchor" aria-label="anchor" href="#networks"></a>
</h3>
<p>We briefly mentioned networks earlier, noting that, by default,
Docker Compose creates a network for each stack.</p>
<p>However, by overriding the default network, we can perform some
interesting tricks.</p>
<p>Now that we can record Unicorns using the SPUCSVi interface, we don’t
need to be able to access the SPUC service directly.</p>
<p>This means we can isolate the SPUC service from the host network.
This is a good security practice and helps keep things tidy.</p>
<p>To do this we need to stop exposing the ports for SPUC, by removing
the <code>ports</code> key from the SPUC service:</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a><span class="co">    # ports:                            # We can remove these two lines</span></span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a><span class="co">    #   - 8321:8321</span></span>
<span id="cb51-9"><a href="#cb51-9" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb51-10"><a href="#cb51-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb51-11"><a href="#cb51-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb51-12"><a href="#cb51-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./stats.py:/spuc/plugins/stats.py</span></span>
<span id="cb51-13"><a href="#cb51-13" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb51-14"><a href="#cb51-14" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span></span>
<span id="cb51-15"><a href="#cb51-15" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span></span>
<span id="cb51-16"><a href="#cb51-16" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" tabindex="-1"></a><span class="at">  </span><span class="fu">spucsvi</span><span class="kw">:</span></span>
<span id="cb51-18"><a href="#cb51-18" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spucsvi:latest</span></span>
<span id="cb51-19"><a href="#cb51-19" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spucsvi</span></span>
<span id="cb51-20"><a href="#cb51-20" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb51-21"><a href="#cb51-21" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8322:8322"</span></span>
<span id="cb51-22"><a href="#cb51-22" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb51-23"><a href="#cb51-23" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SPUC_URL=http://spuc:8321</span></span>
<span id="cb51-24"><a href="#cb51-24" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb51-26"><a href="#cb51-26" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code></pre>
</div>
<p>Now, the SPUC service is only accessible from within the Docker
network! Try doing a curl to register a sighting and you wont be able
to. However, you can still register sightings through the SPUCSVi
interface.</p>
<p>This can be taken further to create networks with very limited
purposes. For example in a typical web app you may make it so that the
frontend can connect only to backend, but not to the database.</p>
<div id="accordionSpoiler3" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler3" aria-expanded="false" aria-controls="collapseSpoiler3">
  <h3 class="accordion-header" id="headingSpoiler3">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Network names
  </h3>
</button>
<div id="collapseSpoiler3" class="accordion-collapse collapse" aria-labelledby="headingSpoiler3" data-bs-parent="#accordionSpoiler3">
<div class="accordion-body">
<p>You may have noticed that the network that Docker Compose created for
our stack is named <code>docker_intro_default</code>. This is because
Docker Compose uses the name of the directory that the
<code>docker-compose.yml</code> file is in as the name of the
network.</p>
<p>If you want to specify the name of the network, you can use the
<code>networks</code> key in the <code>docker-compose.yml</code> file.
You also need to specify the network name for each service that you want
to connect to the network.</p>
<p>For example, to specify the network name as
<code>spuc_network</code>, you would add the following to the file:</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb53-9"><a href="#cb53-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb53-10"><a href="#cb53-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./stats.py:/spuc/plugins/stats.py</span></span>
<span id="cb53-11"><a href="#cb53-11" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb53-12"><a href="#cb53-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span></span>
<span id="cb53-13"><a href="#cb53-13" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span></span>
<span id="cb53-14"><a href="#cb53-14" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span><span class="co">                         # Starts list of networks to connect this service to</span></span>
<span id="cb53-15"><a href="#cb53-15" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc_network</span><span class="co">                  # Connects to the spuc_network network</span></span>
<span id="cb53-16"><a href="#cb53-16" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" tabindex="-1"></a><span class="at">  </span><span class="fu">spucsvi</span><span class="kw">:</span></span>
<span id="cb53-18"><a href="#cb53-18" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spucsvi:latest</span></span>
<span id="cb53-19"><a href="#cb53-19" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spucsvi</span></span>
<span id="cb53-20"><a href="#cb53-20" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb53-21"><a href="#cb53-21" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8322:8322"</span></span>
<span id="cb53-22"><a href="#cb53-22" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb53-23"><a href="#cb53-23" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SPUC_URL=http://spuc:8321</span></span>
<span id="cb53-24"><a href="#cb53-24" tabindex="-1"></a><span class="at">    </span><span class="fu">networks</span><span class="kw">:</span><span class="co">                         # Starts list of networks to connect this service to</span></span>
<span id="cb53-25"><a href="#cb53-25" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc_network</span><span class="co">                  # Connects to the spuc_network network</span></span>
<span id="cb53-26"><a href="#cb53-26" tabindex="-1"></a></span>
<span id="cb53-27"><a href="#cb53-27" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb53-28"><a href="#cb53-28" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span></span>
<span id="cb53-29"><a href="#cb53-29" tabindex="-1"></a></span>
<span id="cb53-30"><a href="#cb53-30" tabindex="-1"></a><span class="fu">networks</span><span class="kw">:</span><span class="co">                             # Starts section for declaring networks</span></span>
<span id="cb53-31"><a href="#cb53-31" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc_network</span><span class="kw">:</span><span class="co">                       # Declares a network for spuc</span></span>
<span id="cb53-32"><a href="#cb53-32" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> spuc_network</span><span class="co">                # Specifies the name of the network</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="depends-on">Depends on<a class="anchor" aria-label="anchor" href="#depends-on"></a>
</h3>
<p>There is an important problem that we haven’t addressed yet - what
happens if the SPUCSVi service starts before the SPUC service?</p>
<p>This is a common problem when running multiple services together -
services that depend on each other need to start in a specific
order.</p>
<p>Docker Compose has a solution to this - the <code>depends_on</code>
key.</p>
<p>We can use this key to tell Docker Compose that the SPUCSVi service
depends on the SPUC service.</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb54-8"><a href="#cb54-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb54-9"><a href="#cb54-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb54-10"><a href="#cb54-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./stats.py:/spuc/plugins/stats.py</span></span>
<span id="cb54-11"><a href="#cb54-11" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb54-12"><a href="#cb54-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span></span>
<span id="cb54-13"><a href="#cb54-13" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span></span>
<span id="cb54-14"><a href="#cb54-14" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" tabindex="-1"></a><span class="at">  </span><span class="fu">spucsvi</span><span class="kw">:</span></span>
<span id="cb54-16"><a href="#cb54-16" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spucsvi:latest</span></span>
<span id="cb54-17"><a href="#cb54-17" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spucsvi</span></span>
<span id="cb54-18"><a href="#cb54-18" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb54-19"><a href="#cb54-19" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8322:8322"</span></span>
<span id="cb54-20"><a href="#cb54-20" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb54-21"><a href="#cb54-21" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SPUC_URL=http://spuc:8321</span></span>
<span id="cb54-22"><a href="#cb54-22" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span><span class="co">                     # Starts section for declaring dependencies</span></span>
<span id="cb54-23"><a href="#cb54-23" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc</span><span class="co">                        # Declares that the spucsvi service depends on the spuc service</span></span>
<span id="cb54-24"><a href="#cb54-24" tabindex="-1"></a></span>
<span id="cb54-25"><a href="#cb54-25" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb54-26"><a href="#cb54-26" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span></span></code></pre>
</div>
<p>Now, when we run <code>docker compose up</code>, the SPUCSVi service
will wait until SPUC has started before it starts.</p>
<p>But there is a catch! The <code>depends_on</code> key only ensures
that the service is started in the correct order. It doesn’t check if
the service is <em>ready</em>!</p>
<p>This can be a problem if a service is fast to start but slow to be
ready. For example, a database service may start quickly, but take a
while to be ready to accept connections.</p>
<p>To address this, Docker Compose allows you to define a
<code>healthcheck</code> for a service. This is a command that is run
periodically (from inside the container) to check if the service is
<em>ready</em>. The command failing (returning a non-zero exit code)
means that the service is not ready.</p>
<p>We can try this out by adding a <code>healthcheck</code> to the SPUC
service. Since we don’t want SPUCSVi to start until the record of
unicorn sightings is ready, we can use the <code>curl</code> command to
check if the <code>/export</code> endpoint is available. We need to add
the <code>--fail</code> flag to <code>curl</code> to ensure that it
returns a non-zero exit code if the endpoint is not available.</p>
<p>The other change we need to make is to add a <code>condition</code>
to the <code>depends_on</code> key in the SPUCSVi service. This tells
Docker Compose to only start the service if the service it depends on is
<em>healthy</em>, rather than just <em>started</em>.</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb55-6"><a href="#cb55-6" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb55-7"><a href="#cb55-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb55-8"><a href="#cb55-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb55-9"><a href="#cb55-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb55-10"><a href="#cb55-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./stats.py:/spuc/plugins/stats.py</span></span>
<span id="cb55-11"><a href="#cb55-11" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb55-12"><a href="#cb55-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span></span>
<span id="cb55-13"><a href="#cb55-13" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span></span>
<span id="cb55-14"><a href="#cb55-14" tabindex="-1"></a><span class="at">    </span><span class="fu">healthcheck</span><span class="kw">:</span><span class="co">                                                  # Starts section for declaring healthchecks</span></span>
<span id="cb55-15"><a href="#cb55-15" tabindex="-1"></a><span class="at">      </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"CMD"</span><span class="kw">,</span><span class="at"> </span><span class="st">"curl"</span><span class="kw">,</span><span class="at"> </span><span class="st">"--fail"</span><span class="kw">,</span><span class="at"> </span><span class="st">"http://spuc:8321/export"</span><span class="kw">]</span><span class="co">  # Specifies the healthcheck command (ran from inside the container)</span></span>
<span id="cb55-16"><a href="#cb55-16" tabindex="-1"></a><span class="at">      </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 3s</span><span class="co">                                                # Specifies the interval between healthchecks</span></span>
<span id="cb55-17"><a href="#cb55-17" tabindex="-1"></a><span class="at">      </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> 2s</span><span class="co">                                                 # Specifies the timeout for the healthcheck</span></span>
<span id="cb55-18"><a href="#cb55-18" tabindex="-1"></a><span class="at">      </span><span class="fu">retries</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span><span class="co">                                                  # Specifies the number of retries before failing completely</span></span>
<span id="cb55-19"><a href="#cb55-19" tabindex="-1"></a></span>
<span id="cb55-20"><a href="#cb55-20" tabindex="-1"></a><span class="at">  </span><span class="fu">spucsvi</span><span class="kw">:</span></span>
<span id="cb55-21"><a href="#cb55-21" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spucsvi:latest</span></span>
<span id="cb55-22"><a href="#cb55-22" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spucsvi</span></span>
<span id="cb55-23"><a href="#cb55-23" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb55-24"><a href="#cb55-24" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8322:8322"</span></span>
<span id="cb55-25"><a href="#cb55-25" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb55-26"><a href="#cb55-26" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SPUC_URL=http://spuc:8321</span></span>
<span id="cb55-27"><a href="#cb55-27" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb55-28"><a href="#cb55-28" tabindex="-1"></a><span class="at">      </span><span class="fu">spuc</span><span class="kw">:</span><span class="co">                                                       # This changed from a list (- spuc) to a mapping (spuc:)</span></span>
<span id="cb55-29"><a href="#cb55-29" tabindex="-1"></a><span class="at">        </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> service_healthy</span><span class="co">                                # Specifies further conditions for starting the service</span></span>
<span id="cb55-30"><a href="#cb55-30" tabindex="-1"></a></span>
<span id="cb55-31"><a href="#cb55-31" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb55-32"><a href="#cb55-32" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span></span></code></pre>
</div>
<p>Now, when we run <code>docker compose up</code>, the SPUCSVi service
will only start when the SPUC service is <em>ready</em>.</p>
<div id="accordionSpoiler4" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler4" aria-expanded="false" aria-controls="collapseSpoiler4">
  <h3 class="accordion-header" id="headingSpoiler4">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Simulating a slow start
  </h3>
</button>
<div id="collapseSpoiler4" class="accordion-collapse collapse" aria-labelledby="headingSpoiler4" data-bs-parent="#accordionSpoiler4">
<div class="accordion-body">
<p>This is a little hard to see in action as the SPUC service starts so
quickly. To be able to see it, let’s add a <code>sleep</code> command to
the <code>entrypoint</code> of the SPUC service to simulate a slow
start.</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb56-5"><a href="#cb56-5" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb56-6"><a href="#cb56-6" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb56-7"><a href="#cb56-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb56-8"><a href="#cb56-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb56-9"><a href="#cb56-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb56-10"><a href="#cb56-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./stats.py:/spuc/plugins/stats.py</span></span>
<span id="cb56-11"><a href="#cb56-11" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb56-12"><a href="#cb56-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span></span>
<span id="cb56-13"><a href="#cb56-13" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span></span>
<span id="cb56-14"><a href="#cb56-14" tabindex="-1"></a><span class="at">    </span><span class="fu">entrypoint</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"sh"</span><span class="kw">,</span><span class="at"> </span><span class="st">"-c"</span><span class="kw">,</span><span class="at"> </span><span class="st">"sleep 5 &amp;&amp; python /spuc/spuc.py"</span><span class="kw">]</span><span class="co">   # Adds a sleep command to the entrypoint to simulate a slow start</span></span>
<span id="cb56-15"><a href="#cb56-15" tabindex="-1"></a><span class="at">    </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb56-16"><a href="#cb56-16" tabindex="-1"></a><span class="at">      </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"CMD"</span><span class="kw">,</span><span class="at"> </span><span class="st">"curl"</span><span class="kw">,</span><span class="at"> </span><span class="st">"--fail"</span><span class="kw">,</span><span class="at"> </span><span class="st">"http://spuc:8321/export"</span><span class="kw">]</span></span>
<span id="cb56-17"><a href="#cb56-17" tabindex="-1"></a><span class="at">      </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 3s</span></span>
<span id="cb56-18"><a href="#cb56-18" tabindex="-1"></a><span class="at">      </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> 2s</span></span>
<span id="cb56-19"><a href="#cb56-19" tabindex="-1"></a><span class="at">      </span><span class="fu">retries</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb56-20"><a href="#cb56-20" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" tabindex="-1"></a><span class="at">  </span><span class="fu">spucsvi</span><span class="kw">:</span></span>
<span id="cb56-22"><a href="#cb56-22" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spucsvi:latest</span></span>
<span id="cb56-23"><a href="#cb56-23" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spucsvi</span></span>
<span id="cb56-24"><a href="#cb56-24" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb56-25"><a href="#cb56-25" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8322:8322"</span></span>
<span id="cb56-26"><a href="#cb56-26" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb56-27"><a href="#cb56-27" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SPUC_URL=http://spuc:8321</span></span>
<span id="cb56-28"><a href="#cb56-28" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb56-29"><a href="#cb56-29" tabindex="-1"></a><span class="at">      </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb56-30"><a href="#cb56-30" tabindex="-1"></a><span class="at">       </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> service_healthy</span></span>
<span id="cb56-31"><a href="#cb56-31" tabindex="-1"></a></span>
<span id="cb56-32"><a href="#cb56-32" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb56-33"><a href="#cb56-33" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 3/3
 ✔ Network docker_intro_default  Created                                   0.1s
 ✔ Container spuc_container      Healthy                                   6.7s
 ✔ Container spucsvi_container   Started                                   6.8s</code></pre>
</div>
<p>As yoy can see, the SPUCSVi service only started after the SPUC
service was healthy.</p>
</div>
</div>
</div>
</div>
<div id="accordionSpoiler5" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler5" aria-expanded="false" aria-controls="collapseSpoiler5">
  <h3 class="accordion-header" id="headingSpoiler5">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Simulating an unhealthy service
  </h3>
</button>
<div id="collapseSpoiler5" class="accordion-collapse collapse" aria-labelledby="headingSpoiler5" data-bs-parent="#accordionSpoiler5">
<div class="accordion-body">
<p>To simulate a service that does not pass the healthcheck, we can set
the <code>EXPORT</code> environment variable to <code>false</code> in
the SPUC service. This will mean that the export endpoint is not
available, so the healthcheck will fail.</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb59-5"><a href="#cb59-5" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb59-6"><a href="#cb59-6" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb59-7"><a href="#cb59-7" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb59-8"><a href="#cb59-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./print.config:/spuc/config/print.config</span></span>
<span id="cb59-9"><a href="#cb59-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/spuc/output</span></span>
<span id="cb59-10"><a href="#cb59-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./stats.py:/spuc/plugins/stats.py</span></span>
<span id="cb59-11"><a href="#cb59-11" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb59-12"><a href="#cb59-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=false</span><span class="co">                                # Sets the EXPORT environment variable to false</span></span>
<span id="cb59-13"><a href="#cb59-13" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span></span>
<span id="cb59-14"><a href="#cb59-14" tabindex="-1"></a><span class="at">    </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb59-15"><a href="#cb59-15" tabindex="-1"></a><span class="at">      </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"CMD"</span><span class="kw">,</span><span class="at"> </span><span class="st">"curl"</span><span class="kw">,</span><span class="at"> </span><span class="st">"--fail"</span><span class="kw">,</span><span class="at"> </span><span class="st">"http://spuc:8321/export"</span><span class="kw">]</span></span>
<span id="cb59-16"><a href="#cb59-16" tabindex="-1"></a><span class="at">      </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 3s</span></span>
<span id="cb59-17"><a href="#cb59-17" tabindex="-1"></a><span class="at">      </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> 2s</span></span>
<span id="cb59-18"><a href="#cb59-18" tabindex="-1"></a><span class="at">      </span><span class="fu">retries</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb59-19"><a href="#cb59-19" tabindex="-1"></a></span>
<span id="cb59-20"><a href="#cb59-20" tabindex="-1"></a><span class="at">  </span><span class="fu">spucsvi</span><span class="kw">:</span></span>
<span id="cb59-21"><a href="#cb59-21" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> spuacv/spucsvi:latest</span></span>
<span id="cb59-22"><a href="#cb59-22" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spucsvi</span></span>
<span id="cb59-23"><a href="#cb59-23" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb59-24"><a href="#cb59-24" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8322:8322"</span></span>
<span id="cb59-25"><a href="#cb59-25" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb59-26"><a href="#cb59-26" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> SPUC_URL=http://spuc:8321</span></span>
<span id="cb59-27"><a href="#cb59-27" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb59-28"><a href="#cb59-28" tabindex="-1"></a><span class="at">      </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb59-29"><a href="#cb59-29" tabindex="-1"></a><span class="at">       </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> service_healthy</span></span>
<span id="cb59-30"><a href="#cb59-30" tabindex="-1"></a></span>
<span id="cb59-31"><a href="#cb59-31" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb59-32"><a href="#cb59-32" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc-volume</span><span class="kw">:</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 3/3
 ✔ Network docker_intro_default  Created                                                            0.1s
 ✘ Container spuc_container      Error                                                             15.7s
 ✔ Container spucsvi_container   Created                                                            0.0s
dependency failed to start: container spuc_container is unhealthy</code></pre>
</div>
<p>The SPUC service shows an error, because it failed all 5 retries, and
the SPUCSVi service was not started.</p>
<p><strong>Warning</strong>: Even though <em>unhealthy</em>, the
<code>spuc_container</code> is running. You can check this by running
<code>docker ps</code>.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Docker Compose is a tool for defining and running multi-container
stacks in a YAML file. They can also serve as a way of structuring and
documenting <code>docker run</code> commands for single containers.</li>
<li>Instructions are saved in a <code>docker-compose.yml</code> file,
where services, networks, and volumes are defined.</li>
<li>Each <code>service</code> is a separate container, and it can be
fully configured from within the file.</li>
<li>Bind mounts and <code>volumes</code> can be declared for each
service, and they can be shared between containers too.</li>
<li>You can define <code>networks</code>, which can be used to connect
or isolate containers from each other.</li>
<li>All the services, volumes and networks are started together using
the <code>docker compose up</code> command.</li>
<li>They can be stopped using the <code>docker compose down</code>
command.</li>
<li>Container images can be built as the services are spun up by using
the <code>--build</code> flag.</li>
<li>The order in which services start can be controlled using the
<code>depends_on</code> key.</li>
<li>A <code>healthcheck</code> can be defined to verify the status of a
service. These are commands run from within the container to make sure
it is <em>ready</em>.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-docker-compose-microservices"><p>Content from <a href="docker-compose-microservices.html">And they lived happily ever after</a></p>
<hr>
<p>Last updated on 2024-12-03 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-compose-microservices.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I get the most out of Docker Compose?</li>
<li>What is a microservices architecture?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how combinations of microservices can achieve complex tasks
with no or low code.</li>
<li>Dissect a real world example of a microservices architecture.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>So far, in our exploration of Docker Compose, we have focused on
making our run commands more robust and on the orchestration of a stack.
Much of the power of Docker, however, is not just the ability to package
your own tools, but to use <em>off the shelf</em> tools to create
powerful solutions.</p>
<section><h2 class="section-heading" id="microservices">Microservices<a class="anchor" aria-label="anchor" href="#microservices"></a>
</h2>
<hr class="half-width">
<p>To be able to use Docker in this way, we need to use Docker Compose
to create a <em>microservices architecture</em>.</p>
<p>The philosophy of microservices is to break down applications into
small, manageable services. This is in contrast to the traditional
monolithic approach, where all parts of an application are contained in
a single codebase.</p>
<p>For example, an application might have a database, a web server,
front and back ends, an API, a file store, a message queue etc. A
monolithic approach would be to package all of these in the same
codebase. This is conceptually simple, but can rapidly become unwieldy
and difficult to maintain.</p>
<p>Using a tool like Docker Compose we can take a different approach. We
can divide the application into smaller services, each of which is
responsible for a single task. By breaking down the application into
smaller services, we can take advantage of the best tools available for
each part of the application.</p>
<p>In a microservices architecture, each tool runs as its own service,
and communicates with other services over a network. The database, web
server, front and back ends, and all the other services can be genuinely
separate. This can enhance the security in the application, as each
service can be isolated from the others.</p>
<p>Furthermore, since each of the tools can be best in their class, and
maintained by an enthusiastic and expert community, there can be gains
in performance. Docker Desktop helps in orchestrating these services,
making it easy to start, stop, and manage them, which ends up being at
least as simple as in a monolithic application (if not more).</p>
<p>For individual developers, it means less time writing code which has
already been written, and more time focusing on the unique, and fun,
parts of your application.</p>
</section><section><h2 class="section-heading" id="microservices-in-docker-compose">Microservices in Docker Compose<a class="anchor" aria-label="anchor" href="#microservices-in-docker-compose"></a>
</h2>
<hr class="half-width">
<p>Docker Compose is the perfect tool for managing a microservices
architecture.</p>
<p>To demonstrate the power of Docker Compose and microservices, let’s
take a look at a more applied example.</p>
<p>The <a href="https://github.com/UoMResearchIT/apperture" class="external-link">Apperture</a> project
is a stack of microservices. They combine to provide a log-in secure web
portal with built in user-management. It is maintained by the University
of Manchester’s Research IT team, and can easily be combined with other
stacks to provide them with a login portal.</p>
<p><code>Apperture</code> is comprised primarily of a compose file. Just
like we have been looking at!</p>
<p>The full <code>docker-compose.yml</code> file is available <a href="https://raw.githubusercontent.com/UoMResearchIT/apperture/refs/heads/main/docker-compose.yml" class="external-link">on
github</a>. It is quite long, so we will reproduce a slimmed down
version here.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="at">  </span><span class="fu">proxy</span><span class="kw">:</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> </span><span class="st">'jc21/nginx-proxy-manager:latest'</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'80:80'</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'443:443'</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> authelia</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="at">    </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="at">      </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"CMD"</span><span class="kw">,</span><span class="at"> </span><span class="st">"/bin/check-health"</span><span class="kw">]</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="at">  </span><span class="fu">whoami</span><span class="kw">:</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> docker.io/traefik/whoami</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="at">  </span><span class="fu">authelia</span><span class="kw">:</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> authelia/authelia</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="at">      </span><span class="fu">lldap</span><span class="kw">:</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="at">        </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> service_healthy</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ${PWD}/config/authelia/config:/config</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="at">      </span><span class="fu">AUTHELIA_DEFAULT_REDIRECTION_URL</span><span class="kw">:</span><span class="at"> https://whoami.${URL}</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="at">      </span><span class="fu">AUTHELIA_STORAGE_POSTGRES_HOST</span><span class="kw">:</span><span class="at"> authelia-postgres</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="at">      </span><span class="fu">AUTHELIA_AUTHENTICATION_BACKEND_LDAP_URL</span><span class="kw">:</span><span class="at"> ldap://apperture-ldap:3890</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="at">  </span><span class="fu">lldap</span><span class="kw">:</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> nitnelave/lldap:stable</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a><span class="at">      </span><span class="fu">lldap-postgres</span><span class="kw">:</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a><span class="at">        </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> service_healthy</span></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a><span class="at">      </span><span class="fu">LLDAP_LDAP_BASE_DN</span><span class="kw">:</span><span class="at"> dc=example,dc=com</span></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a><span class="at">      </span><span class="fu">LLDAP_DATABASE_URL</span><span class="kw">:</span><span class="at"> postgres://user:pass@lldap-postgres/dbname</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> lldap-data:/data</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a><span class="at">  </span><span class="fu">lldap-postgres</span><span class="kw">:</span></span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> lldap-postgres-data:/var/lib/postgresql/data</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a><span class="at">    </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a><span class="at">      </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"CMD-SHELL"</span><span class="kw">,</span><span class="at"> </span><span class="st">"pg_isready -U lldap"</span><span class="kw">]</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a><span class="at">  </span><span class="fu">lldap-data</span><span class="kw">:</span></span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a><span class="at">  </span><span class="fu">lldap-postgres-data</span><span class="kw">:</span></span></code></pre>
</div>
<p>This <code>docker-compose.yml</code> file is a little more complex
than the ones we have been looking at so far, but it is still just a
list of services and their configurations.</p>
<p>You’ll see some familiar things, like <code>image</code>,
<code>ports</code>, <code>depends_on</code> (and
<code>healthchecks</code>), <code>volumes</code>, and
<code>environment</code>.</p>
<p>Notice the <code>image</code> field in the <code>services</code>
section of the <code>docker-compose.yml</code> file. Every service is
using a pre-built Docker image from Docker Hub, straight off the shelf!
This is the power of Docker Compose and microservices!</p>
<p>To get an idea of what is going on, let’s draw a diagram of the
services in the <code>docker-compose.yml</code> file.</p>
<figure><img src="../fig/docker_compose_apperture.png" alt="Apperture Services: Showing a user accessing WhoAmI via the web portal, which is protected by Authelia, which authenticates against an LDAP server, which pulls user data from a Postgres database." class="figure mx-auto d-block"></figure><p>In short: <strong>Without writing a single line of code, we have a
fully functioning, secure web portal!</strong></p>
</section><section><h2 class="section-heading" id="combining-stacks">Combining Stacks<a class="anchor" aria-label="anchor" href="#combining-stacks"></a>
</h2>
<hr class="half-width">
<p>One of the most powerful features of Docker Compose is the ability to
combine stacks. There is no reason we cannot combine the Apperture stack
with the SPUC stack we have been working with in previous lessons!</p>
<p>This would allow us to protect our SPUC interface with the Apperture
portal. An important addition! We need to ensure poachers cannot falsely
record sightings of the rare yet valuable unicorns!</p>
<p>This can be achieved by making a couple of changes to the SPUC
<code>docker-compose.yml</code> file.</p>
<p>In our previous lesson, we learned about networks, which allow
services to communicate with each other. Now we want join the networks
of the SPUC and Apperture stacks so that they can communicate with each
other.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">YML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yml" tabindex="0"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># SPUC docker-compose.yml</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">+ networks</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">+   apperture</span><span class="kw">:</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">+     external</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="fu">+     name</span><span class="kw">:</span><span class="at"> apperture_default</span></span></code></pre>
</div>
<p>Couple this change with appropriate configuration of the proxy
service, and you have a secure SPUC portal!</p>
<figure><img src="../fig/docker_compose_spuc.png" alt="SPUC and Apperture Services: Showing a user accessing the SPUC interface via the web portal." class="figure mx-auto d-block"></figure><p>By combining the SPUC and Apperture stacks, we have created a
powerful, secure web portal with no added code! But why stop there?</p>
</section><section><h2 class="section-heading" id="rapid-extension">Rapid extension<a class="anchor" aria-label="anchor" href="#rapid-extension"></a>
</h2>
<hr class="half-width">
<p>There are some improvements we can make very quickly!</p>
<p>We can:</p>
<ul>
<li>Add a proper database to SPUC using <code>Postgres</code>
</li>
<li>Add support for unicorn-detecting sensors using
<code>RabbitMQ</code> and <code>Telegraf</code>
</li>
<li>Allow users to upload images of unicorns using
<code>MinIO</code>
</li>
</ul>
<figure><img src="../fig/docker_compose_full.png" alt="SPUC and Apperture Services: Showing a user accessing the SPUC interface via the web portal, which is protected by Authelia, which authenticates against an LDAP server, which pulls user data from a Postgres database. The SPUC interface communicates with a Postgres database, a RabbitMQ message queue, a Telegraf sensor, and a MinIO object store." class="figure mx-auto d-block"></figure><p>This is the true strength of Docker Compose and microservices. By
combining off the shelf tools, we can create powerful solutions with no
or low code, and in a fraction of the time it would take to write
everything from scratch.</p>
</section><section><h2 class="section-heading" id="they-lived-happily-ever-after">They Lived Happily Ever After<a class="anchor" aria-label="anchor" href="#they-lived-happily-ever-after"></a>
</h2>
<hr class="half-width">
<p>We hope you now feel prepared to start your mission detecting
unicorns, and that you use Docker for the good of our intergalactic
community.</p>
<p>In behalf of the SPUA, we thank you for your commitment and support
for the cause!</p>
<figure><img src="../fig/SPUA/spua_thanks_you.png" alt="Thank you for supporting the SPUA!" class="figure mx-auto d-block"></figure></section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/UoMResearchIT/docker-introduction/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/UoMResearchIT/docker-introduction/" class="external-link">Source</a></p>
				<p><a href="https://github.com/UoMResearchIT/docker-introduction/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.10" class="external-link">sandpaper (0.16.10)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.7" class="external-link">pegboard (0.7.7)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://uomresearchit.github.io/docker-introduction/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://uomresearchit.github.io/docker-introduction/instructor/aio.html",
  "identifier": "https://uomresearchit.github.io/docker-introduction/instructor/aio.html",
  "dateCreated": "2015-04-18",
  "dateModified": "2024-12-03",
  "datePublished": "2024-12-03"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

