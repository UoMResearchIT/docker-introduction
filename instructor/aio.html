<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Introduction to Docker: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-info">
          <abbr title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
              Beta
            </a>
            <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Introduction to Docker
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Introduction to Docker
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr></ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to Docker
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introducing Containers</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="docker-desktop.html">2. Docker Desktop</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="docker-cli-toolkit.html">3. Building our Docker CLI toolkit</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="docker-cli-advanced.html">4. Using the full power of the Docker CLI</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="docker-hub.html">5. The Docker Hub</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="creating-container-images.html">6. Creating Your Own Container Images</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="docker-compose.html">7. Using Docker Compose</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
</ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-introduction"><p>Content from <a href="introduction.html">Introducing Containers</a></p>
<hr>
<p>Last updated on 2024-10-15 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/introduction.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are containers, and why might they be useful to me?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Show how software depending on other software leads to configuration
management problems.</li>
<li>Identify the problems that software installation can pose for
research.</li>
<li>Explain the advantages of containerization.</li>
<li>Explain how using containers can solve software configuration
problems</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="learning-about-docker-containers" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="learning-about-docker-containers" class="callout-inner">
<h3 class="callout-title">Learning about Docker Containers</h3>
<div class="callout-content">
<p>The Australian Research Data Commons has produced a short
introductory video about Docker containers that covers many of the
points below. Watch it before or after you go through this section to
reinforce your understanding!</p>
<p><em><a href="https://www.youtube.com/watch?v=HelrQnm3v4g" class="external-link">How can
software containers help your research?</a></em> Australian Research
Data Commons, 2021. DOI: <a href="https://doi.org/10.5281/zenodo.5091260" class="external-link">10.5281/zenodo.5091260</a></p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="scientific-software-challenges">Scientific Software Challenges<a class="anchor" aria-label="anchor" href="#scientific-software-challenges"></a>
</h3>
<div id="whats-your-experience" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="whats-your-experience" class="callout-inner">
<h3 class="callout-title">What’s Your Experience?</h3>
<div class="callout-content">
<p>Take a minute to think about challenges that you have experienced in
using scientific software (or software in general!) for your research.
Then, share with your neighbors and try to come up with a list of common
gripes or challenges.</p>
</div>
</div>
</div>
<p>You may have come up with some of the following:</p>
<ul>
<li>you want to use software that doesn’t exist for the operating system
(Mac, Windows, Linux) you’d prefer.</li>
<li>you struggle with installing a software tool because you have to
install a number of other dependencies first. Those dependencies, in
turn, require <em>other</em> things, and so on (i.e. combinatoric
explosion).</li>
<li>the software you’re setting up involves many dependencies and only a
subset of all possible versions of those dependencies actually works as
desired.</li>
<li>you’re not actually sure what version of the software you’re using
because the install process was so circuitous.</li>
<li>you and a colleague are using the same software but get different
results because you have installed different versions and/or are using
different operating systems.</li>
<li>you installed everything correctly on your computer but now need to
install it on a colleague’s computer/campus computing cluster/etc.</li>
<li>you’ve written a package for other people to use but a lot of your
users frequently have trouble with installation.</li>
<li>you need to reproduce a research project from a former colleague and
the software used was on a system you no longer have access to.</li>
</ul>
<p>A lot of these characteristics boil down to one fact: the main
program you want to use likely depends on many, many, different other
programs (including the operating system!), creating a very complex, and
often fragile system. One change or missing piece may stop the whole
thing from working or break something that was already running. It’s no
surprise that this situation is sometimes informally termed “dependency
hell”.</p>
<div id="software-and-science" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="software-and-science" class="callout-inner">
<h3 class="callout-title">Software and Science</h3>
<div class="callout-content">
<p>Again, take a minute to think about how the software challenges we’ve
discussed could impact (or have impacted!) the quality of your work.
Share your thoughts with your neighbors. What can go wrong if our
software doesn’t work?</p>
</div>
</div>
</div>
<p>Unsurprisingly, software installation and configuration challenges
can have negative consequences for research:</p>
<ul>
<li>you can’t use a specific tool at all, because it’s not available or
installable.</li>
<li>you can’t reproduce your results because you’re not sure what tools
you’re actually using.</li>
<li>you can’t access extra/newer resources because you’re not able to
replicate your software set up.</li>
<li>others cannot validate and/or build upon your work because they
cannot recreate your system’s unique configuration.</li>
</ul>
<p>Thankfully there are ways to get underneath (a lot of) this mess:
containers to the rescue! Containers provide a way to package up
software dependencies and access to resources such as files and
communications networks in a uniform manner.</p>
</div>
<section><h2 class="section-heading" id="what-is-a-container-what-is-docker">What is a Container? What is Docker?<a class="anchor" aria-label="anchor" href="#what-is-a-container-what-is-docker"></a>
</h2>
<hr class="half-width">
<p><a href="https://www.docker.com/" class="external-link">Docker</a> is a tool that allows
you to build what are called “containers.” It’s not the only tool that
can create containers, but is the one we’ve chosen for this workshop.
But what <em>is</em> a container?</p>
<p>To understand containers, let’s first talk briefly about your
computer.</p>
<p>Your computer has some standard pieces that allow it to work – often
what’s called the hardware. One of these pieces is the CPU or processor;
another is the amount of memory or RAM that your computer can use to
store information temporarily while running programs; another is the
hard drive, which can store information over the long-term. All these
pieces work together to do the “computing” of a computer, but we don’t
see them because they’re hidden from view (usually).</p>
<p>Instead, what we see is our desktop, program windows, different
folders, and files. These all live in what’s called the filesystem.
Everything on your computer – programs, pictures, documents, the
operating system itself – lives somewhere in the filesystem.</p>
<p>NOW, imagine you want to install some new software but don’t want to
take the chance of making a mess of your existing system by installing a
bunch of additional stuff (libraries/dependencies/etc.). You don’t want
to buy a whole new computer because it’s too expensive. What if,
instead, you could have another independent filesystem and running
operating system that you could access from your main computer, and that
is actually stored within this existing computer?</p>
<p>Or, imagine you have two tools you want to use in your groundbreaking
research on cat memes: <code>PurrLOLing</code>, a tool that does
AMAZINGLY well at predicting the best text for a meme based on the cat
species and <code>WhiskerSpot</code>, the only tool available for
identifying cat species from images. You want to send cat pictures to
<code>WhiskerSpot</code>, and then send the species output to
<code>PurrLOLing</code>. But there’s a problem: <code>PurrLOLing</code>
only works on Ubuntu and <code>WhiskerSpot</code> is only supported for
OpenSUSE so you can’t have them on the same system! Again, we really
want another filesystem (or two) on our computer that we could use to
chain together <code>WhiskerSpot</code> and <code>PurrLOLing</code> in a
“pipeline”…</p>
<p>Container systems, like Docker, are special programs on your computer
that make it possible! The term “container” can be usefully considered
with reference to shipping containers. Before shipping containers were
developed, packing and unpacking cargo ships was time consuming and
error prone, with high potential for different clients’ goods to become
mixed up. Just like shipping containers keep things together that should
stay together, software containers standardize the description and
creation of a complete software system: you can drop a container into
any computer with the container software installed (the ‘container
host’), and it should “just work”.</p>
<div id="virtualization" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="virtualization" class="callout-inner">
<h3 class="callout-title">Virtualization</h3>
<div class="callout-content">
<p>Containers are an example of what’s called
<strong>virtualization</strong> – having a second “virtual” computer
running and accessible from a main or <strong>host</strong> computer.
Another example of virtualization are <strong>virtual machines</strong>
or VMs. A virtual machine typically contains a whole copy of an
operating system in addition to its own filesystem and has to get booted
up in the same way a computer would. A container is considered a
lightweight version of a virtual machine; underneath, the container is
(usually) using the Linux kernel and simply has some flavour of Linux +
the filesystem inside.</p>
</div>
</div>
</div>
<p>One final term: while the <strong>container</strong> is an
alternative filesystem layer that you can access and run from your
computer, the <strong>container image</strong> is the ‘recipe’ or
template for a container. The container image has all the required
information to start up a running copy of the container. A running
container tends to be transient and can be started and shut down. The
container image is more long-lived, as a definition for the container.
You could think of the container image like a cookie cutter – it can be
used to create multiple copies of the same shape (or container) and is
relatively unchanging, where cookies come and go. If you want a
different type of container (cookie) you need a different container
image (cookie cutter).</p>
</section><section><h2 class="section-heading" id="putting-the-pieces-together">Putting the Pieces Together<a class="anchor" aria-label="anchor" href="#putting-the-pieces-together"></a>
</h2>
<hr class="half-width">
<p>Think back to some of the challenges we described at the beginning.
The many layers of scientific software installations make it hard to
install and re-install scientific software – which ultimately, hinders
reliability and reproducibility.</p>
<p>But now, think about what a container is – a self-contained,
complete, separate computer filesystem. What advantages are there if you
put your scientific software tools into containers?</p>
<p>This solves several of our problems:</p>
<ul>
<li>documentation – there is a clear record of what software and
software dependencies were used, from bottom to top.</li>
<li>portability – the container can be used on any computer that has
Docker installed – it doesn’t matter whether the computer is Mac,
Windows or Linux-based.</li>
<li>reproducibility – you can use the exact same software and
environment on your computer and on other resources (like a large-scale
computing cluster).</li>
<li>configurability – containers can be sized to take advantage of more
resources (memory, CPU, etc.) on large systems (clusters) or less,
depending on the circumstances.</li>
</ul>
<p>The rest of this workshop will show you how to download and run
containers from pre-existing container images on your own computer, and
how to create and share your own container images.</p>
</section><section><h2 class="section-heading" id="use-cases-for-containers">Use cases for containers<a class="anchor" aria-label="anchor" href="#use-cases-for-containers"></a>
</h2>
<hr class="half-width">
<p>Now that we have discussed a little bit about containers – what they
do and the issues they attempt to address – you may be able to think of
a few potential use cases in your area of work. Some examples of common
use cases for containers in a research context include:</p>
<ul>
<li>Using containers solely on your own computer to use a specific
software tool or to test out a tool (possibly to avoid a difficult and
complex installation process, to save your time or to avoid dependency
hell).</li>
<li>Creating a <code>Dockerfile</code> that generates a container image
with software that you specify installed, then sharing a container image
generated using this Dockerfile with your collaborators for use on their
computers or a remote computing resource (e.g. cloud-based or HPC
system).</li>
<li>Archiving the container images so you can repeat analysis/modelling
using the same software and configuration in the future – capturing your
workflow.</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Almost all software depends on other software components to
function, but these components have independent evolutionary paths.</li>
<li>Small environments that contain only the software that is needed for
a given task are easier to replicate and maintain.</li>
<li>Critical systems that cannot be upgraded, due to cost, difficulty,
etc. need to be reproduced on newer systems in a maintainable and
self-documented way.</li>
<li>Virtualization allows multiple environments to run on a single
computer.</li>
<li>Containerization improves upon the virtualization of whole computers
by allowing efficient management of the host computer’s memory and
storage resources.</li>
<li>Containers are built from ‘recipes’ that define the required set of
software components and the instructions necessary to build/install them
within a container image.</li>
<li>Docker is just one software platform that can create containers and
the resources they use.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-docker-desktop"><p>Content from <a href="docker-desktop.html">Docker Desktop</a></p>
<hr>
<p>Last updated on 2024-10-15 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-desktop.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>We will present the Docker Desktop dashboard, as it will be useful to
understand key concepts of docker, such as images and containers.
Setting up docker in Windows or Mac will have installed Docker Desktop
by default. However, it is unlikely that you will use Docker Desktop on
your day to day work. You are much more likely to use the command line
interface to interact with Docker, and we will cover this shortly.</p>
<p>It is also important to note that while Docker Desktop is mostly
free, some features are offered at a premium. Also, it is not fully
functional on all operating systems; it can produce conflicts with the
docker engine on Linux, for example.</p>
<p>Therefore, <strong>this episode is meant to be demonstrative, that
is, you do not <em>need</em> to follow along</strong>.</p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is Docker Desktop?</li>
<li>What can it be used for?</li>
<li>Why can’t it replace the cli?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Show Docker Desktop and its components.</li>
<li>Understand what images and containers are.</li>
<li>Visualize the process of image aquisition, container execution and
where it ends.</li>
<li>Understand the ephimeral nature of containers.</li>
<li>Have a glimpse at containers that allow interaction.</li>
<li>Understand the importance of cleaning up in docker.</li>
<li>Understand the limitations of Docker Desktop.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>The <em>Space Purple Unicorn Association</em> (SPUA) has instructed
us to find the <em>Space Purple Unicorn Counter</em> (SPUC) container
image in preparation for our important mission.</p>
<section><h2 class="section-heading" id="getting-images">Getting images<a class="anchor" aria-label="anchor" href="#getting-images"></a>
</h2>
<hr class="half-width">
<p>One of the useful features of Docker Desktop is the ability to search
and analyze container images.</p>
<p>If you open the application you will likely see something like
this:</p>
<figure><img src="../fig/docker-desktop/docker_desktop_landing.gif" alt="Docker Desktop being opened for the first time." class="figure mx-auto d-block"></figure><p>You’ll notice that the panel on the left has a tab for ‘Images’ and
another for ‘Containers’. These will be the focus for the episode, and
we will ignore most other features.</p>
<p>On the top blue bar you’ll also find a search icon, which allows us
to search for container images.</p>
<p>Lets go ahead and select this search box, and search for spuacv/spuc.
<em>Tip</em>: You can also use <code>Ctrl+K</code> to start the
search.</p>
<figure><img src="../fig/docker-desktop/search_spuc.png" alt="Search window." class="figure mx-auto d-block"></figure><p>You may have noticed that it already shows some information about the
image. If you click on the image you’ll be shown more information. You
should be able to see the documentation, and it lets you select a tag
(version) from the dropdown menu.</p>
<figure><img src="../fig/docker-desktop/search_select_spuc_tag.png" alt="Search and select a tag." class="figure mx-auto d-block"></figure><p>Once you find the image you were looking for, you can either download
it (pull), or directly run it.</p>
<p>We’ll start by downloading the latest version. Go ahead and click on
the ‘Pull’ button.</p>
<p>Lets also pull the <code>hello-world</code> and <code>alpine</code>
images, which will help us explore features and issues with Docker
Desktop.</p>
</section><section><h2 class="section-heading" id="inspecting-images">Inspecting images<a class="anchor" aria-label="anchor" href="#inspecting-images"></a>
</h2>
<hr class="half-width">
<p>Lets now go to the ‘Images’ tab on the left panel. This shows a list
of all the images in your system, so you will be able to see spuc and
the other two images here.</p>
<figure><img src="../fig/docker-desktop/images_spuc_alpine_hello.png" alt="Images list showing spuc, alpine and hello-world." class="figure mx-auto d-block"></figure><p>The list already shows some information about the images on disk,
like their tag, size, and when they were created. It is also the place
where you can run the images, or delete them. However, before we do that
we want to <em>inspect</em> the images.</p>
<p>Clicking on the image will open a window with information on how the
image is built, and examine its packages and vulnerabilities. We can
even see which of the <em>layers</em> of the image are vulnerable, and
where they come from (Image hierarchy). For example, the vulnerabilities
in the <code>spuc</code> image come from its base image,
`python3-slim”.</p>
<figure><img src="../fig/docker-desktop/image_inspecting_spuc.png" alt="Inspecting spuc image." class="figure mx-auto d-block"></figure><p>This all looks rather scary, and it is important that we are careful
with the images that we download. It is therefore quite useful to be
able to analize them like this. The <code>python:3-slim</code> image, in
particular, comes from a verified publisher, so it is unlikely to be
malicious.</p>
<p>Another interesting thing to look at is the last few lines, which
usually show the command that will be run when the container is
started.</p>
</section><section><h2 class="section-heading" id="running-containers">Running containers<a class="anchor" aria-label="anchor" href="#running-containers"></a>
</h2>
<hr class="half-width">
<p>The images that we just downloaded are immutable files, they are
snapshots of an environment, distributed to be used as
<em>templates</em> to create ‘containers’. The containers are,
essentially, images being <em>run</em>. They are executions of the
image, and because they are running, they are no longer ‘static’.</p>
<p>Let’s run the <code>hello-world</code> image by clicking the ‘Run’
button in the ‘Actions’ column, from the Images tab.</p>
<figure><img src="../fig/docker-desktop/image_run_hello.png" alt="Run button from Images tab." class="figure mx-auto d-block"></figure><p>A prompt will ask you to confirm ‘Run’ or modify some optional
settings. For now, lets just confirm with ‘Run’.</p>
<figure><img src="../fig/docker-desktop/image_run_prompt.png" alt="Run confirmation prompt." class="figure mx-auto d-block"></figure><p>You will be taken to a ‘Logs’ tab inside the container that you just
ran. The logs show the output of this particular image, ‘Hello from
Docker!’ among other things.</p>
<p>If you look carefully, the ‘Containers’ tab on the left is
highlighted. We are looking at a container now, not an image, and so we
were re-located.</p>
<p>You might also find the heading in this page strange. Unless you
specify a name for the container (which we could have done in the
optional settings), Docker will generate a random name for it, which is
what we see here.</p>
<p>Exploring the ‘Inspect’ tab will show us some information, but for
now we are more interested in what the ‘Terminal’ and ‘Stats’ tabs have
to say. They both seem to indicate that we need to <em>run</em> or
<em>start</em> the container.</p>
<div class="tabs">
<nav><div id="nav-tab-1" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-1-Logs" name="Logs" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Logs" type="button" role="tab" aria-controls="nav-tabpanel-1-Logs" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-1-Logs">
  Logs
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Inspect" name="Inspect" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Inspect" type="button" role="tab" aria-controls="nav-tabpanel-1-Inspect" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Inspect">
  Inspect
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Bindmounts" name="Bindmounts" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Bindmounts" type="button" role="tab" aria-controls="nav-tabpanel-1-Bindmounts" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Bindmounts">
  Bind mounts
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Exec" name="Exec" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Exec" type="button" role="tab" aria-controls="nav-tabpanel-1-Exec" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Exec">
  Exec
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Files" name="Files" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Files" type="button" role="tab" aria-controls="nav-tabpanel-1-Files" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Files">
  Files
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Stats" name="Stats" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Stats" type="button" role="tab" aria-controls="nav-tabpanel-1-Stats" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Stats">
  Stats
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-1" class="tab-content">
<div id="nav-tabpanel-1-Logs" class="tab-pane show active" aria-labelledby="nav-tab-1-Logs" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_log.png" alt="Logs tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-1-Inspect" class="tab-pane" aria-labelledby="nav-tab-1-Inspect" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_inspect.png" alt="Inspect tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-1-Bindmounts" class="tab-pane" aria-labelledby="nav-tab-1-Bindmounts" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_bind.png" alt="Bind mounts tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-1-Exec" class="tab-pane" aria-labelledby="nav-tab-1-Exec" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_exec.png" alt="Exec tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-1-Files" class="tab-pane" aria-labelledby="nav-tab-1-Files" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_files.png" alt="Files tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-1-Stats" class="tab-pane" aria-labelledby="nav-tab-1-Stats" role="tabpanel">
<figure><img src="../fig/docker-desktop/hello_stats.png" alt="Stats tab in container from hello-world image." class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>Indeed, if we look carefully, we will find an ‘Exited (0)’ status
under the container name, and a ‘Start’ button near the top-right
corner. However, if we click on that button we will see the output
duplicated in the logs, and the ‘Exited (0)’ status again.</p>
<figure><img src="../fig/docker-desktop/hello_start.png" alt="Clickling Start on the already run hello-world container." class="figure mx-auto d-block"></figure><p>If we go back to the images tab and run the image again, we’ll see
that the same thing hapens. We get the ‘Hello from Docker!’, and the
container (with a new random name) exits.</p>
<figure><img src="../fig/docker-desktop/hello_re-ran.png" alt="Running hello-world image for a second time." class="figure mx-auto d-block"></figure><p>The nature of most containers is <em>ephimeral</em>.</p>
<p>They are meant to execute a process, and when the process is
completed, they exit. We can confirm this by clicking on the
‘Containers’ tab on the left. This will exit the container inspection
and show us all the containers.</p>
<p>We have only run the <code>hello-world</code> image, but you can see
there are two containers. Both containers in the list have a status
‘Exited’.</p>
<figure><img src="../fig/docker-desktop/containers_list.png" alt="Containers list." class="figure mx-auto d-block"></figure><p>You may be wondering why there are two containers, and not just one,
given that we only used one image. As mentioned before, the
<em>image</em> is used as a template, and as many <em>containers</em> as
we want can be created from it. Every time we run the image, a new
container is created.</p>
<p>So why are there not three containers then? When we ran the image
from the container inspection window, we were running the command on the
same container. That’s why there’s only two, even though we saw the
container in action three times.</p>
<p>If we go back to the ‘Images’ tab and run <code>hello world</code>
again, we’ll see a new container appear. All the containers are still
there, and they are not deleted automatically. This can actually become
problematic, and we will deal with it in a bit.</p>
</section><section><h2 class="section-heading" id="interacting-with-containers">Interacting with containers<a class="anchor" aria-label="anchor" href="#interacting-with-containers"></a>
</h2>
<hr class="half-width">
<p>Not all containers are as short lived as the ones from the
<code>hello-world</code> image. Lets try running the
<code>spuacv/spuc</code>, but look at the optional settings this time.
If you remember, we were instructed to run the container and configure a
port. Lets add a map to the port <code>8321</code> in the local
machine.</p>
<figure><img src="../fig/docker-desktop/run_spuc_opt.png" alt="Optional settings for spuc." class="figure mx-auto d-block"></figure><p>We are now ready to run it. You can immediately notice the status
under the container name is ‘Running’, and instead of an option to start
the container, we now get the option to stop it. The ‘Logs’ tab is not
too different, but the ‘Stats’ tab already shows more information. The
‘Exec’ tab also looks more interesting, we get access to a terminal
inside the running container.</p>
<div class="tabs">
<nav><div id="nav-tab-2" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-2-Logs" name="Logs" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Logs" type="button" role="tab" aria-controls="nav-tabpanel-2-Logs" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-2-Logs">
  Logs
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-Inspect" name="Inspect" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Inspect" type="button" role="tab" aria-controls="nav-tabpanel-2-Inspect" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-Inspect">
  Inspect
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-Bindmounts" name="Bindmounts" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Bindmounts" type="button" role="tab" aria-controls="nav-tabpanel-2-Bindmounts" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-Bindmounts">
  Bind mounts
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-Exec" name="Exec" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Exec" type="button" role="tab" aria-controls="nav-tabpanel-2-Exec" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-Exec">
  Exec
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-Files" name="Files" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Files" type="button" role="tab" aria-controls="nav-tabpanel-2-Files" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-Files">
  Files
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-Stats" name="Stats" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Stats" type="button" role="tab" aria-controls="nav-tabpanel-2-Stats" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-Stats">
  Stats
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-2" class="tab-content">
<div id="nav-tabpanel-2-Logs" class="tab-pane show active" aria-labelledby="nav-tab-2-Logs" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_log.png" alt="Logs tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-2-Inspect" class="tab-pane" aria-labelledby="nav-tab-2-Inspect" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_inspect.png" alt="Inspect tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-2-Bindmounts" class="tab-pane" aria-labelledby="nav-tab-2-Bindmounts" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_bind.png" alt="Bind mounts tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-2-Exec" class="tab-pane" aria-labelledby="nav-tab-2-Exec" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_exec.png" alt="Exec tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-2-Files" class="tab-pane" aria-labelledby="nav-tab-2-Files" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_files.png" alt="Files tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-2-Stats" class="tab-pane" aria-labelledby="nav-tab-2-Stats" role="tabpanel">
<figure><img src="../fig/docker-desktop/spuc_stats.png" alt="Stats tab in container from spuc image." class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>Before trying to do anything in the terminal, let’s look at the
container list by clicking on the ‘Containers’ tab on the left. You’ll
see the green icon of the container indicating that it is still live,
and indication of how long it’s been running for.</p>
<figure><img src="../fig/docker-desktop/containers_list_spuc_running.png" alt="Containers list, spuc still running." class="figure mx-auto d-block"></figure><p>Clicking on the container name again will take us back to the ‘Logs’
tab in the container.</p>
<div id="spot-a-unicorn" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="spot-a-unicorn" class="callout-inner">
<h3 class="callout-title">Spot a unicorn!</h3>
<div class="callout-content">
<p>If you look at the logs, you’ll see that the SPUC container is
instructing you on how to interact with it. Lets go ahead and try that.
Open a terminal and run the command
<code>curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100</code>.
If you look at the logs again, you’ll see that the container has
responded to your command with something like:</p>
<pre><code><span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn spotted at moon!! Brightness: 100 iuhc"</span><span class="op">}</span></span></code></pre>
<p>The documentation also mentioned that you can configure this print by
modifying the <code>print.config</code> file. How do we do that?</p>
</div>
</div>
</div>
<p>Lets try and interact with the terminal inside the container.</p>
<p>If you print the working directory with <code>pwd</code> you’ll get
the app’s base directory: <code>/spuc</code>. You can also list the
contents with <code>ls</code>, and look at the app’s code. We can even
run <code>apt update</code> and install something; for example
<code>apt install nano</code>.</p>
<figure><img src="../fig/docker-desktop/spuc_running.gif" alt="Interacting with spuc terminal in the Exec tab." class="figure mx-auto d-block"></figure><p>As you might expect, We can also modify things, like for example the
<code>print.config</code> file. Since we have installed nano, lets use
it to edit the file. Run <code>nano config/print.config</code> and
you’ll see the contents of the file. Replace the the print config line
with:</p>
<pre><code>::::: {time} Unicorn number {count} spotted at {location}!! Brightness: {brightness} {units}</code></pre>
<p>Another curl now should show the changes we made to the
<code>print.config</code> file.</p>
<p>At this point, it seems like the container is very much like a VM.
However, as we’ve mentioned before, containers are <em>meant to be
ephimeral</em>.</p>
<p>If we stop the container, we get a familiar empty tab in ‘Exec’ and
‘Stats’. The ‘Containers’ tab on the left will also show the container
status as ‘Exited’.</p>
<p>Lets go back to the ‘Images’ tab, and run the <code>spuc</code> image
again. Now lets go to the ‘Exec’ tab, and try and edit the
<code>print.config</code> file again. You’ll notice that
<code>nano</code> is not there anymore. If you look at the contents of
the file, for example with <code>cat config/print.config</code>, you’ll
see that the changes we made are gone.</p>
<figure><img src="../fig/docker-desktop/spuc_second_container_run.png" alt="Exec in fresh spuc container." class="figure mx-auto d-block"></figure><p>When we re-ran the <em>image</em>, we created a <strong>new</strong>
<em>container</em>. The new container is created from the template saved
in the image, and so ‘our’ changes have banished. This becomes very
clear when we go back to the ‘Containers’ tab on the left. We can see
that the first container we created from the <code>spuc</code> image is
there, next to the new container (which is still running, by the
way).</p>
<figure><img src="../fig/docker-desktop/containers_2_spuc_containers.png" alt="Containers list after new run of spuc image." class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="reviving-containers">Reviving containers<a class="anchor" aria-label="anchor" href="#reviving-containers"></a>
</h2>
<hr class="half-width">
<p>We <em>can</em> get the old container running again, although this is
rarely something we’d <em>want</em> to do. In Docker Desktop, all we
need to do is click on the ‘Start’ button from the ‘Containers’ list.
The terminal will appear empty, because it is a new session, but you
will be able to see the changes we made before. <img src="../fig/docker-desktop/spuc_revival.gif" alt="Reviving container spuc." class="figure"></p>
</section><section><h2 class="section-heading" id="naming-containers">Naming containers<a class="anchor" aria-label="anchor" href="#naming-containers"></a>
</h2>
<hr class="half-width">
<p>We’ve been a bit sloppy with the containers, and they all have random
names. It is possible to name the containers when we run them, and this
can be very useful. However, it can also cause us a bit of problems.</p>
<p>Lets run the <code>spuc</code> image again, and name the container
<code>SPUC</code>.</p>
<figure><img src="../fig/docker-desktop/run_spuc_named.png" alt="Optional settings for spuc." class="figure mx-auto d-block"></figure><p>If we look at the container list, it is much easier to find it, so
the name is useful!</p>
<p>However, we forgot to map the port. So lets stop this container, and
launch another one. This time we’ll map the port, and use the name we
wanted. <img src="../fig/docker-desktop/run_spuc_name_in_use_error.png" alt="Optional settings for spuc." class="figure"></p>
<p>This time we got an error! This is because the name <code>SPUC</code>
is already “in use” by another container. If we want the same name,
we’ll have to delete the old container first.</p>
</section><section><h2 class="section-heading" id="cleaning-up">Cleaning up<a class="anchor" aria-label="anchor" href="#cleaning-up"></a>
</h2>
<hr class="half-width">
<p>Lets go to the containers list, and delete the <code>SPUC</code>
container. There is a very convenient bin icon on the right, which will
prompt you for confirmation.</p>
<figure><img src="../fig/docker-desktop/spuc_delete_container.png" alt="Deleting container SPUC." class="figure mx-auto d-block"></figure><p>You should now be able to run the <code>spuc</code> image again, and
name the container <code>SPUC</code>.</p>
<p>Since we are deleting stuff, the <code>hello-world</code> image was
nice and useful to test docker was working, but it is now rather
useless. If I want to delete it, the ‘Images’ tab on the left has a
convenient bin icon to do so. Clicking on it will prompt you for
confirmation, but it will fail.</p>
<figure><img src="../fig/docker-desktop/images_delete_in_use_fail.gif" alt="Failing to delete image." class="figure mx-auto d-block"></figure><p>You’ll probably notice that the status of the image is ‘In use’. That
seems strange though, given that all the containers from that image
excited immediately.</p>
<p>Lets have a look at the ‘Containers’ tab. Some of the containers in
the list came from the <code>hello-world</code> image. They are now
stopped, but the fact that they originated from the
<code>hello-world</code> image is enough.</p>
<p>We’ve only been using Docker for very little, and we already have a
long list of containers! You may see how this can become a problem;
Particularly so because we were a bit sloppy and did not name the
containers.</p>
<p>Let’s try and get rid of the containers then. We can conveniently
select them all with the tickbox at the top, and an option to ‘Delete’
shows up. Clicking on it will prompt for confirmation, and we can go
ahead and accept. <img src="../fig/docker-desktop/delete_all_containers.gif" alt="Deleting containers." class="figure"></p>
<p>All our containers are now gone. Forever. We can’t get them back.
This is fine though - they were meant to be ephimeral.</p>
<p><strong><em>Warning:</em></strong> You have to be careful here, this
action deleted even the containers that were running. You can filter the
containers before you select them “all”.</p>
<p>On the up-side, the ‘Images’ tab shows the <code>hello-world</code>
image as ‘Unused’ now. For docker, an image is ‘In use’ as long as at
least one container has been created from it. Since we have no
containers from that image, Docker now knows the images can be safely
deleted. <img src="../fig/docker-desktop/images_delete_hello.gif" alt="Successfully deleting images." class="figure"></p>
</section><section><h2 class="section-heading" id="limitations---why-not-docker-desktop">Limitations - Why not Docker Desktop?<a class="anchor" aria-label="anchor" href="#limitations---why-not-docker-desktop"></a>
</h2>
<hr class="half-width">
<p>We have seen many of the neat and functional bits of Docker Desktop,
and it can be mighty appealing, particularly so if you lean towards the
use of graphical interfaces. However, we’ve not touched on its
weaknesses.</p>
<p>One thing we have completely lost now is the record of our unicorn
sightings. The containers are gone, and so are the changes we made to
the <code>print.config</code> file. Data in the containers can be made
persistent, but it is not the default behaviour, and it is something
that you cannot do from Docker Desktop!</p>
<p>Another very important thing is that Docker Desktop is very limited
in <em>how</em> you can run the containers. The optional settings let
you modify the instruction with which the container is run, but it is
very limited.</p>
<p>For example, let’s run the other image we have already pulled,
<code>alpine</code>, which is the image of a very lightweight Linux
distribution. Go to the images list, and click on run.</p>
<p>Nothing seems to have happened at all! Not even a single output to
the ‘Logs’, and no way to open a terminal inside Alpine.</p>
<div class="tabs">
<nav><div id="nav-tab-3" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-3-Logs" name="Logs" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-Logs" type="button" role="tab" aria-controls="nav-tabpanel-3-Logs" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-3-Logs">
  Logs
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-Inspect" name="Inspect" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-Inspect" type="button" role="tab" aria-controls="nav-tabpanel-3-Inspect" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-Inspect">
  Inspect
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-Bindmounts" name="Bindmounts" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-Bindmounts" type="button" role="tab" aria-controls="nav-tabpanel-3-Bindmounts" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-Bindmounts">
  Bind mounts
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-Exec" name="Exec" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-Exec" type="button" role="tab" aria-controls="nav-tabpanel-3-Exec" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-Exec">
  Exec
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-Files" name="Files" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-Files" type="button" role="tab" aria-controls="nav-tabpanel-3-Files" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-Files">
  Files
  </h3>
</button>
<button class="nav-link" id="nav-tab-3-Stats" name="Stats" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-3-Stats" type="button" role="tab" aria-controls="nav-tabpanel-3-Stats" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-3-Stats">
  Stats
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-3" class="tab-content">
<div id="nav-tabpanel-3-Logs" class="tab-pane show active" aria-labelledby="nav-tab-3-Logs" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_logs.png" alt="Logs tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-Inspect" class="tab-pane" aria-labelledby="nav-tab-3-Inspect" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_inspect.png" alt="Inspect tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-Bindmounts" class="tab-pane" aria-labelledby="nav-tab-3-Bindmounts" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_bind.png" alt="Bind mounts tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-Exec" class="tab-pane" aria-labelledby="nav-tab-3-Exec" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_exec.png" alt="Exec tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-Files" class="tab-pane" aria-labelledby="nav-tab-3-Files" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_files.png" alt="Files tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
<div id="nav-tabpanel-3-Stats" class="tab-pane" aria-labelledby="nav-tab-3-Stats" role="tabpanel">
<figure><img src="../fig/docker-desktop/alpine_stats.png" alt="Stats tab in container from alpine image." class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
<p>Just to be clear though, this Docker image does contain the whole
Alpine OS. In Docker Desktop, however, there is no way to interact with
it. This is the case for many (if not most) images. To be able to use it
(or them), we need to provide some sort of input or command, which we
cannot provide from Docker Desktop.</p>
<p>Therefore, Docker Desktop cannot really be used for much more than
being a nice dashboard.</p>
<p>In the next episode, we will use docker from the command line, and
all of the advantages it brings will become aparent.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>
<strong>Images</strong> are snapshots of an environment, easily
distributable and ready to be used as
<strong><em>templates</em></strong> for containers.</li>
<li>
<strong>Containers</strong> are <strong><em>executions of the
images</em></strong>, often with configuration added on top, and usually
<strong><em>meant for single use</em></strong>.</li>
<li>Running a container usually implies creating a new copy, so it is
important to <strong>clean up regularly</strong>.</li>
<li>
<strong>Docker Desktop</strong> is a great
<strong><em>dashboard</em></strong> that allows us to understand and
visualize the lifecycle of images and containers. It could potentially
be all you need to use if you only <em>consume</em> images out of the
box. However, it is <strong><em>very limited</em></strong> in most cases
(even for <em>consumers</em>), and rarely allows the user to configure
and interact with the containers adequately.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-docker-cli-toolkit"><p>Content from <a href="docker-cli-toolkit.html">Building our Docker CLI toolkit</a></p>
<hr>
<p>Last updated on 2024-10-15 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-cli-toolkit.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>Before we start to tackle Docker tasks that are only possible in the
command line, we need to build up our toolkit of Docker commands that
allow us to perform the same tasks we learned to do in Docker
Desktop.</p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I use the Docker CLI to perform the same tasks we learned to
do in Docker Desktop?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Build our fundamental Docker CLI toolkit</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="pulling-and-listing-images">Pulling and Listing Images<a class="anchor" aria-label="anchor" href="#pulling-and-listing-images"></a>
</h2>
<hr class="half-width">
<p>To run an image, first we need to download it. You may remember that,
in Docker, this is known as <em>pulling</em> an image.</p>
<p>Let’s try pulling the SPUC container that we used before:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">docker</span> pull spuacv/spuc:latest</span></code></pre>
</div>
<p>If it is the first time you pull this image, you will see something
like this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>latest: Pulling from spuacv/spuc
302e3ee49805: Pull complete
6b08635bc459: Pull complete
18bb7c8edce2: Pull complete
8341816e3d13: Pull complete
174a3dce8e2a: Pull complete
67d0d37078fb: Pull complete
4a705a772a90: Pull complete
bd9732a6317b: Pull complete
44c70b826ff3: Pull complete
cee1b3575f12: Pull complete
Digest: sha256:ad219064aaaad76860c53ec8420730d69dc5f8beb9345b0a15176111c2a976c5
Status: Downloaded newer image for spuacv/spuc:latest
docker.io/spuacv/spuc:latest</code></pre>
</div>
<p>If you’d already downloaded it before, you will instead get something
like this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>latest: Pulling from spuacv/spuc
Digest: sha256:ad219064aaaad76860c53ec8420730d69dc5f8beb9345b0a15176111c2a976c5
Status: Image is up to date for spuacv/spuc:latest
docker.io/spuacv/spuc:latest</code></pre>
</div>
<p>This just means Docker detected you already had that image, so it
didn’t need to download it again.</p>
<p>The structure of the command we just used will be the same for most
of the commands we will use in the Docker CLI, so it is worth taking a
moment to understand it.</p>
<div id="the-structure-of-a-docker-command" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-structure-of-a-docker-command" class="callout-inner">
<h3 class="callout-title">The structure of a Docker command</h3>
<div class="callout-content">
<p>The Docker CLI can be intimidating, as it is easy to get very long
commands that take a bit of work to understand. However, when you
understand the structure of the commands it becomes much easier to
understand what is happening.</p>
<p>Let’s dive into the structure of the command we looked at. Here is a
diagram which breaks things down:</p>
<figure><img src="../fig/docker_cmd.png" alt="A diagram showing the syntactic structure of a Docker command" class="figure mx-auto d-block"></figure><ul>
<li>Every Docker command starts with ‘docker’</li>
<li>Next, you specify the type of object to act on (e.g. image,
container)</li>
<li>Followed by the action to perform and the name of the object
(e.g. run, pull)</li>
<li>You can also include additional arguments and switches as needed
(e.g. the image name)</li>
</ul>
<div class="section level3">
<h3 id="todo-update-the-diagram-to-use-the-pull-command-instead">TODO: Update the diagram to use the pull command instead!<a class="anchor" aria-label="anchor" href="#todo-update-the-diagram-to-use-the-pull-command-instead"></a>
</h3>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="listing-images">Listing Images<a class="anchor" aria-label="anchor" href="#listing-images"></a>
</h2>
<hr class="half-width">
<p>Now that we have pulled our image, let’s check that it is there:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">docker</span> image ls</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>REPOSITORY                              TAG        IMAGE ID       CREATED         SIZE
spuacv/spuc                             latest    ce72bd42e51c   3 days ago      137MB</code></pre>
</div>
<p>This command lists (ls is short for list) all the images that we have
downloaded. It is the equivalent of the ‘Images’ tab in Docker Desktop.
You should see the SPUC image listed here, along with some other
information about it.</p>
</section><section><h2 class="section-heading" id="inspecting">Inspecting<a class="anchor" aria-label="anchor" href="#inspecting"></a>
</h2>
<hr class="half-width">
<p>You may remember that in Docker Desktop we could explore the image
buildup and the image’s metadata. We called this ‘inspecting’ the image.
To inspect an image using the Docker CLI, we can use:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">docker</span> inspect spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[
    {
        "Id": "sha256:ce72bd42e51c049fe29b4c15dc912e88c4461e94c2e1d403b90e2e53dfb1b420",
        "RepoTags": [
            "spuacv/spuc:latest"
        ],
        "RepoDigests": [
            "spuacv/spuc@sha256:ad219064aaaad76860c53ec8420730d69dc5f8beb9345b0a15176111c2a976c5"
        ],
        "Parent": "",
        "Comment": "buildkit.dockerfile.v0",
        "Created": "2024-10-11T14:05:59.254831281+01:00",
        "DockerVersion": "",
        "Author": "",
        "Config": {
[...]</code></pre>
</div>
<p>This tells you <strong>a lot</strong> of details about the image.
This can be useful for understanding what the image does and how it is
configured but it is also quite overwhelming!</p>
<p>The most useful information for an image user is what the container
will do when it is run. We highlighted the <code>command</code> and
<code>entrypoint</code> while inspecting images in Docker Desktop. Let’s
work on getting this information <em>only</em>.</p>
<p>To do that we will refine our command using the <code>-f</code> flag
to specify the output format. Lets try running the following
command:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">docker</span> inspect spuacv/spuc:latest <span class="at">-f</span> <span class="st">"Command: {{.Config.Cmd}}"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Command: [--units iuhc]</code></pre>
</div>
<p>That’s more manageable! How does it work?</p>
<p>The result of the inspect command is a JSON object, so we can access
elements from the output hierarchically. The <code>command</code> is
part of the image’s <code>Config</code>, which is at the base of the
json object. When we use double curly braces, docker understands we want
to access the value of the key <code>Cmd</code> in the
<code>Config</code> object.</p>
<p>We can do a similar thing to extract the entrypoint:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">docker</span> inspect spuacv/spuc:latest <span class="at">-f</span> <span class="st">"Entrypoint: {{.Config.Entrypoint}}"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Entrypoint: [python /spuc/spuc.py]</code></pre>
</div>
<p>or even get them both at the same time:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">docker</span> inspect spuacv/spuc:latest <span class="at">-f</span> <span class="st">"Command: {{.Config.Cmd}}\nEntrypoint: {{.Config.Entrypoint}}"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Command: [--units iuhc]
Entrypoint: [python /spuc/spuc.py]</code></pre>
</div>
<p>Great! So we know what the command and entrypoint are… but what do
they mean?</p>
<div id="default-command" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="default-command" class="callout-inner">
<h3 class="callout-title">Default Command</h3>
<div class="callout-content">
<p>The default command is the command that a container will run when it
is started. The default values are specified by the creator of an image,
but can be overridden when the container is run.</p>
<p>The default command is formed of two parts, the <em>entrypoint</em>
and the <em>command</em>. The two are concatenated to form the full
command.</p>
<div class="section level3">
<h3 id="todo-add-a-diagram-showing-the-structure-of-the-default-command-putting-the-bullet-points-in-the-image-as-you-did-with-the-docker-command-diagram-">TODO: Add a diagram showing the structure of the default command,
putting the bullet points in the image, as you did with the docker
command diagram.<a class="anchor" aria-label="anchor" href="#todo-add-a-diagram-showing-the-structure-of-the-default-command-putting-the-bullet-points-in-the-image-as-you-did-with-the-docker-command-diagram-"></a>
</h3>
<ul>
<li>
<strong>Entrypoint</strong> is usually the base command for the
container. It is not often overwritten.</li>
<li>
<strong>Command</strong> is commonly the set of parameters for the
base command. This is overwritten frequently.</li>
</ul>
<p>In our case, the entrypoint is <code>python /spuc/spuc.py</code> and
the command is <code>--units iuhc</code>. This means that when the
container is run, it will execute the command
<code>python /spuc/spuc.py --units iuhc</code>.</p>
<p>As mentioned, the command is commonly overwritten when the container
is run. This means we could pass different parameters to the python
script when we run the container.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="running">Running<a class="anchor" aria-label="anchor" href="#running"></a>
</h2>
<hr class="half-width">
<p>Now that we have the image, and we know what it will do, let’s run
it!</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">docker</span> run spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
            \
             \
              \\
               \\\
                &gt;\/7
            _.-(º   \
           (=___._/` \            ____  ____  _    _  ____
                )  \ |\          / ___||  _ \| |  | |/ ___|
               /   / ||\         \___ \| |_) | |  | | |
              /    &gt; /\\\         ___) |  __/| |__| | |___
             j    &lt; _\           |____/|_|    \____/ \____|
         _.-' :      ``.
         \ r=._\        `.       Space Purple Unicorn Counter
        &lt;`\\_  \         .`-.
         \ r-7  `-. ._  ' .  `\
          \`,      `-.`7  7)   )
           \/         \|  \'  / `-._
                      ||    .'
                       \\  (
                        &gt;\  &gt;
                    ,.-' &gt;.'
                   &lt;.'_.''
                     &lt;'


Welcome to the Space Purple Unicorn Counter!

:::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::")

:: Try recording a unicorn sighting with:
    curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100</code></pre>
</div>
<p>And there we have it! The SPUC container is running and ready to
count unicorns. What we are seeing now is the equivalent of the ‘Logs’
tab in Docker Desktop.</p>
<p>The only problem we have though, is that it is ‘blocking’ this
terminal, so we can’t run any more commands until we stop the
container.</p>
<p>Let’s stop the container using <code>[Ctrl+C]</code>, and run it
again, but in the background, ‘detached’ from the terminal, using the
<code>-d</code> flag:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0bb79cbb589652c265552913f6de7992cd996f6da97ecc9ba43672fe34ff5f23</code></pre>
</div>
<p><strong>Note:</strong> The <code>-d</code> flag needs to go in front
of the image name!</p>
<p>But what is happening? We can’t see the output of the container
anymore! Is the container running or not?</p>
</section><section><h2 class="section-heading" id="listing-containers">Listing Containers<a class="anchor" aria-label="anchor" href="#listing-containers"></a>
</h2>
<hr class="half-width">
<p>To see what is happening, we can use the <code>docker ps</code>
command:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">docker</span> ps</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CONTAINER ID   IMAGE                  COMMAND                  CREATED              STATUS              PORTS        NAMES
0bb79cbb5896   spuacv/spuc:latest     "python /spuc/spuc.p…"   About a minute ago   Up About a minute   8321/tcp     ecstatic_nightingale</code></pre>
</div>
<p>This command lists all the containers that are currently running. It
is the equivalent of the ‘Containers’ tab in Docker Desktop, except that
it only shows running containers. You can see that the SPUC container is
running, and that it has been given a random name
<code>ecstatic_nightingale</code>.</p>
<p>If you want to see all containers, including those that are stopped,
you can use the <code>-a</code> flag:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">docker</span> ps <span class="at">-a</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CONTAINER ID   IMAGE                  COMMAND                  CREATED              STATUS                       PORTS        NAMES
0bb79cbb5896   spuacv/spuc:latest     "python /spuc/spuc.p…"   About a minute ago   Up About a minute            8321/tcp     ecstatic_nightingale
03ef43deee20   spuacv/spuc:latest     "python /spuc/spuc.p…"   10 minutes ago       Exited (0) 10 minutes ago                 suspicious_beaver</code></pre>
</div>
</section><section><h2 class="section-heading" id="logs">Logs<a class="anchor" aria-label="anchor" href="#logs"></a>
</h2>
<hr class="half-width">
<p>So we know it is running, but we can’t see the output of the
container. We can still access them though, we just need to ask Docker
for the logs:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">docker</span> logs ecstatic_nightingale</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
            \
             \
              \\
               \\\
                &gt;\/7
            _.-(º   \
           (=___._/` \            ____  ____  _    _  ____
                )  \ |\          / ___||  _ \| |  | |/ ___|
               /   / ||\         \___ \| |_) | |  | | |
              /    &gt; /\\\         ___) |  __/| |__| | |___
             j    &lt; _\           |____/|_|    \____/ \____|
         _.-' :      ``.
         \ r=._\        `.       Space Purple Unicorn Counter
        &lt;`\\_  \         .`-.
         \ r-7  `-. ._  ' .  `\
          \`,      `-.`7  7)   )
           \/         \|  \'  / `-._
                      ||    .'
                       \\  (
                        &gt;\  &gt;
                    ,.-' &gt;.'
                   &lt;.'_.''
                     &lt;'


Welcome to the Space Purple Unicorn Counter!

:::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::")

:: Try recording a unicorn sighting with:
    curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100</code></pre>
</div>
<p>Notice that we had to use the name of the container,
<code>ecstatic_nightingale</code>, to get the logs. This is because the
<code>docker logs</code> command requires the name of the
<strong>container</strong> not the <strong>image</strong>.</p>
<p>Great, now that we have a container in the background, lets try to
register a unicorn sighting!</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=100</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>curl: (7) Failed to connect to localhost port 8321 after 0 ms: Couldn't connect to server</code></pre>
</div>
<p>That is right! We need to expose the port to the host machine, as we
did in Docker Desktop.</p>
</section><section><h2 class="section-heading" id="exposing-ports">Exposing ports<a class="anchor" aria-label="anchor" href="#exposing-ports"></a>
</h2>
<hr class="half-width">
<p>The container is running in its own isolated environment. To be able
to communicate with it, we need to tell Docker to expose the port to the
host machine.</p>
<p>This can be done using the <code>-p</code> flag. We also need to
specify the port to be used on the host machine and the port to expose
on the container, like so:</p>
<pre><code>-p &lt;host_port&gt;:&lt;container_port&gt;</code></pre>
<p>In this case we want to expose port 8321 on the host machine to port
8321 on the container:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">-p</span> 8321:8321 spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>6edf9ebd404625541fdb674d1a696707bad775a0161882ef459c5cbcb151e24b</code></pre>
</div>
<p>If you now look at the container that is running, you will see that
the port is exposed:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">docker</span> ps</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CONTAINER ID   IMAGE               COMMAND                  CREATED         STATUS         PORTS                                       NAMES
6edf9ebd4046   spuacv/spuc:latest  "python /spuc/spuc.p…"   4 seconds ago   Up 3 seconds   0.0.0.0:8321-&gt;8321/tcp, :::8321-&gt;8321/tcp   unruffled_noyce</code></pre>
</div>
<div class="section level3">
<h3 id="todo-why-does-it-say-8321-8321tcp">TODO why does it say <code>:::8321-&gt;8321/tcp</code>?<a class="anchor" aria-label="anchor" href="#todo-why-does-it-say-8321-8321tcp"></a>
</h3>
<p>So we can finally try to register a unicorn sighting:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=100</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span></code></pre>
</div>
<p>And of course we can check the logs if we want to:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="ex">docker</span> logs unruffled_noyce</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]

::::: 2024-10-15 11:19:47.751212 Unicorn spotted at moon!! Brightness: 100 iuhc</code></pre>
</div>
<p>It can be quite inconvenient to have to find out the name of the
container every time we want to see the logs, and it is not the only
time in which we’ll need the name of the container to interact with it.
We can make our lives easier by naming the container when we run it.</p>
</div>
</section><section><h2 class="section-heading" id="setting-the-name-of-a-container">Setting the name of a container<a class="anchor" aria-label="anchor" href="#setting-the-name-of-a-container"></a>
</h2>
<hr class="half-width">
<p>We can name the container when we run it using the
<code>--name</code> flag:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>4696d5301a792451f9954ba10cc42604a904fa1a811362733050ba04270c02eb
docker: Error response from daemon: driver failed programming external
connectivity on endpoint spuc_container (67e075648d16fafdf086573169d891bee9b33bec0c1cb5535cf82c715241bb32):
 Bind for 0.0.0.0:8321 failed: port is already allocated.</code></pre>
</div>
<p>Oops! It looks like we already have a container running on port 8321.
Of course, it is the container that we ran earlier, unruffled_noyce, and
we can’t have two containers running on the same port!</p>
<p>To fix this, we can stop the container that is running on port 8321
using the <code>docker stop</code> command:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="ex">docker</span> stop unruffled_noyce</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">unruffled_noyce</span></span></code></pre>
</div>
<p><strong>Note:</strong> Using
<code>docker kill &lt;container_name&gt;</code>, will also work,
although it is best to leave that as a last resort.</p>
<p>Right, now we can try running the container again:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">bf9b2abc95a7c7f25dc8c1c4c334fcf4ce9642754ed7f6b5586d82f9e9e45ac7</span></span></code></pre>
</div>
<p>And now we can see the logs using the name of the container, and even
follow the logs in real time using the <code>-f</code> flag:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="ex">docker</span> logs <span class="at">-f</span> spuc_container</span></code></pre>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Logs
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
            \
             \
              \\
               \\\
                &gt;\/7
            _.-(º   \
           (=___._/` \            ____  ____  _    _  ____
                )  \ |\          / ___||  _ \| |  | |/ ___|
               /   / ||\         \___ \| |_) | |  | | |
              /    &gt; /\\\         ___) |  __/| |__| | |___
             j    &lt; _\           |____/|_|    \____/ \____|
         _.-' :      ``.
         \ r=._\        `.       Space Purple Unicorn Counter
        &lt;`\\_  \         .`-.
         \ r-7  `-. ._  ' .  `\
          \`,      `-.`7  7)   )
           \/         \|  \'  / `-._
                      ||    .'
                       \\  (
                        &gt;\  &gt;
                    ,.-' &gt;.'
                   &lt;.'_.''
                     &lt;'


Welcome to the Space Purple Unicorn Counter!

:::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::")

:: Try recording a unicorn sighting with:
    curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100
</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>This also blocks the terminal, so you will need to use
<code>[Ctrl+C]</code> to stop following the logs. There is an important
difference though. Because the container is running in the background,
using <code>[Ctrl+C]</code> will not stop the container, only the log
following.</p>
</section><section><h2 class="section-heading" id="executing-commands-in-a-running-container">Executing commands in a running container<a class="anchor" aria-label="anchor" href="#executing-commands-in-a-running-container"></a>
</h2>
<hr class="half-width">
<p>One of the very useful things we could do in docker compose was to
run commands inside a container. If you remember, we could do this using
the <code>Exec</code> tab. In the Docker CLI, we can do this using the
<code>docker exec</code> command. Lets try for example:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="ex">docker</span> exec spuc_container cat config/print.config</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># This file configures the print output to the terminal.
# Available variables are: count, time, location, brightness, units
# The values of these variables will be replaced if wrapped in curly braces.
# Lines beginning with # are ignored.
::::: {time} Unicorn spotted at {location}!! Brightness: {brightness} {units}</code></pre>
</div>
<p>This command runs <code>cat config/print.config</code> inside the
container. This is a step forward, but it is not quite the experience we
had in Docker Desktop. There, we had a live terminal <em>inside</em> the
container, and we could run commands interactively.</p>
<p>To do that, we need to use the <code>-it</code> flag, and specify a
command that will load the terminal, i.e. <code>bash</code>. Let’s try
launching an interactive terminal session inside the container, running
the bash shell:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> spuc_container bash</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>root@50159dddde44:/spuc#</code></pre>
</div>
<p>This is more like it! now we can run commands as if we were inside
the container itself, as we did in Docker Desktop.</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="ex">apt</span> update</span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a><span class="ex">apt</span> install tree</span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a><span class="ex">tree</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]

.
├── __pycache__
│   └── strings.cpython-312.pyc
├── config
│   └── print.config
├── output
├── requirements.txt
├── spuc.py
└── strings.py

4 directories, 5 files</code></pre>
</div>
<p>To get out from this interactive session, we need to use
<code>[Ctrl+D]</code>, or type <code>exit</code>.</p>
<div id="interactive-sessions" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="interactive-sessions" class="callout-inner">
<h3 class="callout-title">Interactive sessions</h3>
<div class="callout-content">
<p>The <code>-it</code> flag that we just used is very useful. It
actually helps us overcome the problem we had with the
<code>alpine</code> container in the previous episode. If we were to
simply run the <code>alpine</code> container we would have the same
issue we had before. Namely, the container exits immediately and we
can’t <code>exec</code> into it. However, we can use the
<code>-it</code> flag on the <code>run</code> command, and get an
interactive terminal session inside the container:</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> alpine:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Unable to find image 'alpine:latest' locally
latest: Pulling from library/alpine
43c4264eed91: Pull complete
Digest: sha256:beefdbd8a1da6d2915566fde36db9db0b524eb737fc57cd1367effd16dc0d06d
Status: Downloaded newer image for alpine:latest
/ #</code></pre>
</div>
<p>We are inside the container, and it stayed alive because we are
running an interactive session. We can play inside as much as we want,
and when we are done, we can simply type <code>exit</code> to leave the
container. As opposed to the <code>spuc</code> container, which was
running a service and we exec’ed into, this container will be terminated
on exit.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="reviving-containers">Reviving Containers<a class="anchor" aria-label="anchor" href="#reviving-containers"></a>
</h2>
<hr class="half-width">
<p>Another thing Docker Desktop allowed us to do was to wake up a
previously stopped container. We can of course do the same thing in the
Docker CLI.</p>
<p>To show this, lets first stop the container we have running:</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="ex">docker</span> stop spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">spuc_container</span></span></code></pre>
</div>
<p>To <em>revive</em> the container, we can use the
<code>docker start</code> command:</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="ex">docker</span> start spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">spuc_container</span></span></code></pre>
</div>
<p>We could now check that the container is running again using the
<code>docker ps</code> command. However, lets try another useful
command:</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="ex">docker</span> stats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CONTAINER ID   NAME              CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O        PIDS
bf9b2abc95a7   spuc_container    0.01%     23.61MiB / 15.29GiB   0.15%     23.6kB / 589B     5.1MB / 201kB    5</code></pre>
</div>
<p>This command lets us see the live resource usage of containers,
similar to the task manager on Windows or top on Linux. We can exit the
stats with <code>[Ctrl+C]</code>.</p>
<p>As we can see, the container is alive and well, and we can now exec
into it again if we want to.</p>
</section><section><h2 class="section-heading" id="cleaning-up">Cleaning up<a class="anchor" aria-label="anchor" href="#cleaning-up"></a>
</h2>
<hr class="half-width">
<p>The last thing we need to know is how to clean up after ourselves. We
can do this using the <code>docker rm</code> command to remove a
container, and the <code>docker image rm</code> command to remove an
image:</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="ex">docker</span> stop spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">spuc_container</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="ex">docker</span> rm spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">spuc_container</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="ex">docker</span> image rm spuacv/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Untagged: spuacv/spuc:latest
Untagged: spuacv/spuc@sha256:ad219064aaaad76860c53ec8420730d69dc5f8beb9345b0a15176111c2a976c5
Deleted: sha256:ce72bd42e51c049fe29b4c15dc912e88c4461e94c2e1d403b90e2e53dfb1b420
Deleted: sha256:975e4f6d3de315ced48fa0d0eda7e3af5cd4953c16adfbd443e65d6d2bf0eaa6
Deleted: sha256:f3fc2c0e51d4240d55e40b0305762df66600cdd5073a5c92008cfe8f867f5437
Deleted: sha256:f3e2fffff5c16237e6507a6196eb76fd2eba64e343c3a1b2692b73b95fcd1298
Deleted: sha256:d4d3e0d103c04b9fd2eb428699c46302a3d38d695729ee49068be07ad7e5c442
Deleted: sha256:700c7bb1865e2ca492d821c689f11175c66e9d27f210b3f04521040290c34126
Deleted: sha256:5d5adb77457c9a495a5037ce44a0db461b8d3b605177a2c3bc6dc0d7876a681d
Deleted: sha256:3a77b40519ce3ffa585333bab02f30371b4c8c7ffa10a35fd4c82a0d3423fa91
Deleted: sha256:791eb7562f83ac1fc48aa6f31129bf947d7de7d8c9b85db92131c3beb5650bd6
Deleted: sha256:c59180f9a5f41ea7e3d92ee36d5b4c01dadf5148075c0d01c394f7efc321a3ca
Deleted: sha256:8d853c8add5d1e7b0aafc4b68a3d9fb8e7a0da27970c2acf831fe63be4a0cd2c</code></pre>
</div>
<p>An alternative is to do a single-line full clean up. We can also
remove all stopped containers and unused images using the
<code>docker system prune</code> command:</p>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="ex">docker</span> system prune</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARNING! This will remove:
  - all stopped containers
  - all networks not used by at least one container
  - all dangling images
  - unused build cache

Are you sure you want to continue? [y/N] y
Deleted Containers:
90d006980a999176dd82e95119556cdf62431c26147bdbd3513e1733be1a5897

Deleted Images:
untagged: ghcr.io/uomresearchit/spuc@sha256:bc43ebfe7dbdbac5bc0b4d849dd2654206f4e4ed1fb87c827b91be56ce107f2e
deleted: sha256:f03fb04b8bc613f46cc1d1915d2f98dcb6e008ae8e212ae9a3dbfaa68c111476

Total reclaimed space: 13.09MB</code></pre>
</div>
<div class="section level3">
<h3 id="automatic-cleanup">Automatic cleanup<a class="anchor" aria-label="anchor" href="#automatic-cleanup"></a>
</h3>
<p>There is one more point to make. It is nice not to have to clean up
containers manually all the time. Luckily, the Docker CLI has a flag
that will remove the container when it is stopped: <code>--rm</code>.
This can be very useful, especially when you are naming containers, as
it prevents name conflicts.</p>
<p>Lets try it:</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 spuacv/spuc:latest</span></code></pre>
</div>
<p>We can verify that the container exists using <code>docker ps</code>.
When the container is stopped, however, the container is automatically
removed. We don’t have to worry about cleaning up afterwards, but it
comes at a price. Since we’ve deleted the container, there is no way to
bring it back.</p>
<p>We will use the command going forward, as it is a good practice to
keep your system clean and tidy.</p>
<p><br></p>
<p>The last command we ran is a relatively standard command in the
Docker CLI. If you are thinking “wow, that command is getting pretty
long…”, you are right! Things will get even worse before they get
better, but we will cover how to manage this later in the course.</p>
<p>We are now equipped with everything we saw we could do in Docker
Desktop, but with steroids. There are many more things we can do with
the Docker CLI, including data persistance. We will cover these in the
next episode.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>All the commands are structured with a main command, a specialising
command, an action command, and the name of the object to act on.</li>
<li>Everything we did in Docker Desktop (and more!) can be done in the
Docker CLI with:</li>
</ul>
<table class="table">
<colgroup>
<col width="40%">
<col width="59%">
</colgroup>
<thead><tr class="header">
<th>Command</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Images</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>docker pull &lt;image&gt;</code></td>
<td>Pull an image from a registry</td>
</tr>
<tr class="odd">
<td><code>docker image ls</code></td>
<td>List all images on the system</td>
</tr>
<tr class="even">
<td><code>docker inspect &lt;image&gt;</code></td>
<td>Show detailed information about an image</td>
</tr>
<tr class="odd">
<td><code>docker run &lt;image&gt;</code></td>
<td>Run a container from an image</td>
</tr>
<tr class="even">
<td><code>docker image rm &lt;image&gt;</code></td>
<td>Remove an image</td>
</tr>
<tr class="odd">
<td><strong>Containers</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>docker logs &lt;container&gt;</code></td>
<td>Show the logs of a container</td>
</tr>
<tr class="odd">
<td><code>docker exec &lt;container&gt; &lt;cmd&gt;</code></td>
<td>Run a command in a running container</td>
</tr>
<tr class="even">
<td><code>docker stop &lt;container&gt;</code></td>
<td>Stop a running container</td>
</tr>
<tr class="odd">
<td><code>docker start &lt;container&gt;</code></td>
<td>Start a stopped container</td>
</tr>
<tr class="even">
<td><code>docker rm &lt;container&gt;</code></td>
<td>Remove a container</td>
</tr>
<tr class="odd">
<td><strong>System</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code>docker ps</code></td>
<td>List all running containers</td>
</tr>
<tr class="odd">
<td><code>docker stats</code></td>
<td>Show live resource usage of containers</td>
</tr>
<tr class="even">
<td><code>docker system prune</code></td>
<td>Remove all stopped containers and unused images</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="12%">
<col width="19%">
<col width="67%">
</colgroup>
<thead><tr class="header">
<th>Flag</th>
<th>Used on</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>-f</code></td>
<td><code>inspect</code></td>
<td>Specify the output format</td>
</tr>
<tr class="even">
<td><code>-f</code></td>
<td><code>logs</code></td>
<td>Follow the logs in real time</td>
</tr>
<tr class="odd">
<td><code>-a</code></td>
<td><code>ps</code></td>
<td>List all containers, including stopped ones</td>
</tr>
<tr class="even">
<td><code>-it</code></td>
<td>
<code>run</code>, <code>exec</code>
</td>
<td>Interactively run a command in a running container</td>
</tr>
<tr class="odd">
<td><code>-d</code></td>
<td><code>run</code></td>
<td>Run a container in the background</td>
</tr>
<tr class="even">
<td><code>-p</code></td>
<td><code>run</code></td>
<td>Expose a port from the container to the host</td>
</tr>
<tr class="odd">
<td><code>--name</code></td>
<td><code>run</code></td>
<td>Name a container</td>
</tr>
<tr class="even">
<td><code>--rm</code></td>
<td><code>run</code></td>
<td>Remove the container when it is stopped</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section></section><section id="aio-docker-cli-advanced"><p>Content from <a href="docker-cli-advanced.html">Using the full power of the Docker CLI</a></p>
<hr>
<p>Last updated on 2024-10-15 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-cli-advanced.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>Now that we have learned the basics of the Docker CLI, getting set up
with all the tools we came across in Docker Desktop, we can start to
explore the full power of Docker!</p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What actually happens when I run a container?</li>
<li>How can I control the behaviour of containers?</li>
<li>How do I get data in and out of containers?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn the lifecycle of Docker containers</li>
<li>Learn about Entrypoints and Commands and how to manipulate them</li>
<li>Learn how to use files with container using mounts and volumes</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="data-in-containers">Data in containers<a class="anchor" aria-label="anchor" href="#data-in-containers"></a>
</h1>
<p>In the earlier section on Docker Desktop, we learned how to interact
with containers and used this to have a look at the
unicorn_sightings.txt file.</p>
<p>It is quite annoying that the file does not persist between runs of
the container! Also, with the file being in the container, we can’t
(easily) do much with it.</p>
<p>This is where the Docker CLI starts to shine.</p>
<div class="section level2">
<h2 id="making-our-data-persist">Making our data persist<a class="anchor" aria-label="anchor" href="#making-our-data-persist"></a>
</h2>
<p>Docker containers are naturally isolated from the host system,
meaning that they have their own filesystems and cannot access the host
filesystem.</p>
<p>They are also ephemeral, meaning that they are designed to be
temporary and are destroyed when they are stopped.</p>
<p>This is mostly a good thing, as it means that containers are
lightweight and can be easily recreated, but we can’t be throwing our
unicorn sightings away like this!</p>
<p>Luckily, Docker has methods for allowing containers to persist
data.</p>
<div class="section level3">
<h3 id="volumes">Volumes<a class="anchor" aria-label="anchor" href="#volumes"></a>
</h3>
<p>The first way to allow a container to access the host filesystem is
by using a <code>volume</code>. A volume is a specially designated
directory on the host filesystem which is shared with the container,
hidden away deep in the host filesystem.</p>
<p>Volumes are very tightly controlled by Docker, and are designed to be
used for sharing data between containers, or for persisting data between
runs of a container. They are very useful, but can be a bit tricky to
use.</p>
<p>Let’s have a look at how we can use a volume to persist the
<code>unicorn_sightings.txt</code> file between runs of the
container.</p>
<p>We do this by modifying our <code>docker run</code> command to
include a <code>-v</code> (for volume) flag, a volume name and a path
inside the container.</p>
<p><strong>Note</strong>: You have to be <em>really</em> careful with
the syntax for this command. See the challenge box below for common
mistakes (and their resolution).</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> spuc-volume:/output ghcr.io/uomresearchit/spuc:latest</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">f1bd2bb9062348b6a1815f5076fcd1b79e603020c2d58436408c6c60da7e73d2</span></span></code></pre>
</div>
<p>Ok! But what is happening?</p>
<p>We can see what containers we have created using:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> docker volume ls</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>local     spuc-volume</code></pre>
</div>
<p>And we can see information about the volume using:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> docker volume inspect spuc-volume</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[
    {
        "CreatedAt": "2024-10-11T11:15:09+01:00",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/spuc-volume/_data",
        "Name": "spuc-volume",
        "Options": null,
        "Scope": "local"
    }
]</code></pre>
</div>
<p>Which shows us that the volume is stored in
<code>/var/lib/docker/volumes/spuc-volume/_data</code> on the host
filesystem. Which you can visit if you have superuser permissions
(sudo).</p>
<p>But what about the container? Has this actually worked? Let’s record
some sightings and see if they persist between runs.</p>
<p>First, what’s that over there?? A unicorn! No… three unicorns! Let’s
record these sightings.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=100</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=earth\&amp;brightness=10</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=mars\&amp;brightness=400</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span>
<span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span>
<span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span></code></pre>
</div>
<p>Ok, let’s check the sightings file.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> docker exec spuc_container cat /code/output/unicorn_sightings.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>time,brightness,unit
2024-10-11 10:30:18.927696,100,iuhc
2024-10-11 10:30:25.744330,10,iuhc
2024-10-11 10:30:30.005247,400,iuhc</code></pre>
</div>
<p>Now for our test, we will stop the container, run it again and check
the sightings file.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> docker stop spuc_container</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> spuc-volume:/code/output ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="ex">$</span> docker exec spuc_container cat /code/output/unicorn_sightings.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>time,brightness,unit
2024-10-11 10:30:18.927696,100,iuhc
2024-10-11 10:30:25.744330,10,iuhc
2024-10-11 10:30:30.005247,400,iuh</code></pre>
</div>
<p>So there we have it! The sightings persist between runs of the
container. This is a great way to keep data between runs of a container,
but watch out for the syntax!</p>
<div id="common-mistakes-with-volumes" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="common-mistakes-with-volumes" class="callout-inner">
<h3 class="callout-title">Common mistakes with volumes</h3>
<div class="callout-content">
<p>Given you are in a directory containing a directory named
<code>spuc</code>, what will happen when you run the following
commands?</p>
<ol style="list-style-type: upper-alpha">
<li><p>$ docker run -v ./spuc-volume:/foo spuc:latest</p></li>
<li><p>$ docker run -v spuc-volume:/foo spuc:latest</p></li>
<li><p>$ docker run -v ./spuc:/foo spuc:latest</p></li>
<li><p>$ docker run -v ${PWD}/spuc:/foo spuc:latest</p></li>
<li><p>$ docker run -v ${PWD}/spucs:/foo spuc:latest</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: upper-alpha">
<li>The path to the volume must be an absolute path, not a relative
path. You can use the $PWD environment variable to get the current
working directory. This will create a (root owned) directory in the
current working directory, which is not what you want. Use “sudo rm -rf
./spuc-volume” to remove the volume and try again.</li>
<li>This is the correct syntax for creating a volume. This will create a
volume called spuc-volume and mount it to the /foo directory in the
container.</li>
<li>Because ./spuc is not an absolute path, this will create a new
volume called spuc and mount it to the /foo directory in the container.
This is not what you want. Use “sudo rm -rf ./spuc” to remove the volume
and try again.</li>
<li>This is valid syntax but not for creating a volume! This will create
a bind mount instead. More on these next.</li>
<li>This will create a new volume called spuc<strong>s</strong> and
mount it to the /foo directory in the container. This is not what you
want. Use “sudo rm -rf ./spucs” to remove the volume and try again.</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="bind-mounting-directories">Bind mounting directories<a class="anchor" aria-label="anchor" href="#bind-mounting-directories"></a>
</h3>
<p>The second way to allow a container to access the host filesystem is
by using a <code>bind mount</code>. A bind mount is a direct mapping of
a directory on the host filesystem to a directory in the container
filesystem.</p>
<p>This can be appealing, as it allows you to directly access files on
the host filesystem from the container, but it has its own
challenges.</p>
<p>Let’s have a look at how we can use a bind mount to persist the
<code>unicorn_sightings.txt</code> file between runs of the
container.</p>
<p>Confusingly, bind mounting is also done using the <code>-v</code>
flag, but with a different syntax. We specify an
<strong>absolute</strong> path to the directory on the host filesystem,
followed by a colon, followed by the path to the directory in the
container filesystem.</p>
<p>It can be annoying to type the full path to a directory, so we can
use the <code>$PWD</code> environment variable to get the current
working directory.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> docker stop spuc_container </span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> <span class="va">$PWD</span>/spuc:/code/output ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=mars\&amp;brightness=400</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="ex">$</span> tree spuc/</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>spuc/
└── unicorn_sightings.txt</code></pre>
</div>
<p>So now we can access the /code/output directory in the container on
the host filesystem. This is totally functional way to persist data
between runs of a container but there are downsides.</p>
<p>To illusrate this, let’s see what the permissions are on the file we
just created.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-l</span> spuc/unicorn_sightings.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>-rw-r--r-- 1 root root 57 Oct 11 14:14 spuc/unicorn_sightings.txt</code></pre>
</div>
<p>Argh, the file is owned by root!</p>
<p>This is because the container runs as root, and so any files created
by the container are owned by root. This can be a problem, as you will
not have permission to access the file without using
<code>sudo</code>.</p>
<p>This is a common problem with bind mounts, and can be a bit of a pain
to deal with. You can change the ownership of the file using
<code>sudo chown</code>, but this can be a bit of a hassle.</p>
<p>Additionally, it is hard for Docker to clean up bind mounts, as they
are not managed by Docker. The management of bind mounts is left to the
user.</p>
<p>Really, neither volumes nor bind mounts are perfect, but they are
both useful tools for persisting data between runs of a container and
have both allowed us to keep the unicorn_sightings.txt file between runs
of the container.</p>
<p>Later in these lessons we will see some more ergonomic ways to work
with volumes and bind mounts.</p>
</div>
</div>
<div class="section level2">
<h2 id="sharing-files-with-containers">Sharing files with containers<a class="anchor" aria-label="anchor" href="#sharing-files-with-containers"></a>
</h2>
<p>Earlier, we looked at how to change the config file in SPUC to enable
exporting. This was a bit of a hassle, as we had to use the Docker
Desktop interface to do this and it did not persist between runs of the
container.</p>
<p>We now have the tools to address this! We can use a bind mount to
share the config file with the container.</p>
<p>Let’s have a look at how we can do this. First we need to make the
config file itself.</p>
<p>The SPUC README on dockerhub tells us that the config file should be
in the following format:</p>
<pre class="plaintext"><code>::::: {time} Unicorn spotted at {location}!! Brightness: {brightness} {units}</code></pre>
<p>And should be present at <code>/code/config/print.config</code>.</p>
<p>Let’s get to it then. First we need to make the file (on the
host).</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">"::::: {time} Unicorn spotted at {location}!! Brightness: {brightness} {units}"</span> <span class="op">&gt;</span> print.config</span></code></pre>
</div>
<p>Now we can bind mount this file to the container. Again we will use
<code>-v</code> and the <code>$PWD</code> environment variable to get
the current working directory. This time, however, we will specify a
specific file to mount, not a directory.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">$</span> docker stop spuc_container</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> <span class="va">$PWD</span>/print.config:/code/config/print.config <span class="at">-v</span> spuc-volume:/code/output ghcr.io/uomresearchit/spuc:latest</span></code></pre>
</div>
<p>Now if we check the logs of the container, we can see that the config
file has been loaded correctly and that the print format has been
changed.</p>
<p>First, let’s record another sighting, then check the logs.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=100</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="ex">$</span> docker logs spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
[...]
::::: (2024-10-11 14:29:07.548965) Unicorn spotted at moon!! Brightness: 100 iuhc</code></pre>
</div>
<p>Fantastic! We have now managed to share a file with the container,
and have changed the behaviour of the container using this file.</p>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>We have learned about volumes and bind mounts, two ways to allow a
container to access the host filesystem. We have used these to persist
data between runs of a container and to share files with a
container.</p>
<p>They can both be a bit tricky to use, but are very useful tools for
working with containers and have helped us get SPUC working much more
like we want it to.</p>
</div>
</div>
<div class="section level2">
<h2 id="setting-the-environment">Setting the environment<a class="anchor" aria-label="anchor" href="#setting-the-environment"></a>
</h2>
<p>One other interesting reading from the SPUC README is the presence of
an environment variable, <code>EXPORT</code> which can be set to
<code>True</code> to enable an API endpoint for exporting the unicorn
sightings.</p>
<p>This sounds like a useful feature, but how can we set an environment
variable in a container?</p>
<p>Thankfully this is quite straightforward, we can use the
<code>-e</code> flag to set an environment variable in a container.</p>
<p>Modifying our run command again:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">$</span> docker stop spuc_container</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> <span class="va">$PWD</span>/print.config:/code/config/print.config <span class="at">-v</span> spuc-volume:/code/output <span class="at">-e</span> EXPORT=true ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="ex">$</span> docker logs spuc_container</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
::::: Initializing SPUC...
::::: Units set to Imperial Unicorn Hoove Candles [iuhc].

Welcome to the Space Purple Unicorn Counter!
::::: Try 'curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100' to record a unicorn sighting!
::::: Or 'curl localhost:8321/export' to download the unicorn sightings file!</code></pre>
</div>
<p>And now we can see that the export endpoint is available!</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="ex">$</span> curl localhost:8321/export</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>time,brightness,unit
2024-10-11 14:43:42.060883,100,iuhc
2024-10-11 14:43:48.064323,400,iuhc
2024-10-11 14:43:49.972220,10,iuhc</code></pre>
</div>
<p>This is great! No need to bind mount or exec to get the data out of
the container, we can just use the API endpoint.</p>
<p>Defaulting to network style connections is very common in Docker
containers and saves a lot of hassle.</p>
<p>Environment variables are a very common tool for configuring
containers. They are used to set things like API keys, database
connection strings, and other configuration options.</p>
</div>
<div class="section level2">
<h2 id="passing-parameters">Passing parameters<a class="anchor" aria-label="anchor" href="#passing-parameters"></a>
</h2>
<p>Finally, we must address a very serious shortcoming of the SPUC
container. It is recording the brightness of the unicorns in Imperial
Unicorn Hoove Candles (iuhc)! This is a very outdated unit and we
<strong>must</strong> change it to metric.</p>
<p>Fortunately the SPUC README tells us that we can pass a parameter to
the container to set the units to metric. This is done by passing a
parameter to the container when it is run, overriding the default
command.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">$</span> docker stop spuc_container</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> <span class="va">$PWD</span>/print.config:/code/config/print.config <span class="at">-v</span> spuc-volume:/code/output <span class="at">-e</span> EXPORT=true ghcr.io/uomresearchit/spuc:latest <span class="at">--units</span> iulu</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=earth\&amp;brightness=10</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="ex">$</span> curl localhost:8321/export/</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>time,brightness,unit
2024-10-11 14:43:42.060883,100,iuhc
2024-10-11 14:43:48.064323,400,iuhc
2024-10-11 14:43:49.972220,10,iuhc
2024-10-11 15:30:27.823367,10,iulu</code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>You can also override the entrypoint of a container using the
<code>--entrypoint</code> flag. This is useful if you want to run a
different command in the container, or if you want to run the container
interactively.</p>
<p>You may recall:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">docker</span> inspect ghcr.io/uomresearchit/spuc:latest <span class="at">-f</span> <span class="st">"Entrypoint: {{.Config.Entrypoint}} Command: {{.Config.Cmd}}"</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="ex">Entrypoint:</span> [python /code/spuc.py] Command: [--units iuhc]</span></code></pre>
</div>
<p>That SPUC has an entrypoint of <code>python /code/spuc.py</code>
making it hard to interact with. We can override this using the
<code>--entrypoint</code> flag.</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-it</span> <span class="at">--rm</span> <span class="at">--entrypoint</span> /bin/sh ghcr.io/uomresearchit/spuc:latest</span></code></pre>
</div>
<div id="discussion2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Which of these are valid entrypoint and command combinations for the
SPUC container? What are the advantages and disadvantages of each?</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th>Entrypoint</th>
<th>Command</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>A</td>
<td><code>python /code/spuc.py --units iuhc</code></td>
<td></td>
</tr>
<tr class="even">
<td>B</td>
<td><code>python /code/spuc.py</code></td>
<td><code>--units iuhc</code></td>
</tr>
<tr class="odd">
<td>C</td>
<td><code>python</code></td>
<td><code>/code/spuc.py --units iuhc</code></td>
</tr>
<tr class="even">
<td>D</td>
<td></td>
<td><code>python /code/spuc.py --units iuhc</code></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>These are all valid combinations! The best choice depends on the use
case.</p>
<ol style="list-style-type: upper-alpha">
<li><p>This combination bakes the command and the parameters into the
image. This is useful if the command is always the same and the
specified parameters are unlikely to change (although more may be
appended).</p></li>
<li><p>This combination allows the command’s arguments to be changd
easily while baking in which Python script to run.</p></li>
<li><p>This combination allows the Python script to be changed easily,
which is more likely to be bad than good!</p></li>
<li><p>This combination allows maximum flexibility, but it requires the
user to know the correct command to run.</p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="summary-1">Summary<a class="anchor" aria-label="anchor" href="#summary-1"></a>
</h2>
<p>In this section, we have learned about volumes and bind mounts, two
ways to allow a container to access the host filesystem. We have used
these to persist data between runs of a container and to share files
with a container.</p>
<p>We have learned how to set environment variables and pass parameters
to containers, two ways to configure the behaviour of a container.</p>
<p>SPUC is now running with the correct units and we can export the
unicorn sightings using the API endpoint! And we are no longer losing
our unicorn sightings between runs of the container.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Volumes and bind mounts are two ways to allow a container to access
the host filesystem.</li>
<li>Environment variables and parameters can be used to configure the
behaviour of a container.</li>
</ul>
</div>
</div>
</div>
</div>
</div></section><section id="aio-docker-hub"><p>Content from <a href="docker-hub.html">The Docker Hub</a></p>
<hr>
<p>Last updated on 2024-10-15 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-hub.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 20 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>One of the reasons why Docker is useful is that there is a lot of
content (container images) already prepared to be used. Each container
image represents a complete software installation that you can use and
access without any extra work!</p>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is the Docker Hub, and why is it useful?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explore the Docker Hub webpage for a popular Docker container
image.</li>
<li>Find the list of tags for a particular Docker container image.</li>
<li>Identify the three components of a container image’s
identifier.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>A lot of these images are hosted in the Docker Hub.</p>
<section><h2 class="section-heading" id="introducing-the-docker-hub">Introducing the Docker Hub<a class="anchor" aria-label="anchor" href="#introducing-the-docker-hub"></a>
</h2>
<hr class="half-width">
<p>The Docker Hub is an online repository of container images, a vast
number of which are publicly available. A large number of the container
images are curated by the developers of the software that they package.
Also, many commonly used pieces of software that have been containerized
into images are officially endorsed, which means that you can trust the
container images to have been checked for functionality, stability, and
that they don’t contain malware.</p>
<div id="docker-can-be-used-without-connecting-to-the-docker-hub" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="docker-can-be-used-without-connecting-to-the-docker-hub" class="callout-inner">
<h3 class="callout-title">Docker can be used without connecting to the Docker Hub</h3>
<div class="callout-content">
<p>Note that while the Docker Hub is well integrated into Docker
functionality, the Docker Hub is certainly not required for all types of
use of Docker containers. For example, some organizations may run
container infrastructure that is entirely disconnected from the
Internet.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="exploring-an-example-docker-hub-page">Exploring an example Docker Hub page<a class="anchor" aria-label="anchor" href="#exploring-an-example-docker-hub-page"></a>
</h2>
<hr class="half-width">
<p>As an example of a Docker Hub page, let’s explore the page for the
official Python language container images. Open your web browser to <a href="https://hub.docker.com" class="external-link">https://hub.docker.com</a></p>
<figure><img src="../fig/docker-hub/landing.png" alt="Dockerhub_landing" class="figure mx-auto d-block"></figure><p>We will need to register for the later stages of this course, so feel
free to do so now if you are not already.</p>
<p>In the search bar type “python” and hit enter.</p>
<figure><img src="../fig/docker-hub/search_python.png" alt="Dockerhub_search" class="figure mx-auto d-block"></figure><p>You should see a list of images related to python. We can immediately
get a feel of the sheer number of container images hosted here. There is
upwards from 10,000 images related to python alone.</p>
<p>There is also some useful information that can help us choose the
image that we want, which we will point out in a moment.</p>
<p>For now, lets go to the top result, the <a href="https://hub.docker.com/_/python" class="external-link">python</a> container image (which
is endorsed by the Docker team) to see what is on a typical Docker Hub
software page.</p>
<figure><img src="../fig/docker-hub/python.png" alt="Dockerhub_python" class="figure mx-auto d-block"></figure><p>The top-left provides information about the name, short description,
popularity (i.e., more than a billion downloads in the case of this
container image), and endorsements.</p>
<p>The top-right provides the command to pull this container image to
your computer.</p>
<p>The main body of the page contains many used headings, such as:</p>
<ul>
<li>Which tags (i.e., container image versions) are supported.</li>
<li>Summary information about where to get help, which computer
architectures are supported, etc.</li>
<li>A longer description of the container image.</li>
<li>Examples of how to use the container image.</li>
<li>The license that applies.</li>
</ul>
<p>The “How to use the image” section of most container images’ pages
will provide examples that are likely to cover your intended use of the
container image.</p>
</section><section><h2 class="section-heading" id="container-image-versions-and-owners">Container Image versions and owners<a class="anchor" aria-label="anchor" href="#container-image-versions-and-owners"></a>
</h2>
<hr class="half-width">
<p>A single Docker Hub page can have many different versions of
container images, based on the version of the software inside. These
versions are indicated by “tags”. When referring to the specific version
of a container image by its tag, you use a colon, <code>:</code>, like
this:</p>
<pre><code><span><span class="va">CONTAINER_IMAGE_NAME</span><span class="op">:</span><span class="va">TAG</span></span></code></pre>
<p>If we click the version tag for <code>alpine3.18</code> of this
image, Docker Hub shows it as <code>python:alpine3.18</code></p>
<figure><img src="../fig/docker-hub/python_alpine318.png" alt="Dockerhub_python" class="figure mx-auto d-block"></figure><p>The default tag (which is used if you don’t specify one) is called
<code>latest</code>.</p>
<p>This container image is a “Docker Official Image”, which means that
the docker team mantains it and guarantees it. However, it’s equally
common to use container images that have been produced by individual
owners or organizations. Container images that you create and upload to
Docker Hub would fall into this category, as would the container images
maintained by organizations like <a href="https://hub.docker.com/u/continuumio" class="external-link">ContinuumIO</a> (the folks
who develop the Anaconda Python environment) or community groups like <a href="https://hub.docker.com/u/rocker" class="external-link">rocker</a>, a group that builds
community R container images.</p>
<p>In these cases, the “owner”, that is the group- or individual- that
manage the container image is part of the image name, and it is given in
the format:</p>
<pre><code><span><span class="va">OWNER</span><span class="op">/</span><span class="va">CONTAINER_IMAGE_NAME</span><span class="op">:</span><span class="va">TAG</span></span></code></pre>
<p>as can be seen in these examples</p>
<p><br></p>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  rocker/tidyverse:latest
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<figure><img src="../fig/docker-hub/tidyverse.gif" alt="rocker/tidyverse:latest" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  mathworks/matlab:r2022b
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<figure><img src="../fig/docker-hub/matlab.gif" alt="mathworks/matlab" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">
  continuumio/anaconda3:master
  </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<figure><img src="../fig/docker-hub/anaconda.gif" alt="continuumio/anaconda3" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="repositories" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="repositories" class="callout-inner">
<h3 class="callout-title">Repositories</h3>
<div class="callout-content">
<p>The technical name for the contents of a Docker Hub page is a
“repository.” The tag indicates the specific version of the container
image that you’d like to use from a particular repository. So a slightly
more accurate version of the above example is:</p>
<pre><code><span><span class="va">OWNER</span><span class="op">/</span><span class="va">REPOSITORY</span><span class="op">:</span><span class="va">TAG</span></span></code></pre>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="choosing-container-images-on-docker-hub">Choosing Container Images on Docker Hub<a class="anchor" aria-label="anchor" href="#choosing-container-images-on-docker-hub"></a>
</h2>
<hr class="half-width">
<p>Note that anyone can create an account on Docker Hub and share
container images there, so it’s important to exercise caution when
choosing a container image on Docker Hub. These are some indicators that
a container image on Docker Hub is consistently maintained, functional
and secure:</p>
<ul>
<li>The container image is updated regularly.</li>
<li>The container image associated with a well established company,
community, or other group that is well-known. Docker helps with badges
to mark official images, verified publishers and sponsored open source
software.</li>
<li>There is a Dockerfile or other listing of what has been installed to
the container image.</li>
<li>The container image page has documentation on how to use the
container image.</li>
<li>The container image is used by the wider community. The graph on the
right at the search page can help with this.</li>
</ul>
<p>If a container image is never updated, created by a random person,
and does not have a lot of metadata, it is probably worth skipping over.
Even if such a container image is secure, it is not reproducible and not
a dependable way to run research computations.</p>
</section><section><h2 class="section-heading" id="other-sources-of-container-images">Other sources of Container Images<a class="anchor" aria-label="anchor" href="#other-sources-of-container-images"></a>
</h2>
<hr class="half-width">
<p>Although many of the containers made for docker are hosted in the
Docker Hub, there are other places where these can be distributed,
including (but not limited to):</p>
<ul>
<li>
<a href="https://github.com/features/packages" class="external-link">GHCR</a> from
Github.</li>
<li>
<a href="https://quay.io/" class="external-link">Quay</a> from Red Hat.</li>
<li>
<a href="https://cloud.google.com/artifact-registry" class="external-link">Artifact
Registry</a> from Google.</li>
<li>
<a href="https://docs.gitlab.com/ee/user/packages/container_registry/" class="external-link">GLR</a>
from GitLab.</li>
<li>
<a href="https://aws.amazon.com/ecr/" class="external-link">ECR</a> from Amazon.</li>
<li>
<a href="https://azure.microsoft.com/en-us/products/container-registry" class="external-link">ACR</a>
from Azuere, Microsoft.</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The Docker Hub is an online repository of container images.</li>
<li>Many Docker Hub container images are public, and may be officially
endorsed.</li>
<li>Each Docker Hub page about a container image provides structured
information and subheadings</li>
<li>Most Docker Hub pages about container images contain sections that
provide examples of how to use those container images.</li>
<li>Many Docker Hub container images have multiple versions, indicated
by tags.</li>
<li>The naming convention for Docker container images is:
<code>OWNER/CONTAINER_IMAGE_NAME:TAG</code>
</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-creating-container-images"><p>Content from <a href="creating-container-images.html">Creating Your Own Container Images</a></p>
<hr>
<p>Last updated on 2024-10-15 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/creating-container-images.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I create my own container images?</li>
<li>What is a <code>Dockerfile</code>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to create your own container images using a
<code>Dockerfile</code>.</li>
<li>Learn about the core instruction set used in a
<code>Dockerfile</code>.</li>
<li>Learn how to build a container image from a
<code>Dockerfile</code>.</li>
<li>Learn how to run a container from a container image.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>We’ve been doing well picking things up from the SPUCS README! Let’s
keep the streak going.</p>
<p>There is another cool feature on there that we haven’t used yet - the
ability to add new Unicorn analysis features using plugins! Let’s try
that out.</p>
<p>The README says that we need to add a Python file at
<code>/spuc/plugins/</code> that defines an endpoint for the new
feature.</p>
<p>It would be very handy to be able to get some basic statistics about
our Unicorns. Let’s add a new plugin that will return a statstical
analysis of the brightness of the Unicorns in the database.</p>
<p>However you prefer - make a file <code>stats.py</code> with the
following content:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">from</span> __main__ <span class="im">import</span> app</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">from</span> __main__ <span class="im">import</span> file_path</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">'/stats'</span>, methods<span class="op">=</span>[<span class="st">'GET'</span>])</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="kw">def</span> stats():</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(file_path) <span class="im">as</span> f:</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(f)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>        stats <span class="op">=</span> df.describe()</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>        <span class="cf">return</span> stats.to_json()        </span></code></pre>
</div>
<p>n.b. Don’t worry if you’re not familiar with Python or Pandas! This
code will return some basic statistics about the data in the
database.</p>
<p>Now, from our previous lesson we know how to load this file! Let’s
use a bind mount to load this file into the container. Since we are
debugging, we’ll leave out the <code>-d</code> flag so we can see the
output easily.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> <span class="va">$PWD</span>/print.config:/code/config/print.config <span class="at">-v</span> spuc-volume:/code/output <span class="at">-v</span> <span class="va">$PWD</span>/stats.py:/spuc/plugins/stats.py <span class="at">-e</span> EXPORT=true ghcr.io/uomresearchit/spuc:latest <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Traceback (most recent call last):
  File "/spuc/spuc.py", line 32, in &lt;module&gt;
    __import__(f"{plugin_dir}.{plugin[:-3]}")
  File "/spuc/plugins/stats.py", line 4, in &lt;module&gt;
    import pandas as pd
ModuleNotFoundError: No module named 'pandas'

:::: Importing plugins ::::</code></pre>
</div>
<p>Oh… well what can we do about this? Clearly we need to install the
<code>pandas</code> package in the container but how do we do that?</p>
<p>We could do this interactively, but we know that won’t survive a
restart!</p>
<p>Really what we need to do is <strong>change</strong> the image
itself, so that it has <code>pandas</code> installed by default.</p>
<p>This takes us to one of the most fundamental features of Docker - the
ability to create your own container images.</p>
<section><h2 class="section-heading" id="creating-docker-images">Creating Docker Images<a class="anchor" aria-label="anchor" href="#creating-docker-images"></a>
</h2>
<hr class="half-width">
<p>So how are images made? The answer is with a recipe! Named a
<code>Dockerfile</code>.</p>
<p>A <code>Dockerfile</code> is a text file that contains a list of
instructions for producing a Docker container. The instructions are
terminal command and build the container image up layer by layer.</p>
<p>We will start at the start, all Dockerfiles start with a
<code>FROM</code> instruction. This sets the base image for the
container. The base image is the starting point for the container, and
all subsequent instructions are run on top of this base image.</p>
<p>You can use <strong>any</strong> image as a base image and there are
several offical images available on Docker Hub. For example,
<code>ubuntu</code> for general purpose Linux, <code>python</code> for
Python development, <code>alpine</code> for a lightweight Linux
distribution, and many more.</p>
<p>But of course the most natural fit for us right now is to use the
SPUC image as a base image. This way we can be sure that our new image
will have all the dependencies we need.</p>
<p>Let’s create a new file called <code>Dockerfile</code> (it
<strong>must</strong> be called this!) and add the following
content:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/uomresearchit/spuc:latest</span></code></pre>
</div>
<p>This is the simplest possible <code>Dockerfile</code> - it just says
that our new image will be based on the SPUC image.</p>
<p>But what do we do with it? We need to build the image!</p>
<p>To do this we use the <code>docker build</code> command (short for
<code>docker image build</code>). This command takes a
<code>Dockerfile</code> and builds a new image from it and we will add a
<code>-t</code> (tag) flag to give the image a name.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> spuc-stats ./</span></code></pre>
</div>
<p>This command will build a new image called <code>spuc-stats</code>
from the <code>Dockerfile</code> in the current directory.</p>
<p>We can now run this image in the same way we run any other image:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> <span class="va">$PWD</span>/print.config:/code/config/print.config <span class="at">-v</span> spuc-volume:/code/output <span class="at">-v</span> <span class="va">$PWD</span>/stats.py:/spuc/plugins/stats.py <span class="at">-e</span> EXPORT=true spuc-stats <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Traceback (most recent call last):
  File "/spuc/spuc.py", line 32, in &lt;module&gt;
    __import__(f"{plugin_dir}.{plugin[:-3]}")
  File "/spuc/plugins/stats.py", line 4, in &lt;module&gt;
    import pandas as pd
ModuleNotFoundError: No module named 'pandas'</code></pre>
</div>
<p>Ok! Back where we were but with some new skills!</p>
<p>Let’s add that dependancy. We do this by adding a <code>RUN</code>
instruction to the <code>Dockerfile</code>. This instruction runs a
command in the container and then saves the result as a new layer in the
image.</p>
<p>In this case we want to install the <code>pandas</code> package so we
add the following lines to the <code>Dockerfile</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install pandas</span></code></pre>
</div>
<p>This will install the <code>pandas</code> package in the container
using Python’s package manager <code>pip</code>.</p>
<p>Now we can build the image again:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> spuc-stats ./</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
Installing collected packages: pytz, tzdata, six, numpy, python-dateutil, pandas
Successfully installed numpy-2.1.2 pandas-2.2.3 python-dateutil-2.9.0.post0 pytz-2024.2 six-1.16.0 tzdata-2024.2
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable.It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
 ---&gt; Removed intermediate container 642bfe617ba4
 ---&gt; 6ec83b86fbd1
Successfully built 6ec83b86fbd1
Successfully tagged spuc-stats:latest</code></pre>
</div>
<p>It is worth noting that we can ignore this warning! We are building a
container image, not installing software on our host machine.</p>
<p>Now we can run the image again:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> <span class="va">$PWD</span>/print.config:/code/config/print.config <span class="at">-v</span> spuc-volume:/code/output <span class="at">-v</span> <span class="va">$PWD</span>/stats.py:/spuc/plugins/stats.py <span class="at">-e</span> EXPORT=True spuc-stats <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
Welcome to the Space Purple Unicorn Counter!

:::: Units set to Intergalactic Unicorn Luminiocity Units [iulu] ::::")

:::: Plugins loaded ::::
['stats.py']

:: Try recording a unicorn sighting with:
    curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100</code></pre>
</div>
<p>And now we can see that the <code>pandas</code> package is installed
and the plugin is loaded!</p>
<p>Let’s try out the new endpoint:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">$</span> curl localhost:8321/stats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{"count":{"count":3.0,"mean":1.0,"std":1.0,"min":0.0,"25%":0.5,"50%":1.0,"75%":1.5,"max":2.0},"brightness":{"count":3.0,"mean":10.0,"std":0.0,"min":10.0,"25%":10.0,"50%":10.0,"75%":10.0,"max":10.0}}</code></pre>
</div>
<p>And there we have it! We have created our own container image with a
new feature!</p>
<p>But why stop here? We could keep modifing the image to make it more
how we would like by default.</p>
</section><section><h2 class="section-heading" id="copy">COPY<a class="anchor" aria-label="anchor" href="#copy"></a>
</h2>
<hr class="half-width">
<p>The first thing to look at is that it is a bit annoying having to
bind mount the <code>stats.py</code> file every time we run the
container. This makes sense for development but we would like to
distribute the image with the plugin already installed.</p>
<p>We can add this file to the image itself using the <code>COPY</code>
instruction.</p>
<p>The <code>COPY</code> instruction copies files from the host machine
into the container image. It takes two arguments: the source file on the
host machine and the destination in the container image.</p>
<p>Let’s add the <code>COPY</code> instruction to the
<code>Dockerfile</code>:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install pandas</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="kw">COPY</span> stats.py /spuc/plugins/stats.py</span></code></pre>
</div>
<p>Now we can build the image again:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> spuc-stats ./</span></code></pre>
</div>
<p>And run the image, this time without the bind mount for the
<code>stats.py</code> file:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> <span class="va">$PWD</span>/print.config:/code/config/print.config <span class="at">-v</span> spuc-volume:/code/output <span class="at">-e</span> EXPORT=True spuc-stats <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
:::: Plugins loaded ::::
['stats.py']
[...]</code></pre>
</div>
<p>If we check the logs we can see that the plugin is still loaded!</p>
<p>And again… why stop there? It is annoying having to mount the
<code>print.config</code> file every time we run the container. We could
add this file to the image as well!</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install pandas</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="kw">COPY</span> stats.py /spuc/plugins/stats.py</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="kw">COPY</span> print.config /code/config/print.config</span></code></pre>
</div>
<p>Rebuilding and running (without the bind mount for
<code>print.config</code>):</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> spuc-stats ./</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> spuc-volume:/code/output <span class="at">-e</span> EXPORT=True spuc-stats <span class="at">--units</span> iulu</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="env">ENV<a class="anchor" aria-label="anchor" href="#env"></a>
</h2>
<hr class="half-width">
<p>We can also set environment variables in the <code>Dockerfile</code>
using the <code>ENV</code> instruction. These can always be overridden
when running the container but it is useful to set defaults. And we like
the <code>EXPORT</code> variable so let’s add that to the
<code>Dockerfile</code>:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install pandas</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="kw">COPY</span> stats.py /spuc/plugins/stats.py</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="kw">COPY</span> print.config /code/config/print.config</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="kw">ENV</span> EXPORT=True</span></code></pre>
</div>
<p>Rebuilding and running (without the <code>-e EXPORT=True</code>
flag):</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> spuc-stats ./</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> spuc-volume:/code/output spuc-stats <span class="at">--units</span> iulu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
:::: Unicorn sightings export activated! ::::
:: Try downloading the unicorn sightings record with:
    curl localhost:8321/export</code></pre>
</div>
<p>We can see that the <code>EXPORT</code> variable is now set to
<code>True</code> by default!</p>
</section><section><h2 class="section-heading" id="entrypoint">ENTRYPOINT<a class="anchor" aria-label="anchor" href="#entrypoint"></a>
</h2>
<hr class="half-width">
<p>We’re on a bit of a roll here! Let’s add one more modification to the
image.</p>
<p>Let’s change away from those imperial units by default.</p>
<p>We can do this by changing the <code>ENTRYPOINT</code> instruction in
the <code>Dockerfile</code>. So far we have been adding
<code>--units iulu</code> to the end of the <code>docker run</code>
which overwrites the <code>command</code>.</p>
<p>If we move this to the <code>ENTRYPOINT</code> instruction then it
will be run every time the container is started. We’ll also add a
<code>CMD</code> instruction with an empty list as the CMD was set in
the SPUCS container base and we don’t want to set <code>--units</code>
twice.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install pandas</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="kw">COPY</span> stats.py /spuc/plugins/stats.py</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="kw">COPY</span> print.config /code/config/print.config</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="kw">ENV</span> EXPORT=True</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [<span class="st">"python"</span>, <span class="st">"/spuc/spuc.py"</span>, <span class="st">"--units"</span>, <span class="st">"iulu"</span>]</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="kw">CMD</span> []</span></code></pre>
</div>
<p>Notice that we use array syntax for the <code>ENTRYPOINT</code>
instruction. This is because the <code>ENTRYPOINT</code> instruction can
take a list of arguments and the array syntax ensures that the arguments
are passed correctly.</p>
<p>Let’s give this a try, dropping the unnecessary
<code>--units iulu</code> from the <code>docker run</code> command:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> spuc-stats ./</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> spuc-volume:/code/output spuc-stats</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
:::: Units set to Intergalactic Unicorn Luminiocity Units [iulu] ::::")
[...]</code></pre>
</div>
<p>Much better! A far clearner command, much more customised for our use
case!</p>
</section><section><h2 class="section-heading" id="back-to-reality">Back to reality<a class="anchor" aria-label="anchor" href="#back-to-reality"></a>
</h2>
<hr class="half-width">
<p>In this lession we have focused on modifying an image already
containing a service. This is a perfectly valid way of using
Dockerfiles! But it is not the most common.</p>
<p>While you can base your images on any other public image, it is most
common for developers to be creating containers ‘from the ground
up’.</p>
<p>The most common practice is creating images from images like
<code>ubuntu</code> or <code>alpine</code> and adding your own software
and configuration files.</p>
<p>An example of this is how the developers of the SPUC service created
their image. The Dockerfile is reproduced below:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="kw">FROM</span> python:3.12-slim</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="kw">WORKDIR</span> /spuc</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="kw">COPY</span> ./requirements.txt /spuc/requirements.txt</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install <span class="at">--no-cache-dir</span> <span class="at">--upgrade</span> <span class="at">-r</span> /spuc/requirements.txt</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="kw">COPY</span> ./*.py /spuc/</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="kw">COPY</span> ./config/*.config /spuc/config/</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="kw">RUN</span> <span class="fu">mkdir</span> /spuc/output</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="kw">EXPOSE</span> 8321</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [<span class="st">"python"</span>, <span class="st">"/spuc/spuc.py"</span>]</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"--units"</span>, <span class="st">"iuhc"</span>]</span></code></pre>
</div>
<p>From this we can see the developers:</p>
<ul>
<li>started with a <code>python:3.12-slim</code> image</li>
<li>installed the required packages (from a file) using
<code>pip</code>
</li>
<li>copied the source code and configuration files</li>
<li>set the default entrypoint andcommand.</li>
</ul>
<p>This is a very common pattern for creating images and is the most
common way to use Dockerfiles but it is important to realise that you
can create images from <strong>any</strong> base image and customise
them to your heart’s content!</p>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>In this lesson we have seen how to create our own container images
using a <code>Dockerfile</code>.</p>
<p>We’ve added new layers with new packges installed using
<code>RUN</code>, we’ve added files using <code>COPY</code>, set
environment variables using <code>ENV</code>, and changed the default
command using <code>ENTRYPOINT</code> and <code>CMD</code>.</p>
<p>However, we are still encumbered with quite an unwieldy command to
run the container. In the next lesson we will see how to make this
easier by using <code>docker-compose</code>.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>You can create your own container images using a
<code>Dockerfile</code>.</li>
<li>A <code>Dockerfile</code> is a text file that contains a list of
instructions for producing a Docker container.</li>
<li>
<code>FROM</code>, <code>RUN</code>, <code>COPY</code>,
<code>ENV</code>, <code>ENTRYPOINT</code>, and <code>CMD</code> are some
of the most imprtatn instructions that can be used in a
<code>Dockerfile</code>.</li>
<li>The <code>docker build</code> command is used to build a container
image from a <code>Dockerfile</code>.</li>
<li>You can run a container from a container image using the
<code>docker run</code> command.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-docker-compose"><p>Content from <a href="docker-compose.html">Using Docker Compose</a></p>
<hr>
<p>Last updated on 2024-10-15 |

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/episodes/docker-compose.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 198 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is Docker Compose? And why would I use it?</li>
<li>How can I translate my <code>docker run</code> commands into a
<code>docker-compose.yml</code> file?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to run multiple containers - easily!</li>
<li>Clean up our run command for once and for all</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>On to our final bit of learning from the SPUC DockerHub pages - the
SPUC Super Visualiser! The SPUC Super Visualiser is a web-based tool
that allows you to visualise the output of the SPUC tool. Handily - it’s
also available as a Docker container, published on DockerHub under the
SPUC organisation.</p>
<p>Now that you have seen several <code>docker run</code> commands. You
can well imagine how cumbersome running multiple containers can get.</p>
<p>Enter: Docker Compose!</p>
<p>Docker Compose is a tool for defining and running multi-container
Docker applications. With Compose, you use a YAML file to configure your
application’s services. Then, with a single command, you create and
start all the services from your configuration.</p>
<p>Let’s take a look at Docker Compose and see how it can help us run
SPUCSVi.</p>
<section><h2 class="section-heading" id="making-a-docker-compose-file">Making a Docker Compose file<a class="anchor" aria-label="anchor" href="#making-a-docker-compose-file"></a>
</h2>
<hr class="half-width">
<p>Docker Compose files can be thought of as YAML formatting
formalisations of <code>docker run</code> commands.</p>
<p>Let’s recall our <code>docker run</code> command for the regular SPUC
container (rather than the one we made ourselves - we’ll get to that in
a bit):</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-d</span> <span class="at">--rm</span> <span class="at">--name</span> spuc_container <span class="at">-p</span> 8321:8321 <span class="at">-v</span> <span class="va">$PWD</span>/print.config:/code/config/print.config <span class="at">-v</span> spuc-volume:/code/output <span class="at">-v</span> <span class="va">$PWD</span>/stats.py:/spuc/plugins/stats.py <span class="at">-e</span> EXPORT=true ghcr.io/uomresearchit/spuc:latest <span class="at">--units</span> iulu</span></code></pre>
</div>
<p>We can start translate this into a Docker Compose file bit by
bit!</p>
<p>The first thing we need to do is create a
<code>docker-compose.yml</code> file. All
<code>docker-compose.yml</code> files start with <code>services:</code>.
This is the root element undre which we define the services we want to
run.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span></code></pre>
</div>
<p>Next, let’s add the service for the SPUC container. We’ll call it
<code>spuc</code> and we will tell it what <code>image</code> to
use.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> ghcr.io/uomresearchit/spuc:latest</span></span></code></pre>
</div>
<p>This is actually enough for us to run the container!</p>
<p>But we won’t use <code>docker run</code> any more. How we use the
base command <code>docker compose</code> to run the services with the
command <code>up</code> signalling that we want to bring services up
(i.e. start them).</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> docker compose up</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 2/0
 ✔ Network docker-intro-testing_default   Created                                                                         0.0s
 ✔ Container docker-intro-testing-spuc-1  Created                                                                         0.0s
Attaching to spuc-1
spuc-1  |
spuc-1  | :::: Importing plugins ::::
spuc-1  |
spuc-1  |
spuc-1  |             \
spuc-1  |              \
spuc-1  |               \\
spuc-1  |                \\\
spuc-1  |                 &gt;\/7
spuc-1  |             _.-(º   \
spuc-1  |            (=___._/` \            ____  ____  _    _  ____
spuc-1  |                 )  \ |\          / ___||  _ \| |  | |/ ___|
spuc-1  |                /   / ||\         \___ \| |_) | |  | | |
spuc-1  |               /    &gt; /\\\         ___) |  __/| |__| | |___
spuc-1  |              j    &lt; _\           |____/|_|    \____/ \____|
spuc-1  |          _.-' :      ``.
spuc-1  |          \ r=._\        `.       Space Purple Unicorn Counter
spuc-1  |         &lt;`\\_  \         .`-.
spuc-1  |          \ r-7  `-. ._  ' .  `\
spuc-1  |           \`,      `-.`7  7)   )
spuc-1  |            \/         \|  \'  / `-._
spuc-1  |                       ||    .'
spuc-1  |                        \\  (
spuc-1  |                         &gt;\  &gt;
spuc-1  |                     ,.-' &gt;.'
spuc-1  |                    &lt;.'_.''
spuc-1  |                      &lt;'</code></pre>
</div>
<p>So we have our container running! With a couple of interesting bits
of output to note:</p>
<ul>
<li>A container was created named <code>spuc-1</code>
</li>
<li>A <code>network</code> was created for the container - we will dig
into what this means later!</li>
<li>The tool is running in the foreground, so we can see the output of
the tool</li>
</ul>
<p>We can stop the container by pressing <code>Ctrl+C</code> in the
terminal.</p>
</section><section><h2 class="section-heading" id="adding-more-configuration">Adding more configuration<a class="anchor" aria-label="anchor" href="#adding-more-configuration"></a>
</h2>
<hr class="half-width">
<p>We did a lot of learning in our previous experiments! Breaking down
our run command further, we can see that we have a few more options that
we can add to our <code>docker-compose.yml</code> file.</p>
<p>We’ll provide a quick overview here and then dive into how to add
them to our <code>docker-compose.yml</code> file.</p>
<table class="table">
<colgroup>
<col width="31%">
<col width="68%">
</colgroup>
<thead><tr class="header">
<th>Flag</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>-d</code></td>
<td>Run the container in the background</td>
</tr>
<tr class="even">
<td><code>--rm</code></td>
<td>Remove the container when it stops</td>
</tr>
<tr class="odd">
<td><code>--name spuc_container</code></td>
<td>Name the container <code>spuc_container</code>
</td>
</tr>
<tr class="even">
<td><code>-p 8321:8321</code></td>
<td>Map port 8321 on the host to port 8321 in the container</td>
</tr>
<tr class="odd">
<td><code>-v $PWD/print.config:/code/config/print.config</code></td>
<td>Mount the <code>print.config</code> file in the current directory to
<code>/code/config/print.config</code> in the container</td>
</tr>
<tr class="even">
<td><code>-v spuc-volume:/code/output</code></td>
<td>Persis the <code>/code/output</code> directory in the container to
the <code>spuc-volume</code> volume</td>
</tr>
<tr class="odd">
<td><code>-v $PWD/stats.py:/spuc/plugins/stats.py</code></td>
<td>Enable the <code>stats.py</code> plugin by mounting it to
<code>/spuc/plugins/stats.py</code> in the container</td>
</tr>
<tr class="even">
<td><code>-e EXPORT=true</code></td>
<td>Set the environment variable <code>EXPORT</code> to
<code>true</code>
</td>
</tr>
<tr class="odd">
<td><code>--units iulu</code></td>
<td>Set the units to Imperial Unicorn Length Units</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="running-in-the-background">Running in the background<a class="anchor" aria-label="anchor" href="#running-in-the-background"></a>
</h3>
<p>To run a docker compose stack in the background, we can use the
<code>-d</code> (for detatch) flag when calling
<code>docker compose up</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> docker compose up <span class="at">-d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 1/1
 ✔ Container docker-intro-testing-spuc-1  Started                                                                         0.2s</code></pre>
</div>
<p>Of course, this means we can no longer see the logs! But we can still
access them using the <code>logs</code> command.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> docker compose logs</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>spuc-1  |
spuc-1  | :::: Importing plugins ::::
spuc-1  |
spuc-1  |
spuc-1  |             \
spuc-1  |              \
spuc-1  |               \\
spuc-1  |                \\\
spuc-1  |                 &gt;\/7
spuc-1  |             _.-(º   \
spuc-1  |            (=___._/` \            ____  ____  _    _  ____
spuc-1  |                 )  \ |\          / ___||  _ \| |  | |/ ___|
spuc-1  |                /   / ||\         \___ \| |_) | |  | | |
spuc-1  |               /    &gt; /\\\         ___) |  __/| |__| | |___
spuc-1  |              j    &lt; _\           |____/|_|    \____/ \____|
spuc-1  |          _.-' :      ``.
spuc-1  |          \ r=._\        `.       Space Purple Unicorn Counter
spuc-1  |         &lt;`\\_  \         .`-.
spuc-1  |          \ r-7  `-. ._  ' .  `\
spuc-1  |           \`,      `-.`7  7)   )
spuc-1  |            \/         \|  \'  / `-._
spuc-1  |                       ||    .'
spuc-1  |                        \\  (
spuc-1  |                         &gt;\  &gt;
spuc-1  |                     ,.-' &gt;.'
spuc-1  |                    &lt;.'_.''
spuc-1  |                      &lt;'
spuc-1  |
spuc-1  |
spuc-1  | Welcome to the Space Purple Unicorn Counter!
spuc-1  |
spuc-1  | :::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::")
spuc-1  |
spuc-1  | :::: Plugins loaded ::::
spuc-1  | []
spuc-1  |
spuc-1  | :: Try recording a unicorn sighting with:
spuc-1  |     curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100
spuc-1  |
spuc-1  |
spuc-1  | :::: Importing plugins ::::
spuc-1  |
spuc-1  |
spuc-1  |             \
spuc-1  |              \
spuc-1  |               \\
spuc-1  |                \\\
spuc-1  |                 &gt;\/7
spuc-1  |             _.-(º   \
spuc-1  |            (=___._/` \            ____  ____  _    _  ____
spuc-1  |                 )  \ |\          / ___||  _ \| |  | |/ ___|
spuc-1  |                /   / ||\         \___ \| |_) | |  | | |
spuc-1  |               /    &gt; /\\\         ___) |  __/| |__| | |___
spuc-1  |              j    &lt; _\           |____/|_|    \____/ \____|
spuc-1  |          _.-' :      ``.
spuc-1  |          \ r=._\        `.       Space Purple Unicorn Counter
spuc-1  |         &lt;`\\_  \         .`-.
spuc-1  |          \ r-7  `-. ._  ' .  `\
spuc-1  |           \`,      `-.`7  7)   )
spuc-1  |            \/         \|  \'  / `-._
spuc-1  |                       ||    .'
spuc-1  |                        \\  (
spuc-1  |                         &gt;\  &gt;
spuc-1  |                     ,.-' &gt;.'
spuc-1  |                    &lt;.'_.''
spuc-1  |                      &lt;'
spuc-1  |
spuc-1  |
spuc-1  | Welcome to the Space Purple Unicorn Counter!
spuc-1  |
spuc-1  | :::: Units set to Imperial Unicorn Hoove Candles [iuhc] ::::")
spuc-1  |
spuc-1  | :::: Plugins loaded ::::
spuc-1  | []
spuc-1  |
spuc-1  | :: Try recording a unicorn sighting with:
spuc-1  |     curl -X PUT localhost:8321/unicorn_spotted?location=moon\&amp;brightness=100
spuc-1  |</code></pre>
</div>
<p>Now… something a bit funny is happening here… why are we seeing the
output twice?</p>
</div>
<div class="section level3">
<h3 id="removing-the-container-when-it-stops">Removing the container when it stops<a class="anchor" aria-label="anchor" href="#removing-the-container-when-it-stops"></a>
</h3>
<p>This is because we only <code>stop</code>ped the container when we
pressed <code>Ctrl+C</code> and didn’t remove it. We can remove the
container with the <code>down</code> command.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">$</span> docker compose down</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 1/1
 ✔ Container docker-intro-testing-spuc-1  Removed                                                                         10.2s
 ✔ Network docker-intro-testing_default   Removed                                                                         0.1s    </code></pre>
</div>
<p>In practice, you only need to use <code>down</code> if you need to
remove the container. If you just want to stop it, you can use
<code>Ctrl+C</code> like we did before.</p>
</div>
<div class="section level3">
<h3 id="adding-configuration">Adding configuration<a class="anchor" aria-label="anchor" href="#adding-configuration"></a>
</h3>
<p>Now we have got the basics of running a container in the background
and removing it when we are done. Let’s add some more configuration to
our <code>docker-compose.yml</code> file. Feel free to <code>up</code>
the stack between changes to see how they affect the container.</p>
</div>
<div class="section level3">
<h3 id="naming-the-container">Naming the container<a class="anchor" aria-label="anchor" href="#naming-the-container"></a>
</h3>
<p><code>spuc-1</code> is a bit of a boring name for a container. We can
name the container using the <code>container_name</code> key.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">DIFF<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode diff" tabindex="0"><code class="sourceCode diff"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>services:</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  spuc:</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    image: ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="va">+    container_name: spuc_container</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 2/0
 ✔ Network docker-intro-testing_default  Created                                                                          0.0s
 ✔ Container spuc_container              Created                                                                          0.0s</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="exporting-a-port">Exporting a port<a class="anchor" aria-label="anchor" href="#exporting-a-port"></a>
</h3>
<p>Currently, if we attempt to record a sighting of a unicorn, we will
get a connection refused error.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=10</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>curl: (7) Failed to connect to localhost port 8321 after 0 ms: Could not connect to server</code></pre>
</div>
<p>This is because we haven’t mapped the port from the container to the
host. We can do this using the <code>ports</code> key using the notation
<code>host_port:container_port</code>.</p>
<p>It’s worth noting the <code>ports</code> key is a list, so we can map
multiple ports if we need to and that the host and container ports don’t
have to be the same!</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">DIFF<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode diff" tabindex="0"><code class="sourceCode diff"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>services:</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  spuc:</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>    image: ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    container_name: spuc_container</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="va">+    ports:</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="va">+      - 8321:8321</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 2/0
 ✔ Network docker-intro-testing_default  Created                                                                          0.0s
 ✔ Container spuc_container              Created                                                                          0.0s</code></pre>
</div>
<p>Now we can record a unicorn sighting!</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-X</span> PUT localhost:8321/unicorn_spotted<span class="pp">?</span>location=moon\&amp;brightness=10</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="op">{</span><span class="st">"message"</span><span class="op">:</span><span class="st">"Unicorn sighting recorded!"</span><span class="op">}</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="bind-mounting-a-file">Bind mounting a file<a class="anchor" aria-label="anchor" href="#bind-mounting-a-file"></a>
</h3>
<p>As before, we want to make sure that our print configuration is being
used by SPUC.</p>
<p>We will use a bind mount for this - mapping a file from the host to
the container.</p>
<p>As with the CLI, this is (confusingly) done using the
<code>volumes</code> key.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">DIFF<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode diff" tabindex="0"><code class="sourceCode diff"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>services:</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  spuc:</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    image: ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>    container_name: spuc_container</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>    ports:</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>      - 8321:8321</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="va">+    volumes:</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="va">+      - $PWD/print.config:/code/config/print.config</span></span></code></pre>
</div>
<p>Now, if you record some sightings, you should see them formatted
according to the configuration in <code>print.config</code>.</p>
<p>As before, whether a bind mount or volume is performed is based on
whether the path on the left of the colon exists on the host. If it
does, it’s a bind mount. If it doesn’t, it’s a volume.</p>
</div>
<div class="section level3">
<h3 id="mounting-a-volume">Mounting a volume<a class="anchor" aria-label="anchor" href="#mounting-a-volume"></a>
</h3>
<p>We are still missing the volume we used to store our Unicorn
sightings persistently. We can add this using the <code>volumes</code>
key.</p>
<p>This time with just the volume name on the left of the colon and
adding a declaration for the volume at the bottom of the file.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">DIFF<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode diff" tabindex="0"><code class="sourceCode diff"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>services:</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  spuc:</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>    image: ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>    container_name: spuc_container</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>    ports:</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>      - 8321:8321</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>    volumes:</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>      - $PWD/print.config:/code/config/print.config</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="va">+      - spuc-volume:/code/output</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="va">+ volumes:</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="va">+   spuc-volume:</span></span></code></pre>
</div>
<p>Now, if you record some sightings and then stop and start the
container, you should see that the sightings are still there!</p>
<p>However, we can now use a cool feature of Docker Compose - the
ability to remove volumes when the container is removed.</p>
<p>We can do this using the <code>-v</code> flag with the
<code>down</code> command. Which tells Docker to remove any volumes
named in the <code>volumes</code> key.</p>
<p>You can cofirm this by running <code>docker volume ls</code> before
and after running <code>down</code>.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="ex">$</span> docker volume ls</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="ex">$</span> docker compose down <span class="at">-v</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="ex">$</span> docker volume ls</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="setting-an-environment-variable">Setting an environment variable<a class="anchor" aria-label="anchor" href="#setting-an-environment-variable"></a>
</h3>
<p>Finally, let’s set the <code>EXPORT</code> environment variable to
<code>true</code> as we did in our <code>docker run</code> command.</p>
<p>This is done using the <code>environment</code> key.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">DIFF<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode diff" tabindex="0"><code class="sourceCode diff"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>services:</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  spuc:</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>    image: ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>    container_name: spuc_container</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>    ports:</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>      - 8321:8321</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>    volumes:</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>      - $PWD/print.config:/code/config/print.config</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>      - spuc-volume:/code/output</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="va">+    environment:</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="va">+      - EXPORT=true</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>volumes:</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>  spuc-volume:</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
spuc_container  | :::: Unicorn sightings export activated! ::::
spuc_container  | :: Try downloading the unicorn sightings record with:
spuc_container  |     curl localhost:8321/export</code></pre>
</div>
<p>We can see that the environment variable has been set by the output
of the tool and the export functionality is now available.</p>
</div>
</section><section><h2 class="section-heading" id="setting-the-units">Setting the units<a class="anchor" aria-label="anchor" href="#setting-the-units"></a>
</h2>
<hr class="half-width">
<p>We can also set the units using the <code>command</code> key. This is
the same as the <code>--units</code> flag in the <code>docker run</code>
command.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">DIFF<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode diff" tabindex="0"><code class="sourceCode diff"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>services:</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  spuc:</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>    image: ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>    container_name: spuc_container</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>    ports:</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>      - 8321:8321</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>    volumes:</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>      - $PWD/print.config:/code/config/print.config</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>      - spuc-volume:/code/output</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>    environment:</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>      - EXPORT=true</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a><span class="va">+    command: ["--units", "iulu"]</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>volumes:</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>  spuc-volume:</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[...]
spuc_container  | :::: Units set to Imperial Unicorn Length Units [iulu] ::::</code></pre>
</div>
</section><section><h2 class="section-heading" id="enabling-the-plugin">Enabling the plugin<a class="anchor" aria-label="anchor" href="#enabling-the-plugin"></a>
</h2>
<hr class="half-width">
<p>We’re nearly back to where we were with our <code>docker run</code>
command! The only thing we are missing is enabling the plugin.</p>
<p>Shouldn’t be too bad - we can just mount the plugin file to the
correct directory in the container.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">DIFF<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode diff" tabindex="0"><code class="sourceCode diff"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>services:</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>  spuc:</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>    image: ghcr.io/uomresearchit/spuc:latest</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>    container_name: spuc_container</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>    ports:</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>      - 8321:8321</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>    volumes:</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>      - $PWD/print.config:/code/config/print.config</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>      - spuc-volume:/code/output</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>      - $PWD/stats.py:/spuc/plugins/stats.py</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>    environment:</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>      - EXPORT=true</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>    command: ["--units", "iulu"]</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>volumes:</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>  spuc-volume:</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">$</span> docker compose up</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Attaching to spuc_container
spuc_container  | Traceback (most recent call last):
spuc_container  |   File "/spuc/spuc.py", line 32, in &lt;module&gt;
spuc_container  |     __import__(f"{plugin_dir}.{plugin[:-3]}")
spuc_container  |   File "/spuc/plugins/stats.py", line 4, in &lt;module&gt;
spuc_container  |
spuc_container  | :::: Importing plugins ::::
spuc_container  |
spuc_container  |     import pandas as pd
spuc_container  | ModuleNotFoundError: No module named 'pandas'
spuc_container exited with code 1</code></pre>
</div>
<p>Oh no! We’ve hit an error! It looks like the <code>pandas</code>
library isn’t installed in the container - which was the whole reason
that we made our own container in the first place!</p>
<p>Let’s go back to that.</p>
</section><section><h2 class="section-heading" id="building-our-own-spuc-container">Building our own SPUC container<a class="anchor" aria-label="anchor" href="#building-our-own-spuc-container"></a>
</h2>
<hr class="half-width">
<p>But how do you build your own container using Docker Compose?</p>
<p>Just like before we can use our Dockerfile to build the container. We
can use the <code>build</code> key to tell Docker Compose to build the
container using the Dockerfile in the current directory.</p>
<p>This time instead of using the <code>image</code> key, we use the
<code>build</code> key.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="at">  </span><span class="fu">spuc</span><span class="kw">:</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="kw">-</span><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> ghcr.io/uomresearchit/spuc:latest</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="fu">+    build</span><span class="kw">:</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="fu">+      context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="fu">+      dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="at">    </span><span class="fu">container_name</span><span class="kw">:</span><span class="at"> spuc_container</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> 8321:8321</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> $PWD/print.config:/code/config/print.config</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> spuc-volume:/code/output</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> $PWD/stats.py:/spuc/plugins/stats.py</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> EXPORT=true</span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"--units"</span><span class="kw">,</span><span class="at"> </span><span class="st">"iulu"</span><span class="kw">]</span></span></code></pre>
</div>
<p>So what is this doing? It is saying to build the container using the
Dockerfile in the current directory. The <code>context</code> key is the
directory in which the Dockerfile is located (a <code>.</code> means the
current directory). The <code>dockerfile</code> key is the name of the
Dockerfile.</p>
<p>Now, we have to be a little careful with our up command! If we run
up, Docker Compose will default to checking if the image exists and if
it does, it will use that image.</p>
<p>This is ok… unless we have made changes to the Dockerfile!</p>
<p>To ensure that the image is built, we can run:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="ex">$</span> docker compose build</span></code></pre>
</div>
<p>Followed by our usual <code>up</code> command.</p>
<p>You can also use the <code>--build</code> flag with the
<code>up</code> command to build the image before starting the
container.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="ex">$</span> docker compose up <span class="at">--build</span></span></code></pre>
</div>
<p>But this can be wasteful as it will rebuild the image every time you
run the up - even if the image hasn’t changed.</p>
<p>However you choose to manage this, you should now have a container
running with the stats plugin enabled!</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>spuc_container  | :::: Plugins loaded ::::
spuc_container  | ['stats.py']</code></pre>
</div>
</section><section><h2 class="section-heading" id="adding-spucsvi">Adding SPUCSVi<a class="anchor" aria-label="anchor" href="#adding-spucsvi"></a>
</h2>
<hr class="half-width">
<p>So far we have only been running the SPUC container. There is an
argument to be made that, even running a single service, that Docker
Compose is a useful tool.</p>
<p>It brings an ephemeral run command that would need careful
documentation to replicate into a single file that can be version
controlled and shared. And it is much easier on the eye than a long
<code>docker run</code> command!</p>
<p>That’s great. But where Docker Compose really shines is when you have
multiple services that need to be run together.</p>
<p>And we happen to have another service that we need to run -
SPUCSVi!</p>
</section><section><h2 class="section-heading" id="adding-spucsvi-to-our-docker-compose-file">Adding SPUCSVi to our Docker Compose file<a class="anchor" aria-label="anchor" href="#adding-spucsvi-to-our-docker-compose-file"></a>
</h2>
<hr class="half-width">
<p>We can add SPUCSVi to our Docker Compose file in the same way that we
added SPUC, by adding another service to the <code>services</code>
key.</p>
<p>The SPUCSVi README helpfully provides a table of configuration
options what we can use to configure the service, reproduced here:</p>
<table class="table">
<colgroup>
<col width="21%">
<col width="46%">
<col width="32%">
</colgroup>
<thead><tr class="header">
<th>Item</th>
<th>Description</th>
<th>Default</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Image Name</td>
<td>The name of the image to use</td>
<td><code>ghcr.io/uomresearchit/spucsvi:latest</code></td>
</tr>
<tr class="even">
<td>Port</td>
<td>The container port to the service runs on</td>
<td><code>8322</code></td>
</tr>
<tr class="odd">
<td>SPUC_URL</td>
<td>An environment variable which gives the URL of the SPUC service</td>
<td><code>http://spuc:8321</code></td>
</tr>
</tbody>
</table>
<p>We can use this to add SPUCSVi to our Docker Compose file!</p>
<p>But how do we know the correct URL for the SPUC service? This touches
on a couple of clever tricks that Docker Compose uses to make running
multiple services easier.</p>
<p>First, Docker Compose creates a network for each stack that it
starts. This means that, unless overridden, all services in the stack
can communicate with each other.</p>
<p>Second, Docker Compose uses the service name as the hostname for the
service. This means that we can use the service name as the hostname in
the URL!</p>
<p>For our service named <code>spuc</code>, the hostname would be
<code>spuc</code> with the protocol <code>http</code> prepended and
<code>port</code> appended i.e. <code>http://spuc:8321</code>.</p>
<p>Knowing this, we are able to add SPUCSVi to our Docker Compose
file!</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">DIFF<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode diff" tabindex="0"><code class="sourceCode diff"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>services:</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  spuc:</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>    build:</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>      context: .</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>      dockerfile: Dockerfile</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>    container_name: spuc_container</span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>    ports:</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>      - 8321:8321</span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a>    volumes:</span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a>      - $PWD/print.config:/code/config/print.config</span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>      - spuc-volume:/code/output</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>      - $PWD/stats.py:/spuc/plugins/stats.py</span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a>    environment:</span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a>      - EXPORT=true</span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a>    command: ["--units", "iulu"]</span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a><span class="va">+  spucsvi:</span></span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a><span class="va">+    image: ghcr.io/uomresearchit/spucsvi:latest</span></span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a><span class="va">+    container_name: spucsvi</span></span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a><span class="va">+    ports:</span></span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a><span class="va">+      - "8322:8322"</span></span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a><span class="va">+    environment:</span></span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a><span class="va">+      - SPUC_URL=http://spuc:8321</span></span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" tabindex="-1"></a>volumes:</span>
<span id="cb34-26"><a href="#cb34-26" tabindex="-1"></a>  spuc-volume:</span></code></pre>
</div>
<p>Where we added : * A service named <code>spucsvi</code> * The image
<code>ghcr.io/uomresearchit/spucsvi:latest</code> * The container name
<code>spucsvi</code> (not strictly necessary, but it’s nice to have) *
The port <code>8322</code> for the service (mapped to <code>8322</code>
on the host) * The environment variable <code>SPUC_URL</code> set to
<code>http://spuc:8321</code></p>
<p>Now when we run <code>docker compose up</code>, both services will be
started!</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="ex">$</span> docker compose up</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[+] Running 3/3
 ✔ Network docker-intro-testing_default  Created                                                                                                                          0.1s
 ✔ Container spucsvi                     Created                                                                                                                          0.1s
 ✔ Container spuc_container              Created                                                                                                                          0.2s
Attaching to spuc_container, spucsvi</code></pre>
</div>
<p>And we can now view the SPUCSVi interface by visiting
<code>localhost:8322</code> in our browser!</p>
<p>A visual treat awaits! And an easier way to record and view our
unicorn sightings!</p>
<div class="section level3">
<h3 id="networks">Networks<a class="anchor" aria-label="anchor" href="#networks"></a>
</h3>
<p>We breifly mentioned networks earlier, noting that, by default,
Docker Compose creates a network for each stack.</p>
<p>However, by overriding the default network, we can perform some
interesting tricks!</p>
</div>
<div class="section level3">
<h3 id="isolating-spuc">Isolating SPUC<a class="anchor" aria-label="anchor" href="#isolating-spuc"></a>
</h3>
<p>Now that we can record Unicorns using the SPUCSVi interface, we don’t
need to be able to access the SPUC service directly.</p>
<p>This means we can isolate the SPUC service from the host network.
This is a good security practice and helps keep things tidy.</p>
<p>We can do this by removing the <code>ports</code> key from the SPUC
service.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">DIFF<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode diff" tabindex="0"><code class="sourceCode diff"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>services:</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>  spuc:</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>    build:</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>      context: .</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>      dockerfile: Dockerfile</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>    container_name: spuc_container</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a><span class="st">-    ports:</span></span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a><span class="st">-      - 8321:8321</span></span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>    volumes:</span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>      - $PWD/print.config:/code/config/print.config</span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a>      - spuc-volume:/code/output</span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>      - $PWD/stats.py:/spuc/plugins/stats.py</span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>    environment:</span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>      - EXPORT=true</span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a>    command: ["--units", "iulu"]</span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a>  spucsvi:</span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a>    image: ghcr.io/uomresearchit/spucsvi:latest</span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a>    container_name: spucsvi</span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a>    ports:</span>
<span id="cb37-21"><a href="#cb37-21" tabindex="-1"></a>      - "8322:8322"</span>
<span id="cb37-22"><a href="#cb37-22" tabindex="-1"></a>    environment:</span>
<span id="cb37-23"><a href="#cb37-23" tabindex="-1"></a>      - SPUC_URL=http://spuc:8321</span>
<span id="cb37-24"><a href="#cb37-24" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" tabindex="-1"></a>volumes:</span>
<span id="cb37-26"><a href="#cb37-26" tabindex="-1"></a>  spuc-volume:</span></code></pre>
</div>
<p>Now, the SPUC service is only accessible from within the Docker
network!</p>
<p>This can be taken further to creater networks with very limited
purposes. For example in a typical web app you may make it so that th
frontend can connect only to backend, but not to the database.</p>
</div>
</section><section><h2 class="section-heading" id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width">
<p>In this lesson, we have taken a dive into Docker Compose and seen how
it can help us run multiple services together - in addition to making
running a single service easier!</p>
<p>We have seen how to translate <code>docker run</code> commands into a
<code>docker-compose.yml</code> file and how to run the services using
<code>docker compose</code>.</p>
<p>We have also seen how to build a container using Docker Compose and
how to run multiple services together.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Docker Compose is a tool for defining and running multi-container
Docker stacks</li>
<li>Docker Compose files are written in YAML</li>
<li>Docker Compose can build images using a Dockerfile</li>
<li>Docker Compose allows containers to communicate with each other</li>
</ul>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/UoMResearchIT/docker-introduction/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/UoMResearchIT/docker-introduction/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/UoMResearchIT/docker-introduction/" class="external-link">Source</a></p>
				<p><a href="https://github.com/UoMResearchIT/docker-introduction/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.9" class="external-link">sandpaper (0.16.9)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://uomresearchit.github.io/docker-introduction/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://uomresearchit.github.io/docker-introduction/instructor/aio.html",
  "identifier": "https://uomresearchit.github.io/docker-introduction/instructor/aio.html",
  "dateCreated": "2015-04-18",
  "dateModified": "2024-10-15",
  "datePublished": "2024-10-15"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

